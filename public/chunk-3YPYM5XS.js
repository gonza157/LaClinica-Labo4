import{a as ut}from"./chunk-HHY63ZLL.js";import{a as kt,b as Et,c as Ot}from"./chunk-NFBHQTVJ.js";import"./chunk-Q4YU3M55.js";import"./chunk-6QCYZ6KR.js";import{a as wt,b as Tt,c as vt,e as Pt,g as yt}from"./chunk-FXXNP7EN.js";import{e as Ft,f as Nt}from"./chunk-UQXX2G4H.js";import{a as G,b as j,c as At,d as ot,e as $,f as Y,g as q,h as J}from"./chunk-KYJNGL4I.js";import{c as It,d as zt}from"./chunk-UI2J3IFV.js";import{D as W,E as H,Y as Rt}from"./chunk-X7NSQYYE.js";import{$b as b,$c as I,Bb as O,Cb as V,Eb as p,Gb as g,Hb as s,Ic as ht,Jc as B,Kc as L,Oc as Mt,Pc as S,Qa as l,Rb as xt,Tb as Ct,Va as y,Vb as d,Wb as v,Xb as A,Yb as Q,Yc as D,Zd as Vt,_ as K,_b as C,ab as E,ac as h,be as St,cd as z,ce as U,dc as et,de as k,ea as u,ec as dt,ee as Dt,fa as _,fe as X,gb as f,gc as mt,hc as bt,he as it,id as R,je as F,ke as nt,pa as lt,xb as m,yb as c,zb as r}from"./chunk-7XCQR3O2.js";import{a as N,b as st,h as T}from"./chunk-FJYW2LMB.js";function Ut(n,e){if(n&1&&(c(0,"div",6),d(1),r()),n&2){let t=s();l(),v(t.comentario)}}function Gt(n,e){if(n&1){let t=p();c(0,"textarea",7),h("ngModelChange",function(o){u(t);let a=s();return b(a.comentario,o)||(a.comentario=o),_(o)}),r()}if(n&2){let t=s();C("ngModel",t.comentario),m("readonly",t.soloLectura)}}function jt(n,e){n&1&&(c(0,"button",8),d(1,"Cerrar"),r())}function $t(n,e){if(n&1){let t=p();O(0),c(1,"button",9),g("click",function(){u(t);let o=s();return _(o.dialogRef.close())}),d(2,"Cancelar"),r(),c(3,"button",10),g("click",function(){u(t);let o=s();return _(o.dialogRef.close(o.comentario))}),d(4," Aceptar "),r(),V()}if(n&2){let t=s();l(3),m("disabled",!t.comentario.trim())}}var Z=class n{constructor(e,t){this.dialogRef=e;this.data=t;t.comentario&&(this.comentario=t.comentario),typeof t.soloLectura=="boolean"&&(this.soloLectura=t.soloLectura)}comentario="";soloLectura=!1;static \u0275fac=function(t){return new(t||n)(y(G),y(j))};static \u0275cmp=E({type:n,selectors:[["app-dialogo-comentario"]],decls:9,vars:5,consts:[["editable",""],["mat-dialog-title",""],["class","resena-lectura",4,"ngIf","ngIfElse"],["align","end"],["mat-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf"],[1,"resena-lectura"],["rows","4",2,"width","100%",3,"ngModelChange","ngModel","readonly"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],["mat-button","","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(c(0,"h2",1),d(1),r(),c(2,"mat-dialog-content"),f(3,Ut,2,1,"div",2)(4,Gt,1,2,"ng-template",null,0,bt),r(),c(6,"mat-dialog-actions",3),f(7,jt,2,0,"button",4)(8,$t,5,1,"ng-container",5),r()),t&2){let o=xt(5);l(),v(i.data.titulo),l(2),m("ngIf",i.soloLectura)("ngIfElse",o),l(4),m("ngIf",i.soloLectura),l(),m("ngIf",!i.soloLectura)}},dependencies:[S,L,R,D,I,z,J,ot,$,q,Y,H,W],styles:["[_nghost-%COMP%]     .mat-dialog-container{min-width:340px;max-width:600px;width:100%;box-sizing:border-box;background:linear-gradient(135deg,#fff,#f8fbff);border-radius:16px;box-shadow:0 8px 32px #1976d226;overflow:hidden}h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1976d2!important;background:linear-gradient(135deg,#f8fbff,#e3f2fd);margin:-24px -24px 1.2rem;padding:1rem 1.5rem;text-align:center;letter-spacing:1px;border-bottom:2px solid #e3f2fd}mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:1.5rem;overflow-x:hidden}textarea[readonly][_ngcontent-%COMP%]{background:linear-gradient(135deg,#f8fbff,#e3f2fd);color:#1976d2;border:2px solid #e3f2fd;border-radius:12px;font-size:1.1rem;padding:1.2rem;width:100%;resize:none;box-shadow:0 2px 8px #1976d21a;font-family:inherit;margin-bottom:.5rem;min-height:120px;outline:none;overflow-x:hidden;white-space:pre-wrap;word-break:break-word}textarea[_ngcontent-%COMP%]:not([readonly]){background:#fff;color:#333;border:2px solid #64b5f6;border-radius:12px;font-size:1.1rem;padding:1.2rem;width:100%;resize:vertical;box-shadow:0 2px 8px #1976d21a;font-family:inherit;margin-bottom:.5rem;min-height:120px;outline:none}textarea[_ngcontent-%COMP%]:not([readonly]):focus{border-color:#1976d2;box-shadow:0 4px 12px #1976d24d}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}button[mat-button][_ngcontent-%COMP%]{font-weight:600!important;font-size:1.05rem!important;border-radius:8px!important;padding:.5rem 1.5rem!important;transition:all .3s ease!important}button[mat-button][color=primary][_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5)!important;color:#fff!important;border:1px solid #1976d2!important}button[mat-button][color=primary][_ngcontent-%COMP%]:hover:not(:disabled){background:linear-gradient(135deg,#0d47a1,#1976d2)!important;transform:translateY(-1px)!important;box-shadow:0 4px 12px #42a5f566!important}button[mat-button][_ngcontent-%COMP%]:not([color=primary]){background:linear-gradient(135deg,#64b5f6,#90caf9)!important;color:#fff!important;border:1px solid #64b5f6!important}button[mat-button][_ngcontent-%COMP%]:not([color=primary]):hover:not(:disabled){background:linear-gradient(135deg,#42a5f5,#64b5f6)!important;transform:translateY(-1px)!important;box-shadow:0 4px 12px #42a5f54d!important}button[mat-button][_ngcontent-%COMP%]:disabled{background:#e0e0e0!important;color:#9e9e9e!important;border-color:#e0e0e0!important;cursor:not-allowed!important}.resena-lectura[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;max-width:100%;overflow-x:hidden;white-space:pre-wrap;word-break:break-word}"]})};var Yt=()=>[1,2,3,4,5];function qt(n,e){if(n&1&&(c(0,"mat-radio-button",8),d(1),r()),n&2){let t=e.$implicit;m("value",t),l(),Q("",t," estrella",t>1?"s":"")}}function Jt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),d(2,"\xBFC\xF3mo calificar\xEDa la atenci\xF3n recibida?"),r(),c(3,"mat-radio-group",6),h("ngModelChange",function(o){u(t);let a=s();return b(a.respuestas().calificacion,o)||(a.respuestas().calificacion=o),_(o)}),f(4,qt,2,3,"mat-radio-button",7),r()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().calificacion),l(),m("ngForOf",et(2,Yt))}}function Kt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),d(2,"\xBFEl especialista respondi\xF3 todas sus dudas?"),r(),c(3,"mat-radio-group",6),h("ngModelChange",function(o){u(t);let a=s();return b(a.respuestas().dudasResueltas,o)||(a.respuestas().dudasResueltas=o),_(o)}),c(4,"mat-radio-button",9),d(5,"S\xED"),r(),c(6,"mat-radio-button",10),d(7,"No"),r()()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().dudasResueltas)}}function Qt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),d(2,"\xBFRecomendar\xEDa este servicio?"),r(),c(3,"mat-radio-group",6),h("ngModelChange",function(o){u(t);let a=s();return b(a.respuestas().recomendacion,o)||(a.respuestas().recomendacion=o),_(o)}),c(4,"mat-radio-button",9),d(5,"S\xED"),r(),c(6,"mat-radio-button",10),d(7,"No"),r()()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().recomendacion)}}function Xt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),d(2,"Comentarios adicionales"),r(),c(3,"textarea",11),h("ngModelChange",function(o){u(t);let a=s();return b(a.respuestas().comentario,o)||(a.respuestas().comentario=o),_(o)}),r()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().comentario)}}function Zt(n,e){if(n&1){let t=p();c(0,"button",12),g("click",function(){u(t);let o=s();return _(o.anterior())}),d(1,"Anterior"),r()}}function te(n,e){if(n&1){let t=p();c(0,"button",13),g("click",function(){u(t);let o=s();return _(o.siguiente())}),d(1,"Siguiente"),r()}if(n&2){let t=s();m("disabled",!t.respuestasValida())}}function ee(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s();return _(o.finalizar())}),d(1,"Finalizar"),r()}}var at=class n{constructor(e,t){this.dialogRef=e;this.data=t}paso=lt(1);respuestas=lt({calificacion:"",dudasResueltas:"",recomendacion:"",comentario:""});siguiente(){this.paso.update(e=>e+1)}anterior(){this.paso.update(e=>e-1)}finalizar(){this.dialogRef.close(this.respuestas())}respuestasValida(){let e=this.respuestas();switch(this.paso()){case 1:return!!e.calificacion;case 2:return!!e.dudasResueltas;case 3:return!!e.recomendacion;default:return!0}}static \u0275fac=function(t){return new(t||n)(y(G),y(j))};static \u0275cmp=E({type:n,selectors:[["app-dialogo-encuesta"]],decls:11,vars:7,consts:[["mat-dialog-title",""],[4,"ngIf"],["align","end"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"disabled","click",4,"ngIf"],["mat-button","","color","primary",3,"click",4,"ngIf"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["value","S\xED"],["value","No"],["rows","3",2,"width","100%",3,"ngModelChange","ngModel"],["mat-button","",3,"click"],["mat-button","",3,"click","disabled"],["mat-button","","color","primary",3,"click"]],template:function(t,i){t&1&&(c(0,"h2",0),d(1,"Encuesta de atenci\xF3n"),r(),c(2,"mat-dialog-content"),f(3,Jt,5,3,"div",1)(4,Kt,8,1,"div",1)(5,Qt,8,1,"div",1)(6,Xt,4,1,"div",1),r(),c(7,"mat-dialog-actions",2),f(8,Zt,2,0,"button",3)(9,te,2,1,"button",4)(10,ee,2,0,"button",5),r()),t&2&&(l(3),m("ngIf",i.paso()===1),l(),m("ngIf",i.paso()===2),l(),m("ngIf",i.paso()===3),l(),m("ngIf",i.paso()===4),l(2),m("ngIf",i.paso()>1),l(),m("ngIf",i.paso()<4),l(),m("ngIf",i.paso()===4))},dependencies:[S,B,L,R,D,I,z,Ot,kt,Et,J,$,q,Y,H,W],styles:["[_nghost-%COMP%]     .mat-mdc-dialog-container, [_nghost-%COMP%]     .mat-dialog-container{background:linear-gradient(135deg,#fff,#f8fbff);border-radius:16px;min-width:400px;max-width:500px!important;overflow:hidden!important}[_nghost-%COMP%]     .mat-mdc-dialog-content, [_nghost-%COMP%]     .mat-dialog-content{overflow-x:hidden!important;overflow-y:auto!important;padding:0 24px 24px!important}[_nghost-%COMP%]     .mat-radio-button .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-radio-button .mdc-radio__outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button .mdc-radio__outer-circle{border-color:#90caf9!important;background:#fff!important;border-width:2px!important}[_nghost-%COMP%]     .mat-radio-button .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-radio-button .mdc-radio__inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button .mdc-radio__inner-circle{background:transparent!important;transform:scale(0)!important}[_nghost-%COMP%]     .mat-radio-button.mat-radio-checked .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-radio-button.mat-radio-checked .mdc-radio__outer-circle, [_nghost-%COMP%]     .mat-radio-button.mat-mdc-radio-checked .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-radio-button.mat-mdc-radio-checked .mdc-radio__outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-radio-checked .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-radio-checked .mdc-radio__outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-mdc-radio-checked .mat-radio-outer-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-mdc-radio-checked .mdc-radio__outer-circle{border-color:#1976d2!important;background:#fff!important}[_nghost-%COMP%]     .mat-radio-button.mat-radio-checked .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-radio-button.mat-radio-checked .mdc-radio__inner-circle, [_nghost-%COMP%]     .mat-radio-button.mat-mdc-radio-checked .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-radio-button.mat-mdc-radio-checked .mdc-radio__inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-radio-checked .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-radio-checked .mdc-radio__inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-mdc-radio-checked .mat-radio-inner-circle, [_nghost-%COMP%]     .mat-mdc-radio-button.mat-mdc-radio-checked .mdc-radio__inner-circle{background:#1976d2!important;transform:scale(.5)!important}[_nghost-%COMP%]     button[mat-button]{border-radius:8px!important;padding:.75rem 1.5rem!important}[_nghost-%COMP%]     button[mat-button][color=primary]{background:linear-gradient(135deg,#1976d2,#42a5f5)!important;color:#fff!important}[_nghost-%COMP%]     button[mat-button]:not([color=primary]){background:linear-gradient(135deg,#64b5f6,#90caf9)!important;color:#fff!important}[_nghost-%COMP%]     ::-webkit-scrollbar{width:0px!important;height:0px!important}[_nghost-%COMP%]     .mat-ripple-element{background-color:#1976d21a!important}h2[mat-dialog-title][_ngcontent-%COMP%]{color:#1976d2!important;background:linear-gradient(135deg,#f8fbff,#e3f2fd);margin:-24px -24px 1rem;padding:1rem 1.5rem;text-align:center;border-bottom:2px solid #e3f2fd}label[_ngcontent-%COMP%]{color:#1976d2;font-weight:600;margin-bottom:12px;display:block}mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:15px 0 20px;gap:12px}textarea[_ngcontent-%COMP%]{width:100%!important;padding:12px!important;border:2px solid #90caf9!important;border-radius:8px!important;color:#333!important}textarea[_ngcontent-%COMP%]:focus{border-color:#1976d2!important;outline:none!important}"]})};var ie=()=>[1,2,3,4,5];function ne(n,e){if(n&1){let t=p();O(0),c(1,"span",7),g("click",function(){let o=u(t).$implicit,a=s();return _(a.setEstrellas(o))})("mouseenter",function(){let o=u(t).$implicit,a=s();return _(a.setHover(o))})("mouseleave",function(){u(t);let o=s();return _(o.resetHover())}),d(2,"\u2605"),r(),V()}if(n&2){let t=e.$implicit,i=s();l(),Ct("seleccionada",t<=i.estrellas)("hovered",i.hoverEstrella>0&&t<=i.hoverEstrella)}}var rt=class n{constructor(e,t){this.dialogRef=e;this.data=t}estrellas=0;comentario="";hoverEstrella=0;setEstrellas(e){this.estrellas=e}setHover(e){this.hoverEstrella=e}resetHover(){this.hoverEstrella=0}aceptar(){this.estrellas>0&&this.dialogRef.close({estrellas:this.estrellas,comentario:this.comentario})}static \u0275fac=function(t){return new(t||n)(y(G),y(j))};static \u0275cmp=E({type:n,selectors:[["app-dialogo-calificacion"]],decls:11,vars:5,consts:[["mat-dialog-title",""],[1,"estrellas"],[4,"ngFor","ngForOf"],["rows","3","placeholder","Nos gustar\xEDa conocer tu opini\xF3n.",2,"width","100%",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"click","disabled"],[1,"estrella",3,"click","mouseenter","mouseleave"]],template:function(t,i){t&1&&(c(0,"h2",0),d(1),r(),c(2,"mat-dialog-content")(3,"div",1),f(4,ne,3,4,"ng-container",2),r(),c(5,"textarea",3),h("ngModelChange",function(a){return b(i.comentario,a)||(i.comentario=a),a}),r()(),c(6,"mat-dialog-actions",4)(7,"button",5),d(8,"Cancelar"),r(),c(9,"button",6),g("click",function(){return i.aceptar()}),d(10,"Aceptar"),r()()),t&2&&(l(),v(i.data.titulo),l(3),m("ngForOf",et(4,ie)),l(),C("ngModel",i.comentario),l(4),m("disabled",i.estrellas===0))},dependencies:[S,B,R,D,I,z,J,ot,$,q,Y],styles:[".estrellas[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:1rem}.estrellas[_ngcontent-%COMP%]   .estrella[_ngcontent-%COMP%]{cursor:pointer;color:#ccc;transition:color .2s}.estrellas[_ngcontent-%COMP%]   .estrella.seleccionada[_ngcontent-%COMP%]{color:#ffd600}.estrellas[_ngcontent-%COMP%]   .estrella.hovered[_ngcontent-%COMP%]{color:#ff9800}"]})};function oe(n,e){if(n&1){let t=p();O(0),c(1,"input",8),h("ngModelChange",function(o){u(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),_(o)}),r(),V()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function ae(n,e){if(n&1){let t=p();O(0),c(1,"input",8),h("ngModelChange",function(o){u(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),_(o)}),r(),V()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function re(n,e){if(n&1){let t=p();O(0),c(1,"input",8),h("ngModelChange",function(o){u(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),_(o)}),r(),V()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function ce(n,e){if(n&1&&(c(0,"p")(1,"strong"),d(2,"Especialista:"),r(),d(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.especialistaNombre)}}function se(n,e){if(n&1&&(c(0,"p")(1,"strong"),d(2,"Paciente:"),r(),d(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.pacienteNombre)}}function le(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function de(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.verResena(o))}),d(1,"Ver Rese\xF1a"),r()}}function me(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.completarEncuesta(o))}),d(1,"Encuesta"),r()}}function ue(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.calificarAtencion(o))}),d(1,"Calificar"),r()}}function _e(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function pe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.rechazarTurno(o))}),d(1,"Rechazar"),r()}}function ge(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.aceptarTurno(o))}),d(1,"Aceptar"),r()}}function fe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.finalizarTurno(o))}),d(1,"Finalizar"),r()}}function xe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.cargarHistoriaClinica(o))}),d(1,"Historia Cl\xEDnica"),r()}}function Ce(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function be(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s();return _(a.verHistoriaClinica(o))}),d(1,"Ver Historia Cl\xEDnica"),r()}}function he(n,e){if(n&1&&(c(0,"mat-card",9)(1,"mat-card-title",10),d(2),dt(3,"date"),r(),c(4,"mat-card-content")(5,"p")(6,"strong"),d(7,"Especialidad:"),r(),d(8),r(),f(9,ce,4,1,"p",2)(10,se,4,1,"p",2),c(11,"p")(12,"strong"),d(13,"Estado: "),r(),c(14,"span",11),d(15),r()()(),c(16,"mat-card-actions",12),f(17,le,2,0,"button",13)(18,de,2,0,"button",13)(19,me,2,0,"button",13)(20,ue,2,0,"button",13)(21,_e,2,0,"button",13)(22,pe,2,0,"button",13)(23,ge,2,0,"button",13)(24,fe,2,0,"button",13)(25,xe,2,0,"button",13)(26,Ce,2,0,"button",13)(27,be,2,0,"button",13),r()()),n&2){let t=e.$implicit,i=s();l(2),Q(" ",mt(3,18,t.fecha.split(" ")[0],"dd/MM/yyyy")," ",t.fecha.split(" ")[1]," "),l(6),A(" ",t.especialidad),l(),m("ngIf",i.rol!=="especialista"),l(),m("ngIf",i.rol!=="paciente"),l(4),m("ngClass",t.estado),l(),v(t.estado),l(2),m("ngIf",i.puedeCancelarPaciente(t)),l(),m("ngIf",i.puedeVerResena(t)),l(),m("ngIf",i.puedeCompletarEncuesta(t)),l(),m("ngIf",i.puedeCalificar(t)),l(),m("ngIf",i.puedeCancelarEspecialista(t)),l(),m("ngIf",i.puedeRechazar(t)),l(),m("ngIf",i.puedeAceptar(t)),l(),m("ngIf",i.puedeFinalizar(t)),l(),m("ngIf",i.puedeCargarHistoriaClinica(t)),l(),m("ngIf",i.puedeCancelarAdmin(t)),l(),m("ngIf",i.puedeVerHistoriaClinica(t))}}function Me(n,e){if(n&1&&(c(0,"p")(1,"strong"),d(2,"Especialista:"),r(),d(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.especialistaNombre)}}function we(n,e){if(n&1&&(c(0,"p")(1,"strong"),d(2,"Paciente:"),r(),d(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.pacienteNombre)}}function Te(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function ve(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.verResena(o))}),d(1,"Ver Rese\xF1a"),r()}}function Pe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.completarEncuesta(o))}),d(1,"Encuesta"),r()}}function ye(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.calificarAtencion(o))}),d(1,"Calificar"),r()}}function ke(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function Ee(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.rechazarTurno(o))}),d(1,"Rechazar"),r()}}function Oe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.aceptarTurno(o))}),d(1,"Aceptar"),r()}}function Ve(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.finalizarTurno(o))}),d(1,"Finalizar"),r()}}function Se(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.cargarHistoriaClinica(o))}),d(1,"Historia Cl\xEDnica"),r()}}function De(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){u(t);let o=s().$implicit,a=s(2);return _(a.cancelarTurno(o))}),d(1,"Cancelar"),r()}}function Ie(n,e){if(n&1&&(c(0,"mat-card",9)(1,"mat-card-title",10),d(2),dt(3,"date"),r(),c(4,"mat-card-content")(5,"p")(6,"strong"),d(7,"Especialidad:"),r(),d(8),r(),f(9,Me,4,1,"p",2)(10,we,4,1,"p",2),c(11,"p")(12,"strong"),d(13,"Estado: "),r(),c(14,"span",11),d(15),r()()(),c(16,"mat-card-actions",12),f(17,Te,2,0,"button",13)(18,ve,2,0,"button",13)(19,Pe,2,0,"button",13)(20,ye,2,0,"button",13)(21,ke,2,0,"button",13)(22,Ee,2,0,"button",13)(23,Oe,2,0,"button",13)(24,Ve,2,0,"button",13)(25,Se,2,0,"button",13)(26,De,2,0,"button",13),r()()),n&2){let t=e.$implicit,i=s(2);l(2),Q(" ",mt(3,17,t.fecha.split(" ")[0],"dd/MM/yyyy")," ",t.fecha.split(" ")[1]," "),l(6),A(" ",t.especialidad),l(),m("ngIf",i.rol!=="especialista"),l(),m("ngIf",i.rol!=="paciente"),l(4),m("ngClass",t.estado),l(),v(t.estado),l(2),m("ngIf",i.puedeCancelarPaciente(t)),l(),m("ngIf",i.puedeVerResena(t)),l(),m("ngIf",i.puedeCompletarEncuesta(t)),l(),m("ngIf",i.puedeCalificar(t)),l(),m("ngIf",i.puedeCancelarEspecialista(t)),l(),m("ngIf",i.puedeRechazar(t)),l(),m("ngIf",i.puedeAceptar(t)),l(),m("ngIf",i.puedeFinalizar(t)),l(),m("ngIf",i.puedeCargarHistoriaClinica(t)),l(),m("ngIf",i.puedeCancelarAdmin(t))}}function ze(n,e){if(n&1&&(c(0,"div",3),f(1,Ie,27,20,"mat-card",4),r()),n&2){let t=s();l(),m("ngForOf",t.turnosPrevios)}}var Wt=class n{authService=K(Rt);firestore=K(Vt);snackBar=K(It);dialog=K(At);filtro1="";filtro2="";turnos=[];user=null;rol=null;mostrarPrevios=!1;filtroGlobal="";ngOnInit(){this.user=this.authService.userSignal(),this.rol=this.user?.rol||null,this.cargarTurnos()}cargarTurnos(){return T(this,null,function*(){let e=U(this.firestore,"turnos"),t;if(this.rol==="paciente")t=it(e,nt("pacienteUid","==",this.user.uid));else if(this.rol==="especialista")t=it(e,nt("especialistaUid","==",this.user.uid));else if(this.rol==="admin")t=e;else{this.turnos=[];return}let i=yield X(t);this.turnos=i.docs.map(a=>N({id:a.id},a.data()));let o=[];if(this.rol==="paciente")o=(yield X(it(U(this.firestore,"historias-clinicas"),nt("pacienteUid","==",this.user.uid)))).docs.map(M=>N({id:M.id},M.data()));else if(this.rol==="especialista"){let a=Array.from(new Set(this.turnos.map(x=>x.pacienteUid)));o=(yield X(U(this.firestore,"historias-clinicas"))).docs.map(x=>N({id:x.id},x.data())).filter(x=>a.includes(x.pacienteUid)&&x.especialistaUid===this.user.uid)}else this.rol==="admin"&&(o=(yield X(U(this.firestore,"historias-clinicas"))).docs.map(M=>N({id:M.id},M.data())));this.turnos=this.turnos.map(a=>{let M=null;return a.historiaClinicaId?M=o.find(x=>x.id===a.historiaClinicaId):M=o.find(x=>x.pacienteUid===a.pacienteUid&&x.especialistaUid===a.especialistaUid&&Re(a.fecha,x.fecha)),st(N({},a),{historiaClinica:M||null})})})}get turnosFiltrados(){let e=this.turnos;if(this.filtroGlobal.trim()){let w=this.filtroGlobal.trim().toLowerCase();e=e.filter(P=>{let tt=Object.values(P).map(ct=>typeof ct=="object"?JSON.stringify(ct):String(ct)).join(" ").toLowerCase();return P.historiaClinica&&(tt+=" "+JSON.stringify(P.historiaClinica).toLowerCase()),tt.includes(w)})}let t=["aceptado","pendiente","realizado"],i=["cancelado","rechazado","finalizado"],o=w=>{let[P,tt]=w.fecha.split(" ");return new Date(`${P}T${tt||"00:00"}`)},a=(w,P)=>o(w).getTime()-o(P).getTime(),M=(w,P)=>o(P).getTime()-o(w).getTime(),x=e.filter(w=>t.includes(w.estado)).sort(a),Ht=e.filter(w=>i.includes(w.estado)).sort(M);return[...x,...Ht]}get turnosActuales(){let e=["aceptado","pendiente","realizado"];return this.turnosFiltrados.filter(t=>e.includes(t.estado))}get turnosPrevios(){let e=["cancelado","rechazado","finalizado"];return this.turnosFiltrados.filter(t=>e.includes(t.estado))}puedeCancelarPaciente(e){return this.rol==="paciente"&&e.estado==="pendiente"}puedeVerResena(e){return!!e.resena}puedeCompletarEncuesta(e){return this.rol==="paciente"&&e.estado==="realizado"&&e.resena&&!e.encuestaCompletada}puedeCalificar(e){return this.rol==="paciente"&&e.estado==="realizado"&&!e.calificacion}puedeCancelarEspecialista(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeRechazar(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeAceptar(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeFinalizar(e){return this.rol==="especialista"&&e.estado==="aceptado"}puedeCargarHistoriaClinica(e){return this.rol==="especialista"&&e.estado==="realizado"}puedeCancelarAdmin(e){return this.rol==="admin"&&e.estado==="pendiente"}puedeVerHistoriaClinica(e){return(this.rol==="paciente"||this.rol==="admin")&&e.estado==="finalizado"}cancelarTurno(e){return T(this,null,function*(){let t=yield this.pedirComentario("Motivo de la cancelaci\xF3n");t&&(yield F(k(this.firestore,"turnos",e.id),{estado:"cancelado",comentarioCancelacion:t}),this.snackBar.open("Turno cancelado","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos())})}rechazarTurno(e){return T(this,null,function*(){let t=yield this.pedirComentario("Motivo del rechazo");t&&(yield F(k(this.firestore,"turnos",e.id),{estado:"rechazado",comentarioRechazo:t}),this.snackBar.open("Turno rechazado","",{duration:3500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos())})}aceptarTurno(e){return T(this,null,function*(){yield F(k(this.firestore,"turnos",e.id),{estado:"aceptado"}),this.snackBar.open("Turno aceptado","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos()})}finalizarTurno(e){return T(this,null,function*(){let t=yield this.pedirComentario("Rese\xF1a");t&&(yield F(k(this.firestore,"turnos",e.id),{estado:"realizado",resena:t}),this.snackBar.open("Turno finalizado","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos())})}completarEncuesta(e){this.dialog.open(at,{width:"400px"}).afterClosed().subscribe(t=>T(this,null,function*(){if(t)try{let i=k(this.firestore,"turnos",e.id);yield F(i,{encuestaCompletada:!0,encuesta:t}),this.snackBar.open("\xA1Encuesta enviada!","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos()}catch{this.snackBar.open("Error al guardar la encuesta","",{duration:3500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}}))}calificarAtencion(e){return T(this,null,function*(){let i=yield this.dialog.open(rt,{data:{titulo:"Calificar atenci\xF3n del especialista"}}).afterClosed().toPromise();!i||!i.estrellas||(yield F(k(this.firestore,"turnos",e.id),{calificacion:i.estrellas,comentarioCalificacion:i.comentario??""}),this.snackBar.open("Calificaci\xF3n guardada","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos())})}verResena(e){this.dialog.open(Z,{data:{titulo:"Rese\xF1a del turno",comentario:e.resena||"Sin rese\xF1a",soloLectura:!0}})}pedirComentario(e){return T(this,null,function*(){let i=yield this.dialog.open(Z,{data:{titulo:e,soloLectura:!1}}).afterClosed().toPromise();return i&&i.trim()?i:null})}cargarHistoriaClinica(e){return T(this,null,function*(){let i=yield this.dialog.open(ut,{data:{paciente:{nombre:e.pacienteNombre,uid:e.pacienteUid}}}).afterClosed().toPromise();if(i){let o=yield St(U(this.firestore,"historias-clinicas"),st(N({},i),{pacienteUid:e.pacienteUid,pacienteNombre:e.pacienteNombre,especialistaUid:e.especialistaUid,especialistaNombre:e.especialistaNombre,especialidad:e.especialidad,fecha:new Date().toISOString()}));yield F(k(this.firestore,"turnos",e.id),{estado:"finalizado",historiaClinicaId:o.id}),this.snackBar.open("Historia cl\xEDnica guardada","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),this.cargarTurnos()}})}verHistoriaClinica(e){return T(this,null,function*(){if(!e.historiaClinicaId){this.snackBar.open("No hay historia cl\xEDnica para este turno","",{duration:3500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"});return}let t=k(this.firestore,"historias-clinicas",e.historiaClinicaId),i=yield Dt(t);if(!i.exists()){this.snackBar.open("No se encontr\xF3 la historia cl\xEDnica","",{duration:3500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"});return}let o=i.data();this.dialog.open(ut,{data:{paciente:{nombre:e.pacienteNombre},historia:o,soloLectura:!0}})})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=E({type:n,selectors:[["app-mis-turnos"]],decls:15,vars:7,consts:[[1,"mis-turnos-container"],[1,"filtros"],[4,"ngIf"],[1,"turnos-list"],["class","turno-card",4,"ngFor","ngForOf"],[1,"turnos-previos-toggle",3,"click"],[1,"toggle-link"],["class","turnos-list",4,"ngIf"],["type","text","placeholder","Buscar...",3,"ngModelChange","ngModel"],[1,"turno-card"],[1,"turno-fecha"],[1,"estado",3,"ngClass"],[1,"acciones"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"h2"),d(2),r(),c(3,"div",1),f(4,oe,2,1,"ng-container",2)(5,ae,2,1,"ng-container",2)(6,re,2,1,"ng-container",2),r(),c(7,"div",3),f(8,he,28,21,"mat-card",4),r(),c(9,"div",5),g("click",function(){return i.mostrarPrevios=!i.mostrarPrevios}),c(10,"span",6),d(11," Turnos previos "),c(12,"mat-icon"),d(13),r()()(),f(14,ze,2,1,"div",7),r()),t&2&&(l(2),v(i.rol==="admin"?"Turnos":"Mis Turnos"),l(2),m("ngIf",i.rol==="paciente"),l(),m("ngIf",i.rol==="especialista"),l(),m("ngIf",i.rol==="admin"),l(2),m("ngForOf",i.turnosActuales),l(5),v(i.mostrarPrevios?"expand_less":"expand_more"),l(),m("ngIf",i.mostrarPrevios))},dependencies:[S,ht,B,L,Mt,R,D,I,z,H,W,zt,yt,wt,Pt,vt,Tt,Nt,Ft],styles:[".mis-turnos-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}.mis-turnos-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1.5rem;font-weight:600}.mis-turnos-container[_ngcontent-%COMP%]   .filtros[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;margin-bottom:1.5rem}.mis-turnos-container[_ngcontent-%COMP%]   .filtros[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:240px;padding:.5rem;border-radius:6px;border:1px solid #ccc;background-color:var(--card-bg);color:var(--text-color)}.mis-turnos-container[_ngcontent-%COMP%]   .turnos-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;width:100%;max-width:1200px}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.2rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .turno-fecha[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin-bottom:.5rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado[_ngcontent-%COMP%]{padding:.2rem .5rem;border-radius:6px;color:#fff;font-weight:700}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.pendiente[_ngcontent-%COMP%]{background-color:#fbc02d}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.aceptado[_ngcontent-%COMP%], .mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.realizado[_ngcontent-%COMP%]{background-color:#43a047}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.cancelado[_ngcontent-%COMP%], .mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.rechazado[_ngcontent-%COMP%]{background-color:#e53935}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.finalizado[_ngcontent-%COMP%]{background-color:#1e88e5}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:1rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 auto;transition:all .3s ease}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]     .mat-mdc-button{background:linear-gradient(135deg,#42a5f5,#64b5f6)!important;color:#fff!important;border:1px solid #42a5f5!important;border-radius:8px!important;padding:8px 16px!important;font-weight:600!important}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]     .mat-mdc-button:hover:not(:disabled){background:linear-gradient(135deg,#1976d2,#42a5f5)!important;transform:translateY(-1px)!important;box-shadow:0 4px 12px #42a5f54d!important}.turnos-previos-toggle[_ngcontent-%COMP%]{margin:2rem 0 1rem;text-align:center;cursor:pointer}.turnos-previos-toggle[_ngcontent-%COMP%]   .toggle-link[_ngcontent-%COMP%]{color:#42a5f5;font-weight:600;font-size:1.1rem;display:inline-flex;align-items:center;gap:.3rem;transition:color .2s}.turnos-previos-toggle[_ngcontent-%COMP%]   .toggle-link[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:underline}.turno-card[_ngcontent-%COMP%]{transition:transform .22s cubic-bezier(.4,0,.2,1),box-shadow .22s cubic-bezier(.4,0,.2,1);will-change:transform,box-shadow;cursor:pointer}.turno-card[_ngcontent-%COMP%]:hover{transform:scale(1.035);box-shadow:0 8px 32px #42a5f533;z-index:2}"]})};function Re(n,e){let t=new Date(n.replace(" ","T")),i=new Date(e.replace(" ","T"));return t.getFullYear()===i.getFullYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate()&&t.getHours()===i.getHours()&&t.getMinutes()===i.getMinutes()}export{Wt as MisTurnos};
