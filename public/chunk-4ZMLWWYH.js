import{a as G,b as Y,c as J,d as V,e as Z,f as K,g as Q,h as X,i as $,j as ee,k as te,m as oe}from"./chunk-B6MOMOEX.js";import{a as ce,b as le}from"./chunk-QLTCTTX5.js";import{a as y,b as P}from"./chunk-UE7YZPCJ.js";import"./chunk-FK6H3RFT.js";import{$b as w,$c as N,Ab as D,Gb as g,Hb as z,Jc as L,Oc as R,Pc as W,Qa as l,Va as T,Vb as s,Wb as _,Yc as H,Zd as q,_b as E,ab as I,ac as S,cd as B,ce as k,ec as j,fe as O,gb as x,gc as A,id as U,xb as f,yb as n,zb as r}from"./chunk-7XCQR3O2.js";import{f as v,h as F}from"./chunk-FJYW2LMB.js";var ne=v(ce()),ie=v(le());function me(p,t){if(p&1&&(n(0,"tr")(1,"td"),s(2),r(),n(3,"td"),s(4),j(5,"date"),r()()),p&2){let o=t.$implicit;l(2),_(o.usuario),l(2),_(A(5,2,o.fecha,"short"))}}function pe(p,t){if(p&1&&(n(0,"div",8)(1,"h4"),s(2),r(),D(3,"canvas",4),r()),p&2){let o=t.$implicit,e=z();l(2),_(o.nombre),l(),f("data",o.data)("options",e.pieChartOptionsMedicos)("type","pie")}}V.register(G,K,ee,te,$,Q,X,Z,J,Y);var ae=class p{constructor(t){this.firestore=t}logs=[];turnos=[];turnosPorEspecialidad={};turnosPorDia={};turnosPorMedico={};turnosFinalizadosPorMedico={};fechaDesde="";fechaHasta="";ngOnInit(){return F(this,null,function*(){let t=yield O(k(this.firestore,"logs-ingresos"));this.logs=t.docs.map(e=>e.data()),this.logs.sort((e,a)=>new Date(a.fecha).getTime()-new Date(e.fecha).getTime());let o=yield O(k(this.firestore,"turnos"));this.turnos=o.docs.map(e=>e.data()),this.procesarEstadisticas()})}procesarEstadisticas(){let t=this.turnos;(this.fechaDesde||this.fechaHasta)&&(t=t.filter(o=>{let e=o.fecha.split(" ")[0];return!(this.fechaDesde&&e<this.fechaDesde||this.fechaHasta&&e>this.fechaHasta)})),this.turnosPorEspecialidad={},this.turnos.forEach(o=>{this.turnosPorEspecialidad[o.especialidad]=(this.turnosPorEspecialidad[o.especialidad]||0)+1}),this.turnosPorDia={},this.turnos.forEach(o=>{let e=o.fecha.split(" ")[0];this.turnosPorDia[e]=(this.turnosPorDia[e]||0)+1}),this.turnosPorMedico={},this.turnosFinalizadosPorMedico={},t.forEach(o=>{let e=o.especialistaNombre;this.turnosPorMedico[e]=(this.turnosPorMedico[e]||0)+1,o.estado==="finalizado"&&(this.turnosFinalizadosPorMedico[e]=(this.turnosFinalizadosPorMedico[e]||0)+1)})}descargarExcel(){let t=new ne.default.Workbook,o=t.addWorksheet("Turnos por Especialidad"),e=Object.entries(this.turnosPorEspecialidad).map(([c,h])=>({Especialidad:c,Cantidad:h}));o.columns=[{header:"Especialidad",key:"Especialidad",width:20},{header:"Cantidad",key:"Cantidad",width:10}],o.addRows(e);let a=t.addWorksheet("Turnos por D\xEDa"),i=Object.entries(this.turnosPorDia).map(([c,h])=>({D\u00EDa:c,Cantidad:h}));a.columns=[{header:"D\xEDa",key:"D\xEDa",width:20},{header:"Cantidad",key:"Cantidad",width:10}],a.addRows(i);let d=t.addWorksheet("Turnos por M\xE9dico"),C=Object.entries(this.turnosPorMedico).map(([c,h])=>({M\u00E9dico:c,Solicitados:h,Finalizados:this.turnosFinalizadosPorMedico[c]||0}));d.columns=[{header:"M\xE9dico",key:"M\xE9dico",width:25},{header:"Solicitados",key:"Solicitados",width:12},{header:"Finalizados",key:"Finalizados",width:12}],d.addRows(C);let b=t.addWorksheet("Log de Ingresos"),re=this.logs.map(c=>({Usuario:c.usuario,Fecha:new Date(c.fecha).toLocaleString()}));b.columns=[{header:"Usuario",key:"Usuario",width:25},{header:"Fecha",key:"Fecha",width:25}],b.addRows(re),[o,a,d,b].forEach(c=>{c.getRow(1).eachCell(m=>{m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"8E24AA"}},m.font={bold:!0,color:{argb:"FFFFFF"}},m.alignment={vertical:"middle",horizontal:"center"},m.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),c.eachRow((m,M)=>{M!==1&&m.eachCell(u=>{u.alignment={vertical:"middle",horizontal:"left"},u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),c.columns?.forEach((m,M)=>{let u=m.header?.toString().length||10;c.eachRow(se=>{let de=se.getCell(M+1).value?.toString()||"";u=Math.max(u,de.length+2)}),m.width=u})}),t.xlsx.writeBuffer().then(c=>{let h=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,ie.saveAs)(h,"informe-turnos.xlsx")})}descargarPDF(){let t=new y;P(t,{head:[["Especialidad","Cantidad"]],body:Object.entries(this.turnosPorEspecialidad).map(([i,d])=>[i,String(d)]),headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}});let e=document.querySelectorAll(".informe-section")[1],a=e?e.querySelector("canvas"):null;if(a){let i=a.toDataURL("image/png",1),d=t.lastAutoTable?t.lastAutoTable.finalY+10:60;t.addImage(i,"PNG",15,d,180,80)}t.save("turnos-por-especialidad.pdf")}get especialidades(){return Object.keys(this.turnosPorEspecialidad)}get cantidadesEspecialidad(){return Object.values(this.turnosPorEspecialidad)}get dias(){return Object.keys(this.turnosPorDia)}get medicos(){return Object.keys(this.turnosPorMedico)}barChartOptions={responsive:!0,plugins:{legend:{display:!1}}};get barChartData(){return{labels:Object.keys(this.turnosPorEspecialidad),datasets:[{data:Object.values(this.turnosPorEspecialidad),label:"Cantidad",backgroundColor:"#8e24aa"}]}}descargarPDFPorDia(){let t=new y;P(t,{head:[["D\xEDa","Cantidad"]],body:Object.entries(this.turnosPorDia).map(([i,d])=>[i,String(d)]),headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}});let e=document.querySelectorAll(".informe-section")[2],a=e?e.querySelector("canvas"):null;if(a){let i=a.toDataURL("image/png",1),d=t.lastAutoTable?t.lastAutoTable.finalY+10:60;t.addImage(i,"PNG",15,d,180,80)}t.save("turnos-por-dia.pdf")}descargarPDFPorMedico(){let t=new y;P(t,{head:[["M\xE9dico","Solicitados","Finalizados"]],body:Object.keys(this.turnosPorMedico).map(d=>[d,String(this.turnosPorMedico[d]),String(this.turnosFinalizadosPorMedico[d]||0)]),headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}});let o=document.querySelectorAll(".informe-section"),e=o[o.length-1],a=e?e.querySelectorAll("canvas"):[],i=t.lastAutoTable?t.lastAutoTable.finalY+10:60;a.forEach((d,C)=>{let b=d.toDataURL("image/png",1);C>0&&(t.addPage(),i=20),t.text(`Gr\xE1fico de ${this.pieChartDataMedicos[C]?.nombre||"M\xE9dico"}`,15,i),t.addImage(b,"PNG",15,i+10,180,80)}),t.save("turnos-por-medico.pdf")}descargarPDFLog(){let t=new y;P(t,{head:[["Usuario","Fecha y Hora"]],body:this.logs.map(o=>[o.usuario,new Date(o.fecha).toLocaleString()]),headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}}),t.save("log-ingresos.pdf")}get barChartDataDias(){return{labels:Object.keys(this.turnosPorDia),datasets:[{data:Object.values(this.turnosPorDia),label:"Cantidad",backgroundColor:"#1976d2"}]}}barChartOptionsDias={responsive:!0,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"D\xEDa"}},y:{title:{display:!0,text:"Cantidad"},beginAtZero:!0}}};get pieChartDataMedicos(){return Object.keys(this.turnosPorMedico).map(t=>{let o=this.turnosPorMedico[t]||0,e=this.turnosFinalizadosPorMedico[t]||0,a=o-e;return{nombre:t,data:{labels:["Pendientes","Finalizados"],datasets:[{data:[a,e],backgroundColor:["#8e24aa","#1976d2"]}]}}})}pieChartOptionsMedicos={responsive:!0,plugins:{legend:{display:!0,position:"bottom"}}};static \u0275fac=function(o){return new(o||p)(T(q))};static \u0275cmp=I({type:p,selectors:[["app-informes"]],decls:46,vars:10,consts:[[1,"informes-container"],[3,"click"],[1,"informe-section"],[4,"ngFor","ngForOf"],["baseChart","",3,"data","options","type"],[1,"botones"],["type","date",3,"ngModelChange","ngModel"],["style","margin-bottom: 2rem;",4,"ngFor","ngForOf"],[2,"margin-bottom","2rem"]],template:function(o,e){o&1&&(n(0,"div",0)(1,"h2"),s(2,"Informes y Estad\xEDsticas"),r(),n(3,"button",1),g("click",function(){return e.descargarExcel()}),s(4,"Descargar Excel"),r(),n(5,"section",2)(6,"h3"),s(7,"Log de ingresos"),r(),n(8,"table")(9,"thead")(10,"tr")(11,"th"),s(12,"Usuario"),r(),n(13,"th"),s(14,"Fecha y Hora"),r()()(),n(15,"tbody"),x(16,me,6,5,"tr",3),r()(),n(17,"button",1),g("click",function(){return e.descargarPDFLog()}),s(18,"Descargar PDF"),r()(),n(19,"section",2)(20,"h3"),s(21,"Turnos por Especialidad"),r(),D(22,"canvas",4),n(23,"div",5)(24,"button",1),g("click",function(){return e.descargarPDF()}),s(25,"Descargar PDF"),r()()(),n(26,"section",2)(27,"h3"),s(28,"Turnos por D\xEDa"),r(),D(29,"canvas",4),n(30,"button",1),g("click",function(){return e.descargarPDFPorDia()}),s(31,"Descargar PDF"),r()(),n(32,"section",2)(33,"h3"),s(34,"Turnos por M\xE9dico"),r(),n(35,"label"),s(36,"Desde: "),n(37,"input",6),S("ngModelChange",function(i){return w(e.fechaDesde,i)||(e.fechaDesde=i),i}),r()(),n(38,"label"),s(39,"Hasta: "),n(40,"input",6),S("ngModelChange",function(i){return w(e.fechaHasta,i)||(e.fechaHasta=i),i}),r()(),n(41,"button",1),g("click",function(){return e.procesarEstadisticas()}),s(42,"Filtrar"),r(),x(43,pe,4,4,"div",7),n(44,"button",1),g("click",function(){return e.descargarPDFPorMedico()}),s(45,"Descargar PDF"),r()()()),o&2&&(l(16),f("ngForOf",e.logs),l(6),f("data",e.barChartData)("options",e.barChartOptions)("type","bar"),l(7),f("data",e.barChartDataDias)("options",e.barChartOptionsDias)("type","bar"),l(8),E("ngModel",e.fechaDesde),l(3),E("ngModel",e.fechaHasta),l(3),f("ngForOf",e.pieChartDataMedicos))},dependencies:[W,L,R,U,H,N,B,oe],styles:["[_ngcontent-%COMP%]:root{--bg-color: #f3eafc;--card-bg: #fff;--text-color: #222;--shadow: #8e24aa22}body[_ngcontent-%COMP%], [_nghost-%COMP%]{background:var(--bg-color);color:var(--text-color)}.informes-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}h2[_ngcontent-%COMP%]{margin-bottom:2rem;text-align:center;font-weight:600;color:#8e24aa}.informe-section[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem 2rem;margin-bottom:2rem;width:100%;max-width:700px;transition:box-shadow .2s}.informe-section[_ngcontent-%COMP%]:hover{box-shadow:0 8px 32px #8e24aa33}h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#1976d2;font-weight:600}ul[_ngcontent-%COMP%]{padding-left:1.2rem;margin-bottom:1rem}li[_ngcontent-%COMP%]{margin-bottom:.5rem;font-size:1.08rem}label[_ngcontent-%COMP%]{margin-right:1.2rem;font-weight:500;color:#5e1675}input[type=date][_ngcontent-%COMP%]{padding:.3rem .7rem;border-radius:6px;border:1px solid #ccc;background:#f8f6fc;color:#5e1675;margin-right:.7rem}.botones[_ngcontent-%COMP%], .informe-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:1rem}button[_ngcontent-%COMP%]{background:linear-gradient(90deg,#8e24aa 60%,#1976d2);color:#fff;border:none;padding:.5rem 1.3rem;border-radius:6px;cursor:pointer;font-weight:600;font-size:1rem;box-shadow:0 2px 8px #8e24aa22;transition:background .2s,box-shadow .2s}button[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#5e1675 60%,#125ea2);box-shadow:0 4px 16px #8e24aa33}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:1rem;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #8e24aa11}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #e0d7f3;padding:.6rem .8rem;text-align:left}th[_ngcontent-%COMP%]{background:#8e24aa;color:#fff;font-weight:600;font-size:1.05rem}td[_ngcontent-%COMP%]{background:#2d2d36;color:#fff;font-size:1rem}canvas[_ngcontent-%COMP%]{margin:1rem 0;background:#2d2d36;border-radius:8px;box-shadow:0 1px 4px #8e24aa11;min-height:320px;max-height:400px}@media (prefers-color-scheme: dark){.table[_ngcontent-%COMP%]{background:#23232b}.td[_ngcontent-%COMP%]{background:#2d2d36!important;color:#eee!important}}"]})};export{ae as Informes};
