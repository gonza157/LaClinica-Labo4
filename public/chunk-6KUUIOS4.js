import{a as We,b as qe}from"./chunk-QLTCTTX5.js";import{d as he}from"./chunk-CZIAEIMA.js";import{a as Ee}from"./chunk-W2LONUKG.js";import{a as Te,b as Fe}from"./chunk-UE7YZPCJ.js";import{a as Me}from"./chunk-4WUXS4KB.js";import"./chunk-FK6H3RFT.js";import{e as ke,f as xe}from"./chunk-UQXX2G4H.js";import{c as Se}from"./chunk-KYJNGL4I.js";import{c as Re}from"./chunk-UI2J3IFV.js";import{B as pe,D as ge,E as _e,I as ye,u as ee}from"./chunk-X7NSQYYE.js";import{$d as Ce,Ab as le,Bb as x,Cb as S,Eb as E,Gb as b,Hb as h,Jc as de,Kc as ue,Mc as me,Oa as ae,Pc as fe,Qa as m,V as ne,Vb as d,Vd as te,W as A,Wb as Z,Wd as ie,Xb as T,Yb as ce,Yd as oe,Zd as we,_ as P,ab as N,bb as B,db as H,dc as L,ea as R,ec as F,fa as k,fc as M,fe as ve,gb as v,he as be,ke as De,n as X,ub as se,xb as _,yb as c,zb as s}from"./chunk-7XCQR3O2.js";import{a as w,f as re,h as f}from"./chunk-FJYW2LMB.js";var Oe=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=B({type:e});static \u0275inj=A({imports:[ye]})}return e})();var Pe=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=B({type:e});static \u0275inj=A({imports:[ee,Oe,ee]})}return e})();var Ue=re(We()),$e=re(qe());var z=class e{transform(i){return(i?i.toString():"").replace(/(\d{2,3})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(t){return new(t||e)};static \u0275pipe=H({name:"dniFormat",type:e,pure:!0})};var j=class e{transform(i){switch(i){case"admin":return"Administrador";case"especialista":return"Especialista";case"paciente":return"Paciente";default:return i}}static \u0275fac=function(t){return new(t||e)};static \u0275pipe=H({name:"rolLegible",type:e,pure:!0})};var y=class{constructor(i=0,t="Network Error"){this.status=i,this.text=t}};var Ie=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,i)=>Promise.resolve(localStorage.setItem(e,i)),remove:e=>Promise.resolve(localStorage.removeItem(e))}};var u={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Ie()};var O=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{};var Ae=(e,i="https://api.emailjs.com")=>{if(!e)return;let t=O(e);u.publicKey=t.publicKey,u.blockHeadless=t.blockHeadless,u.storageProvider=t.storageProvider,u.blockList=t.blockList,u.limitRate=t.limitRate,u.origin=t.origin||i};var V=(o,r,...a)=>f(null,[o,r,...a],function*(e,i,t={}){let p=yield fetch(u.origin+e,{method:"POST",headers:t,body:i}),n=yield p.text(),g=new y(p.status,n);if(p.ok)return g;throw g});var U=(e,i,t)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!i||typeof i!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};var Ne=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"};var $=e=>e.webdriver||!e.languages||e.languages.length===0;var Q=()=>new y(451,"Unavailable For Headless Browser");var Be=(e,i)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof i!="string")throw"The BlockList watchVariable has to be a string"};var rt=e=>!e.list?.length||!e.watchVariable,nt=(e,i)=>e instanceof FormData?e.get(i):e[i],W=(e,i)=>{if(rt(e))return!1;Be(e.list,e.watchVariable);let t=nt(i,e.watchVariable);return typeof t!="string"?!1:e.list.includes(t)};var q=()=>new y(403,"Forbidden");var He=(e,i)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(i&&typeof i!="string")throw"The LimitRate ID has to be a non-empty string"};var at=(e,i,t)=>f(null,null,function*(){let o=Number((yield t.get(e))||0);return i-Date.now()+o}),K=(e,i,t)=>f(null,null,function*(){if(!i.throttle||!t)return!1;He(i.throttle,i.id);let o=i.id||e;return(yield at(o,i.throttle,t))>0?!0:(yield t.set(o,Date.now().toString()),!1)});var J=()=>new y(429,"Too Many Requests");var Le=(e,i,t,o)=>f(null,null,function*(){let r=O(o),a=r.publicKey||u.publicKey,p=r.blockHeadless||u.blockHeadless,n=r.storageProvider||u.storageProvider,g=w(w({},u.blockList),r.blockList),l=w(w({},u.limitRate),r.limitRate);return p&&$(navigator)?Promise.reject(Q()):(U(a,e,i),Ne(t),t&&W(g,t)?Promise.reject(q()):(yield K(location.pathname,l,n))?Promise.reject(J()):V("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:a,service_id:e,template_id:i,template_params:t}),{"Content-type":"application/json"}))});var ze=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"};var st=e=>typeof e=="string"?document.querySelector(e):e,je=(e,i,t,o)=>f(null,null,function*(){let r=O(o),a=r.publicKey||u.publicKey,p=r.blockHeadless||u.blockHeadless,n=u.storageProvider||r.storageProvider,g=w(w({},u.blockList),r.blockList),l=w(w({},u.limitRate),r.limitRate);if(p&&$(navigator))return Promise.reject(Q());let D=st(t);U(a,e,i),ze(D);let C=new FormData(D);return W(g,C)?Promise.reject(q()):(yield K(location.pathname,l,n))?Promise.reject(J()):(C.append("lib_version","4.4.1"),C.append("service_id",e),C.append("template_id",i),C.append("user_id",a),V("/api/v1.0/email/send-form",C))});var G={init:Ae,send:Le,sendForm:je,EmailJSResponseStatus:y};var Y=class e{serviceId="service_43xuuch";templateId="template_gdk9gwm";publicKey="LbXW00ITJuOsMEAF1";constructor(){G.init(this.publicKey)}enviarEmailAprobacion(i){return f(this,null,function*(){try{console.log("\u{1F50D} Iniciando env\xEDo de email para especialista:",i);let t={to_name:i.nombre+" "+i.apellido,to_email:i.email,subject:"\xA1Tu cuenta de especialista ha sido aprobada!",message:`
Estimado/a Dr/Dra. ${i.nombre} ${i.apellido},

\xA1Excelentes noticias! Tu cuenta de especialista en Cl\xEDnica Iglesias ha sido aprobada por nuestro equipo de administraci\xF3n.

Ya puedes acceder a la plataforma con tus credenciales y comenzar a:
- Gestionar tus horarios de atenci\xF3n
- Recibir y confirmar turnos de pacientes
- Acceder a tu panel de especialista

Para ingresar, visita: https://clinica-online-b51f0.web.app/login

\xA1Bienvenido/a al equipo de Cl\xEDnica Iglesias!

Saludos cordiales,
Equipo de Administraci\xF3n
        `,clinica_name:"Cl\xEDnica Iglesias"};console.log("\u{1F4E7} Par\xE1metros del template:",t),console.log("\u{1F527} Configuraci\xF3n EmailJS:",{serviceId:this.serviceId,templateId:this.templateId,publicKey:this.publicKey});let o=yield G.send(this.serviceId,this.templateId,t);return console.log("\u2705 Email enviado exitosamente:",o),!0}catch(t){return console.error("\u274C Error enviando email:",t),console.error("\u274C Detalles del error:",{message:t.message,status:t.status,text:t.text}),!1}})}enviarEmailPrueba(){return f(this,null,function*(){try{console.log("\u{1F9EA} Enviando email de prueba...");let i={to_name:"Usuario Test",to_email:"ahea5ofcu2@daouse.com",subject:"Prueba de EmailJS",message:"Este es un email de prueba para verificar la configuraci\xF3n.",clinica_name:"Cl\xEDnica Iglesias"},t=yield G.send(this.serviceId,this.templateId,i);return console.log("\u2705 Email de prueba enviado:",t),!0}catch(i){return console.error("\u274C Error en email de prueba:",i),!1}})}static \u0275fac=function(t){return new(t||e)};static \u0275prov=ne({token:e,factory:e.\u0275fac,providedIn:"root"})};var lt=()=>[],ct=()=>["/register"],dt=()=>["/admin/informes"];function ut(e,i){if(e&1&&le(0,"img",18),e&2){let t=h().$implicit;_("src",t.imagen1,ae)}}function mt(e,i){if(e&1&&(c(0,"p")(1,"strong"),d(2,"Aprobado:"),s(),d(3),s()),e&2){let t=h().$implicit;m(3),T(" ",t.aprobado?"S\xED":"No")}}function ft(e,i){if(e&1){let t=E();c(0,"button",21),b("click",function(){R(t);let r=h(2).$implicit,a=h();return k(a.cambiarEstadoEspecialista(r.uid,!0))}),d(1,"Habilitar"),s()}}function ht(e,i){if(e&1){let t=E();c(0,"button",3),b("click",function(){R(t);let r=h(2).$implicit,a=h();return k(a.cambiarEstadoEspecialista(r.uid,!1))}),d(1,"Inhabilitar"),s()}}function pt(e,i){if(e&1&&(x(0),v(1,ft,2,0,"button",19)(2,ht,2,0,"button",20),S()),e&2){let t=h().$implicit;m(),_("ngIf",!t.aprobado),m(),_("ngIf",t.aprobado)}}function gt(e,i){if(e&1){let t=E();x(0),c(1,"button",21),b("click",function(){R(t);let r=h().$implicit,a=h();return k(a.verHistorialClinico(r))}),d(2," Ver Historial Cl\xEDnico "),s(),S()}}function _t(e,i){if(e&1){let t=E();x(0),c(1,"button",22),b("click",function(){R(t);let r=h().$implicit,a=h();return k(a.descargarTurnosPDF(r))}),d(2," Descargar Turnos PDF "),s(),S()}}function yt(e,i){if(e&1){let t=E();c(0,"div",7)(1,"div",8),v(2,ut,1,1,"img",9),c(3,"div",10)(4,"div",11)(5,"span",12),d(6),F(7,"capitalize"),F(8,"capitalize"),s(),c(9,"button",13),b("click",function(){let r=R(t).$implicit,a=h();return k(a.toggleFavorito(r))}),c(10,"mat-icon"),d(11),s()()(),c(12,"span",14),d(13,"Email:"),s(),c(14,"span",15),d(15),s()()(),c(16,"p")(17,"strong"),d(18,"DNI:"),s(),d(19),F(20,"dniFormat"),s(),c(21,"p")(22,"strong"),d(23,"Rol:"),s(),d(24),F(25,"rolLegible"),s(),v(26,mt,4,1,"p",16),c(27,"div",17),v(28,pt,3,2,"ng-container",16)(29,gt,3,0,"ng-container",16)(30,_t,3,0,"ng-container",16),s()()}if(e&2){let t=i.$implicit;m(2),_("ngIf",t.imagen1),m(4),ce("",M(7,12,t.nombre)," ",M(8,14,t.apellido)),m(3),se("aria-label","Favorito"),m(2),Z(t.favorito?"favorite":"favorite_border"),m(4),Z(t.email),m(4),T(" ",M(20,16,t.dni)),m(5),T(" ",M(25,18,t.rol)),m(2),_("ngIf",t.rol==="especialista"),m(2),_("ngIf",t.rol==="especialista"),m(),_("ngIf",t.rol==="paciente"),m(),_("ngIf",t.rol!=="admin")}}var Ve=class e{firestore=P(we);dialog=P(Se);emailService=P(Y);snackBar=P(Re);usuarios$=Ce(te(this.firestore,"usuarios"),{idField:"uid"});cambiarEstadoEspecialista(i,t){return f(this,null,function*(){try{let o=ie(this.firestore,`usuarios/${i}`);if(yield oe(o,{aprobado:t}),t){let a=(yield X(this.usuarios$)).find(p=>p.uid===i);a&&a.email?(this.snackBar.open("Enviando email de notificaci\xF3n...","\u2713 Entendido",{duration:2500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),(yield this.emailService.enviarEmailAprobacion(a))?this.snackBar.open(`Especialista aprobado y email enviado a ${a.email}`,"\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}):this.snackBar.open(`Especialista aprobado, pero fall\xF3 el env\xEDo del email a ${a.email}`,"\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})):this.snackBar.open("Especialista aprobado","\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}else this.snackBar.open("Especialista desaprobado","\u2713 Entendido",{duration:4500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}catch(o){console.error("Error al cambiar estado del especialista:",o),this.snackBar.open("Error al cambiar el estado del especialista","\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}})}probarEmail(){return f(this,null,function*(){console.log("\u{1F9EA} Probando env\xEDo de email..."),(yield this.emailService.enviarEmailPrueba())?this.snackBar.open("Email de prueba enviado","\u2713 Entendido",{duration:3e3,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}):this.snackBar.open("Error al enviar email de prueba","\u2713 Entendido",{duration:3e3,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})})}verHistorialClinico(i){this.dialog.open(Ee,{width:"600px",data:{paciente:{uid:i.uid,nombre:i.nombre,apellido:i.apellido}}})}descargarExcel(){return f(this,null,function*(){let t=(yield X(this.usuarios$)).map(n=>({Nombre:n.nombre,Apellido:n.apellido,Email:n.email,Rol:n.rol,Especialidad:Array.isArray(n.especialidad)?n.especialidad.join(", "):n.especialidad||"",ObraSocial:n.obraSocial||"",Aprobado:n.aprobado!==void 0?n.aprobado?"S\xED":"No":""})),o=new Ue.default.Workbook,r=o.addWorksheet("Usuarios");r.columns=Object.keys(t[0]).map(n=>({header:n,key:n,width:20})),r.getRow(1).eachCell(n=>{n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"8E24AA"}},n.font={bold:!0,color:{argb:"FFFFFF"}},n.alignment={vertical:"middle",horizontal:"center"},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),t.forEach(n=>{r.addRow(n).eachCell(l=>{l.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},l.alignment={vertical:"middle",horizontal:"left",wrapText:!0}})}),r.columns.forEach((n,g)=>{let l=n.header?n.header.toString().length:10;r.eachRow(D=>{let C=D.getCell(g+1),Qe=C.value?C.value.toString():"";l=Math.max(l,Qe.length+2)}),n.width=l});let a=yield o.xlsx.writeBuffer(),p=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,$e.saveAs)(p,"Usuarios.xlsx")})}toggleFavorito(i){return f(this,null,function*(){let t=ie(this.firestore,`usuarios/${i.uid}`);yield oe(t,{favorito:!i.favorito})})}descargarTurnosPDF(i){return f(this,null,function*(){let t=i.rol==="paciente",o=t?"pacienteUid":"especialistaUid",a=(yield ve(be(te(this.firestore,"turnos"),De(o,"==",i.uid)))).docs.map(l=>l.data());if(a=a.sort((l,D)=>new Date(D.fecha).getTime()-new Date(l.fecha).getTime()),a.length===0){alert("No hay turnos para este usuario.");return}let p=a.map(l=>[l.fecha?new Date(l.fecha).toLocaleString():"",l.especialidad||"",l.especialistaNombre||"",l.pacienteNombre||"",l.estado||"",l.comentarioCancelacion||"",l.resena||""]),n=t?[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]]:[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]],g=new Te;g.setFontSize(16),g.text("Turnos de "+i.nombre+" "+i.apellido,14,18),Fe(g,{startY:24,head:n,body:p,styles:{fontSize:10},headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}}),g.save(`Turnos-${i.nombre}-${i.apellido}.pdf`)})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=N({type:e,selectors:[["app-admin-usuarios"]],decls:15,vars:8,consts:[[1,"admin-usuarios-container"],[2,"margin-bottom","1rem"],["mat-raised-button","","color","accent",2,"margin-right","1rem",3,"click"],["mat-raised-button","","color","warn",3,"click"],[1,"usuarios-lista"],["class","usuario-card",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"botonRegistrar",3,"routerLink"],[1,"usuario-card"],[1,"usuario-header"],["alt","Foto de perfil","class","usuario-avatar",3,"src",4,"ngIf"],[1,"usuario-nombre-fav"],[1,"nombre-fav-row"],[1,"nombre"],["mat-icon-button","","color","warn",3,"click"],[1,"email-label"],[1,"email-value"],[4,"ngIf"],[1,"acciones"],["alt","Foto de perfil",1,"usuario-avatar",3,"src"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(t,o){t&1&&(c(0,"div",0)(1,"h2"),d(2,"Gesti\xF3n de Usuarios"),s(),c(3,"div",1)(4,"button",2),b("click",function(){return o.descargarExcel()}),d(5," Descargar Excel de Usuarios "),s(),c(6,"button",3),b("click",function(){return o.probarEmail()}),d(7," \u{1F9EA} Probar Email "),s()(),c(8,"div",4),v(9,yt,31,20,"div",5),F(10,"async"),s(),c(11,"button",6),d(12," Crear nuevo usuario "),s(),c(13,"button",6),d(14," Informes "),s()()),t&2&&(m(9),_("ngForOf",M(10,3,o.usuarios$)||L(5,lt)),m(2),_("routerLink",L(6,ct)),m(2),_("routerLink",L(7,dt)))},dependencies:[fe,de,ue,me,Pe,_e,ge,pe,he,xe,ke,Me,z,j],styles:[".admin-usuarios-container[_ngcontent-%COMP%]{background:var(--bg-color);min-height:100vh;padding:1rem;margin:0;color:var(--text-color)}table[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.botonRegistrar[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.5rem}.usuarios-lista[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-top:1.5rem;justify-content:center}.usuario-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem;display:flex;flex-direction:column;justify-content:space-between;color:var(--text-color);transition:transform .2s ease;min-width:320px;max-width:420px}.usuario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.usuario-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem;color:var(--text-color)}.usuario-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.usuario-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}.usuario-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]{flex:1 1 auto;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{margin-left:1rem;align-self:center}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-label[_ngcontent-%COMP%]{display:block;margin:.2rem 0 0;font-size:.95rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-value[_ngcontent-%COMP%]{display:block;font-size:.95rem;width:100%;word-break:break-all;color:var(--text-color);margin-bottom:.2rem}.usuario-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid rgba(142,36,170,.2666666667)}.usuario-nombre[_ngcontent-%COMP%]{display:flex;flex-direction:column}.usuario-nombre[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem}.usuario-nombre[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.95rem}"]})};export{Ve as AdminUsuarios};
