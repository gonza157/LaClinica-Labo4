import"./chunk-GGQ7LRWG.js";import{b as R,d as ee,g as se,h as ce,j as H,k as le}from"./chunk-NCCTCGH3.js";import"./chunk-ILEKHQIY.js";import{a as oe}from"./chunk-C26LUPDX.js";import{a as z,g as G,l as Q}from"./chunk-22RZQUIB.js";import"./chunk-WQE3SN5C.js";import{E as Z,Y as re}from"./chunk-OFOXLQEH.js";import{Ab as k,Bb as V,Cb as Y,Eb as y,Gb as C,Hb as c,Jc as U,Kc as W,Oa as F,Pc as B,Qa as r,Tb as w,Vb as g,Wb as j,Yb as A,Yd as te,_ as I,ab as $,ad as q,ae as ie,bc as N,bd as X,be as _,ce as ne,dd as J,de as ae,ea as v,ee as O,fa as D,gb as b,ge as E,id as K,je as P,xb as d,yb as o,zb as s}from"./chunk-SR5OJR6W.js";import{a as S,b as L,h as f}from"./chunk-FJYW2LMB.js";function ue(a,t){if(a&1){let e=y();o(0,"button",11),C("click",function(){let n=v(e).$implicit,l=c(2);return D(l.selectedPaciente=n)}),k(1,"img",12),o(2,"span"),g(3),s()()}if(a&2){let e=t.$implicit,i=c(2);w("selected",(i.selectedPaciente==null?null:i.selectedPaciente.uid)===e.uid),r(),d("alt",N("Foto de ",e.nombre))("src",e.imagen1||"assets/paciente.jpg",F),r(2),A("",e.nombre," ",e.apellido)}}function he(a,t){if(a&1&&(o(0,"div")(1,"label",8),g(2,"Pacientes"),s(),o(3,"div",9),b(4,ue,4,7,"button",10),s()()),a&2){let e=c();r(4),d("ngForOf",e.pacientes)}}function fe(a,t){if(a&1){let e=y();o(0,"button",13),C("click",function(){let n=v(e).$implicit,l=c();return l.selectedEspecialista=n,D(l.onEspecialistaChange())}),k(1,"img",12),o(2,"span"),g(3),s()()}if(a&2){let e=t.$implicit,i=c();w("selected",(i.selectedEspecialista==null?null:i.selectedEspecialista.uid)===e.uid),r(),d("alt",N("Foto de ",e.nombre))("src",e.imagen1||"assets/especialista.jpg",F),r(2),A("",e.nombre," ",e.apellido)}}function be(a,t){if(a&1){let e=y();o(0,"div",17)(1,"span",18),g(2),s(),o(3,"button",19),C("click",function(){let n=v(e).$implicit,l=c(2);return l.selectedEspecialidad=n.nombre,D(l.onEspecialidadChange())}),k(4,"img",12),s()()}if(a&2){let e=t.$implicit,i=c(2);r(2),j(e.nombre),r(),w("selected",i.selectedEspecialidad===e.nombre),r(),d("alt",N("Imagen de ",e.nombre))("src",e.imagen?e.imagen:"assets/especialidad-default.png",F)}}function _e(a,t){if(a&1&&(o(0,"div",14)(1,"label",8),g(2,"Especialidades"),s(),o(3,"div",15),b(4,be,5,6,"div",16),s()()),a&2){let e=c();r(4),d("ngForOf",e.especialidadesDelEspecialista)}}function Me(a,t){if(a&1){let e=y();o(0,"button",23),C("click",function(){let n=v(e).$implicit,l=c().$implicit,u=c(2);return u.selectedFecha=l,D(u.selectedHora=n)}),g(1),s()}if(a&2){let e=t.$implicit,i=c().$implicit,n=c(2);w("selected",n.selectedFecha===i&&n.selectedHora===e)("disabled",n.horariosOcupadosPorDia[i].includes(e)),d("disabled",n.horariosOcupadosPorDia[i].includes(e)),r(),A(" ",i," ",n.formatearHoraAMPM(e)," ")}}function Ce(a,t){if(a&1&&(V(0),b(1,Me,2,7,"button",22),Y()),a&2){let e=t.$implicit,i=c(2);r(),d("ngForOf",i.getHorariosParaFecha(e))}}function Oe(a,t){if(a&1&&(o(0,"div")(1,"label",8),g(2,"D\xEDas y horarios:"),s(),o(3,"div",20),b(4,Ce,2,1,"ng-container",21),s()()),a&2){let e=c();r(4),d("ngForOf",e.fechasDisponibles)}}var de=class a{authService=I(re);firestore=I(te);snackBar=I(oe);especialidades=[];especialidadesDelEspecialista=[];especialistas=[];pacientes=[];especialistasFiltrados=[];selectedEspecialidad="";selectedEspecialista=null;selectedPaciente=null;selectedFecha="";selectedHora="";diasSemana=["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];horariosOcupadosPorDia={};user=null;rol="";dias15=[];getHorariosParaFecha=()=>[];fechasDisponibles=[];formatearHoraAMPM(t){let[e,i]=t.split(":").map(Number),n=new Date;return n.setHours(e,i,0,0),n.toLocaleTimeString("es-AR",{hour:"2-digit",minute:"2-digit",hour12:!0})}existeImagen(t){return["especialidad-Cardi\xF3logo infantil.png","especialidad-Dermat\xF3logo.png","especialidad-Ginec\xF3logo.png","especialidad-M\xE9dico Cl\xEDnico.png","especialidad-Obst\xE9tra.png","especialidad-Pediatra.png"].some(i=>t.endsWith(i))}ngOnInit(){return f(this,null,function*(){this.user=this.authService.userSignal(),this.rol=this.user?.rol,yield this.cargarEspecialidades(),yield this.cargarEspecialistas(),this.rol==="admin"&&(this.pacientes=yield this.cargarPacientes())})}estaFechaCompleta(t){let e=this.getHorariosParaFecha(t),i=this.horariosOcupadosPorDia[t]||[];return e.length>0&&e.every(n=>i.includes(n))}cargarEspecialidades(){return f(this,null,function*(){let t=_(this.firestore,"especialidades"),e=yield O(t);this.especialidades=e.docs.map(i=>{let n=i.data(),u=`assets/especialidad-${n.nombre}.png`;return L(S({},n),{imagen:this.existeImagen(u)?u:"assets/especialidad-default.png"})})})}especialistaTieneEspecialidad(t,e){return e?Array.isArray(t.especialidad)?t.especialidad.includes(e):t.especialidad===e:!1}cargarEspecialistas(){return f(this,null,function*(){let t=_(this.firestore,"usuarios"),e=E(t,P("rol","==","especialista")),i=yield O(e);this.especialistas=i.docs.map(n=>n.data()).filter(n=>n.aprobado===!0),this.especialistasFiltrados=this.especialistas})}cargarPacientes(){return f(this,null,function*(){let t=_(this.firestore,"usuarios"),e=E(t,P("rol","==","paciente"));return(yield O(e)).docs.map(n=>S({uid:n.id},n.data()))})}onEspecialidadChange(){return f(this,null,function*(){if(this.selectedFecha="",this.selectedHora="",this.fechasDisponibles=[],this.dias15=[],this.horariosOcupadosPorDia={},this.selectedEspecialista){let p=Array.isArray(this.selectedEspecialista.especialidad)?this.selectedEspecialista.especialidad:[this.selectedEspecialista.especialidad];this.especialidadesDelEspecialista=this.especialidades.filter(m=>p.includes(m.nombre))}else this.especialidadesDelEspecialista=[];if(!this.selectedEspecialista||!this.selectedEspecialidad)return;let t=ne(this.firestore,"usuarios",this.selectedEspecialista.uid),e=yield ae(t);if(!e.exists()){this.snackBar.open("No se encontr\xF3 el especialista en Firebase.","Cerrar",{duration:2e3});return}let n=e.data()?.horarios?.[this.selectedEspecialidad]||[];if(!n.length){this.snackBar.open("No hay horarios configurados para esta especialidad.","Cerrar",{duration:2e3});return}let l=new Date;this.dias15=[];for(let p=0;p<15;p++){let m=new Date(l);m.setDate(m.getDate()+p);let h=this.diasSemana[m.getDay()],M=m.toISOString().slice(0,10),T=n.filter(x=>x.startsWith(h)).map(x=>x.split(" ")[1]);T.length>0&&(this.dias15.push({fecha:M,dia:h,horas:T}),this.horariosOcupadosPorDia[M]=[])}this.fechasDisponibles=this.dias15.map(p=>p.fecha);let u=_(this.firestore,"turnos");(yield O(E(u,P("especialistaUid","==",this.selectedEspecialista.uid)))).docs.forEach(p=>{let m=p.data();if(m.estado==="cancelado"||m.estado==="rechazado")return;let[h,M]=m.fecha.split(" ");this.horariosOcupadosPorDia[h]&&this.horariosOcupadosPorDia[h].push(M)}),this.getHorariosParaFecha=p=>(this.dias15.find(h=>h.fecha===p)?.horas||[]).slice().sort((h,M)=>{let[T,x]=h.split(":").map(Number),[me,ge]=M.split(":").map(Number);return T*60+x-(me*60+ge)})})}onEspecialistaChange(){return f(this,null,function*(){if(this.selectedEspecialidad="",this.selectedFecha="",this.selectedHora="",this.fechasDisponibles=[],this.dias15=[],this.horariosOcupadosPorDia={},this.selectedEspecialista){let t=Array.isArray(this.selectedEspecialista.especialidad)?this.selectedEspecialista.especialidad:[this.selectedEspecialista.especialidad];this.especialidadesDelEspecialista=this.especialidades.filter(e=>t.includes(e.nombre))}else this.especialidadesDelEspecialista=[]})}onFechaChange(){this.selectedHora=""}solicitarTurno(){return f(this,null,function*(){if(!this.selectedEspecialidad||!this.selectedEspecialista||!this.selectedFecha||!this.selectedHora){this.snackBar.open("Completa todos los campos","Cerrar",{duration:2e3});return}let t=this.rol==="admin"?this.selectedPaciente:this.user;if(!t){this.snackBar.open("Selecciona un paciente","Cerrar",{duration:2e3});return}let e=_(this.firestore,"turnos"),i=E(e,P("pacienteUid","==",t.uid),P("especialistaUid","==",this.selectedEspecialista.uid));if((yield O(i)).docs.find(u=>u.data().fecha?.split(" ")[0]===this.selectedFecha)){this.snackBar.open("Ya tienes un turno con este especialista para ese d\xEDa.","Cerrar",{duration:2500});return}yield ie(_(this.firestore,"turnos"),{pacienteUid:t.uid,pacienteNombre:t.nombre+" "+t.apellido,especialistaUid:this.selectedEspecialista.uid,especialistaNombre:this.selectedEspecialista.nombre+" "+this.selectedEspecialista.apellido,especialidad:this.selectedEspecialidad,fecha:this.selectedFecha+" "+this.selectedHora,estado:"pendiente"}),this.snackBar.open("Turno solicitado correctamente","Cerrar",{duration:2e3}),this.selectedEspecialidad="",this.selectedEspecialista=null,this.selectedPaciente=null,this.selectedFecha="",this.selectedHora="",this.fechasDisponibles=[],this.dias15=[],this.horariosOcupadosPorDia={}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=$({type:a,selectors:[["app-solicitar-turno"]],decls:15,vars:5,consts:[[1,"solicitar-turno-main-container"],[1,"solicitar-turno-card"],[3,"ngSubmit"],[4,"ngIf"],[1,"especialistas-grid"],["type","button","class","especialista-btn",3,"selected","click",4,"ngFor","ngForOf"],["class","especialidad-row",4,"ngIf"],["type","submit",1,"btn-solicitar"],[1,"label-section"],[1,"pacientes-grid"],["type","button","class","paciente-btn",3,"selected","click",4,"ngFor","ngForOf"],["type","button",1,"paciente-btn",3,"click"],[3,"src","alt"],["type","button",1,"especialista-btn",3,"click"],[1,"especialidad-row"],[1,"especialidades-grid"],["class","especialidad-btn-container",4,"ngFor","ngForOf"],[1,"especialidad-btn-container"],[1,"especialidad-nombre"],["type","button",1,"especialidad-btn",3,"click"],[1,"horarios-disponibles"],[4,"ngFor","ngForOf"],["type","button",3,"selected","disabled","click",4,"ngFor","ngForOf"],["type","button",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"div")(1,"div",0)(2,"mat-card",1)(3,"h2"),g(4,"Solicitar Turno"),s(),o(5,"form",2),C("ngSubmit",function(){return i.solicitarTurno()}),b(6,he,5,1,"div",3),o(7,"label"),g(8,"Especialistas"),s(),o(9,"div",4),b(10,fe,4,7,"button",5),s(),b(11,_e,5,1,"div",6)(12,Oe,5,1,"div",3),o(13,"button",7),g(14,"Solicitar Turno"),s()()()()()),e&2&&(d("@fadeIn",void 0),r(6),d("ngIf",i.rol==="admin"),r(4),d("ngForOf",i.especialistasFiltrados),r(),d("ngIf",i.selectedEspecialista),r(),d("ngIf",i.selectedEspecialista&&i.selectedEspecialidad))},dependencies:[G,z,Q,ee,Z,K,J,q,X,B,U,W,R],styles:[".solicitar-turno-main-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}.solicitar-turno-card[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:2rem;width:700px;margin:2rem auto;text-align:center}.solicitar-turno-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1.5rem;color:var(--button-bg)}.solicitar-turno-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.2rem;align-items:stretch}.solicitar-turno-card[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{text-align:left;margin-bottom:.2rem;color:var(--text-color, #222);font-weight:500}.solicitar-turno-card[_ngcontent-%COMP%]   .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.disabled), .solicitar-turno-card[_ngcontent-%COMP%]   .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(.disabled){background:#333;border-color:#8e24aa88}.solicitar-turno-card[_ngcontent-%COMP%]   .dias-disponibles[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%], .solicitar-turno-card[_ngcontent-%COMP%]   .horarios-disponibles[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background:#8e24aa;color:#fff;border-color:#fff}.solicitar-turno-card[_ngcontent-%COMP%]   .horarios-disponibles[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:.7rem .7rem;margin-bottom:1rem}.solicitar-turno-card[_ngcontent-%COMP%]   .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:0}.solicitar-turno-card[_ngcontent-%COMP%]   .btn-solicitar[_ngcontent-%COMP%]{margin-top:1.5rem;background:linear-gradient(45deg,#8e24aa,#e040fb);color:#fff;padding:.8rem 1rem;border:none;border-radius:6px;font-weight:700;font-size:1rem;transition:all .3s ease}.solicitar-turno-card[_ngcontent-%COMP%]   .btn-solicitar[_ngcontent-%COMP%]:hover{opacity:.9}.paciente-label[_ngcontent-%COMP%]{text-align:left;display:block;margin-bottom:.5rem;margin-left:.2rem;font-weight:600;color:var(--text-color, #222)}button.disabled[_ngcontent-%COMP%], button[_ngcontent-%COMP%]:disabled{background:#ccc!important;color:#888!important;cursor:not-allowed!important}.especialistas-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem;margin-bottom:1.5rem}.especialista-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;border:2px solid transparent;border-radius:12px;background:var(--bg-color, #222);color:var(--button-text, #eee);padding:1rem .5rem .5rem;cursor:pointer;transition:all .3s;height:150px;width:150px}.especialista-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:76px;height:76px;border-radius:50%;object-fit:cover;margin-bottom:.5rem;border:2px solid rgba(142,36,170,.2666666667);background:#fff}.especialista-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;text-align:center;margin-top:.3rem;color:#fff}.especialista-btn[_ngcontent-%COMP%]:hover:not(:disabled), .especialista-btn.selected[_ngcontent-%COMP%]{border-color:#8e24aa;background:#3a1850}.especialista-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.especialidad-row[_ngcontent-%COMP%]{display:grid;gap:2rem;margin-bottom:1.5rem}.especialidad-label[_ngcontent-%COMP%]{min-width:120px;font-weight:600;color:var(--text-color, #222);margin-top:.5rem}.especialidades-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1.5rem;margin-bottom:1.5rem}.especialidad-btn-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.especialidad-nombre[_ngcontent-%COMP%]{margin-bottom:.3rem;font-weight:500;color:var(--text-color, #222)}.especialidad-btn[_ngcontent-%COMP%]{width:190px;height:100px;border-radius:14px;border:2px solid transparent;background:#222;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:border .2s,background .2s;padding:0;margin-bottom:.2rem}.especialidad-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:76px;height:76px;object-fit:cover;border-radius:10px;background:#fff}.especialidad-btn.selected[_ngcontent-%COMP%]{border-color:#8e24aa;background:#3a1850}.horarios-disponibles[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:.7rem .7rem;margin-bottom:1rem}.horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;min-width:105px;min-height:105px;border-radius:10px}.pacientes-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:1rem;margin-bottom:1.5rem}.paciente-btn[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;border:2px solid transparent;border-radius:12px;background:var(--bg-color, #222);color:var(--button-text, #eee);padding:1rem .5rem .5rem;cursor:pointer;transition:all .3s;height:160px;width:160px}.paciente-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:76px;height:76px;border-radius:50%;object-fit:cover;margin-bottom:.5rem;border:2px solid rgba(142,36,170,.2666666667);background:#fff}.paciente-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;text-align:center;margin-top:.3rem;color:#8e24aa}.paciente-btn[_ngcontent-%COMP%]:hover:not(:disabled), .paciente-btn.selected[_ngcontent-%COMP%]{border-color:#8e24aa;background:#ede7f6}.paciente-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.especialista-btn[_ngcontent-%COMP%], .especialidad-btn[_ngcontent-%COMP%], .paciente-btn[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:var(--card-bg);border:2px solid #8e24aa;gap:.5rem;cursor:pointer;transition:box-shadow .2s,border .2s,background .2s;box-shadow:0 2px 8px #0002;color:var(--text-color)}.especialista-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .especialista-btn[_ngcontent-%COMP%]   .especialidad-nombre[_ngcontent-%COMP%], .especialidad-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .especialidad-btn[_ngcontent-%COMP%]   .especialidad-nombre[_ngcontent-%COMP%], .paciente-btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .paciente-btn[_ngcontent-%COMP%]   .especialidad-nombre[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .especialidad-nombre[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .especialidad-nombre[_ngcontent-%COMP%]{font-size:.95rem;color:#8e24aa;font-weight:600;text-align:center}.especialista-btn[_ngcontent-%COMP%]:hover:not(:disabled):not(.disabled), .especialidad-btn[_ngcontent-%COMP%]:hover:not(:disabled):not(.disabled), .paciente-btn[_ngcontent-%COMP%]:hover:not(:disabled):not(.disabled), .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled):not(.disabled), .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled):not(.disabled){box-shadow:0 4px 16px #8e24aa44;border:2.5px solid #6a1b9a;background:#f3e5f5}.especialista-btn.selected[_ngcontent-%COMP%], .especialidad-btn.selected[_ngcontent-%COMP%], .paciente-btn.selected[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{border-color:#8e24aa;background:#ede7f6;color:#6a1b9a}.especialista-btn.disabled[_ngcontent-%COMP%], .especialista-btn[_ngcontent-%COMP%]:disabled, .especialidad-btn.disabled[_ngcontent-%COMP%], .especialidad-btn[_ngcontent-%COMP%]:disabled, .paciente-btn.disabled[_ngcontent-%COMP%], .paciente-btn[_ngcontent-%COMP%]:disabled, .horarios-disponibles[_ngcontent-%COMP%]   button.disabled[_ngcontent-%COMP%], .horarios-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .dias-disponibles[_ngcontent-%COMP%]   button.disabled[_ngcontent-%COMP%], .dias-disponibles[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#ccc!important;color:#888!important;border-color:#666!important;cursor:not-allowed!important;box-shadow:none}.label-section[_ngcontent-%COMP%]{display:block;text-align:left;margin-bottom:.7rem;margin-left:.2rem;font-weight:600;color:var(--text-color, #222)}"],data:{animation:[se("fadeIn",[le(":enter",[H({opacity:0,transform:"translateY(30px)"}),ce("3000ms ease",H({opacity:1,transform:"none"}))])])]}})};export{de as SolicitarTurno};
