import{a as ke,b as xe}from"./chunk-QLTCTTX5.js";import{d as te}from"./chunk-CZIAEIMA.js";import{a as pe}from"./chunk-W2LONUKG.js";import{a as _e,b as ge}from"./chunk-UE7YZPCJ.js";import{a as ye}from"./chunk-4WUXS4KB.js";import"./chunk-FK6H3RFT.js";import{e as fe,f as me}from"./chunk-UQXX2G4H.js";import{c as he}from"./chunk-KYJNGL4I.js";import{c as ue}from"./chunk-UI2J3IFV.js";import{B as ie,D as oe,E as ne,I as re,u as L}from"./chunk-X7NSQYYE.js";import{$d as se,Ab as G,Bb as v,Cb as D,Eb as b,Gb as g,Hb as f,Jc as J,Kc as X,Mc as Z,Oa as q,Pc as ee,Qa as d,V as W,Vb as c,Vd as j,W as M,Wb as H,Wd as U,Xb as R,Yb as Y,Yd as V,Zd as ae,_ as S,ab as T,bb as F,db as O,dc as P,ea as w,ec as k,fa as C,fc as x,fe as le,gb as h,he as ce,ke as de,n as B,ub as K,xb as m,yb as a,zb as n}from"./chunk-7XCQR3O2.js";import{f as Q,h as _}from"./chunk-FJYW2LMB.js";var we=(()=>{class t{static \u0275fac=function(s){return new(s||t)};static \u0275mod=F({type:t});static \u0275inj=M({imports:[re]})}return t})();var Ce=(()=>{class t{static \u0275fac=function(s){return new(s||t)};static \u0275mod=F({type:t});static \u0275inj=M({imports:[L,we,L]})}return t})();var De=Q(ke()),be=Q(xe());var I=class t{transform(i){return(i?i.toString():"").replace(/(\d{2,3})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=O({name:"dniFormat",type:t,pure:!0})};var N=class t{transform(i){switch(i){case"admin":return"Administrador";case"especialista":return"Especialista";case"paciente":return"Paciente";default:return i}}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=O({name:"rolLegible",type:t,pure:!0})};var A=class t{enviarEmailAprobacion(i){return _(this,null,function*(){try{let l=yield(yield fetch("https://us-central1-clinica-online-da668.cloudfunctions.net/enviarEmailAprobacion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i.email,nombre:i.nombre,apellido:i.apellido})})).json();return l.success?!0:(console.error("Error en el servidor:",l.error),!1)}catch(e){return console.error("Error enviando email:",e),!1}})}static \u0275fac=function(e){return new(e||t)};static \u0275prov=W({token:t,factory:t.\u0275fac,providedIn:"root"})};var ze=()=>[],Be=()=>["/register"],He=()=>["/admin/informes"];function Le(t,i){if(t&1&&G(0,"img",16),t&2){let e=f().$implicit;m("src",e.imagen1,q)}}function je(t,i){if(t&1&&(a(0,"p")(1,"strong"),c(2,"Aprobado:"),n(),c(3),n()),t&2){let e=f().$implicit;d(3),R(" ",e.aprobado?"S\xED":"No")}}function Ue(t,i){if(t&1){let e=b();a(0,"button",19),g("click",function(){w(e);let l=f(2).$implicit,r=f();return C(r.cambiarEstadoEspecialista(l.uid,!0))}),c(1,"Habilitar"),n()}}function Ve(t,i){if(t&1){let e=b();a(0,"button",20),g("click",function(){w(e);let l=f(2).$implicit,r=f();return C(r.cambiarEstadoEspecialista(l.uid,!1))}),c(1,"Inhabilitar"),n()}}function $e(t,i){if(t&1&&(v(0),h(1,Ue,2,0,"button",17)(2,Ve,2,0,"button",18),D()),t&2){let e=f().$implicit;d(),m("ngIf",!e.aprobado),d(),m("ngIf",e.aprobado)}}function Qe(t,i){if(t&1){let e=b();v(0),a(1,"button",19),g("click",function(){w(e);let l=f().$implicit,r=f();return C(r.verHistorialClinico(l))}),c(2," Ver Historial Cl\xEDnico "),n(),D()}}function We(t,i){if(t&1){let e=b();v(0),a(1,"button",21),g("click",function(){w(e);let l=f().$implicit,r=f();return C(r.descargarTurnosPDF(l))}),c(2," Descargar Turnos PDF "),n(),D()}}function qe(t,i){if(t&1){let e=b();a(0,"div",5)(1,"div",6),h(2,Le,1,1,"img",7),a(3,"div",8)(4,"div",9)(5,"span",10),c(6),k(7,"capitalize"),k(8,"capitalize"),n(),a(9,"button",11),g("click",function(){let l=w(e).$implicit,r=f();return C(r.toggleFavorito(l))}),a(10,"mat-icon"),c(11),n()()(),a(12,"span",12),c(13,"Email:"),n(),a(14,"span",13),c(15),n()()(),a(16,"p")(17,"strong"),c(18,"DNI:"),n(),c(19),k(20,"dniFormat"),n(),a(21,"p")(22,"strong"),c(23,"Rol:"),n(),c(24),k(25,"rolLegible"),n(),h(26,je,4,1,"p",14),a(27,"div",15),h(28,$e,3,2,"ng-container",14)(29,Qe,3,0,"ng-container",14)(30,We,3,0,"ng-container",14),n()()}if(t&2){let e=i.$implicit;d(2),m("ngIf",e.imagen1),d(4),Y("",x(7,12,e.nombre)," ",x(8,14,e.apellido)),d(3),K("aria-label","Favorito"),d(2),H(e.favorito?"favorite":"favorite_border"),d(4),H(e.email),d(4),R(" ",x(20,16,e.dni)),d(5),R(" ",x(25,18,e.rol)),d(2),m("ngIf",e.rol==="especialista"),d(2),m("ngIf",e.rol==="especialista"),d(),m("ngIf",e.rol==="paciente"),d(),m("ngIf",e.rol!=="admin")}}var ve=class t{firestore=S(ae);dialog=S(he);emailService=S(A);snackBar=S(ue);usuarios$=se(j(this.firestore,"usuarios"),{idField:"uid"});cambiarEstadoEspecialista(i,e){return _(this,null,function*(){try{let s=U(this.firestore,`usuarios/${i}`);if(yield V(s,{aprobado:e}),e){let r=(yield B(this.usuarios$)).find(y=>y.uid===i);r&&r.email?(this.snackBar.open("Enviando email de notificaci\xF3n...","\u2713 Entendido",{duration:2500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),(yield this.emailService.enviarEmailAprobacion(r))?this.snackBar.open(`Especialista aprobado y email enviado a ${r.email}`,"\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}):this.snackBar.open(`Especialista aprobado, pero fall\xF3 el env\xEDo del email a ${r.email}`,"\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})):this.snackBar.open("Especialista aprobado","\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}else this.snackBar.open("Especialista desaprobado","\u2713 Entendido",{duration:4500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}catch(s){console.error("Error al cambiar estado del especialista:",s),this.snackBar.open("Error al cambiar el estado del especialista","\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}})}verHistorialClinico(i){this.dialog.open(pe,{width:"600px",data:{paciente:{uid:i.uid,nombre:i.nombre,apellido:i.apellido}}})}descargarExcel(){return _(this,null,function*(){let e=(yield B(this.usuarios$)).map(o=>({Nombre:o.nombre,Apellido:o.apellido,Email:o.email,Rol:o.rol,Especialidad:Array.isArray(o.especialidad)?o.especialidad.join(", "):o.especialidad||"",ObraSocial:o.obraSocial||"",Aprobado:o.aprobado!==void 0?o.aprobado?"S\xED":"No":""})),s=new De.default.Workbook,l=s.addWorksheet("Usuarios");l.columns=Object.keys(e[0]).map(o=>({header:o,key:o,width:20})),l.getRow(1).eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"8E24AA"}},o.font={bold:!0,color:{argb:"FFFFFF"}},o.alignment={vertical:"middle",horizontal:"center"},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),e.forEach(o=>{l.addRow(o).eachCell(u=>{u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},u.alignment={vertical:"middle",horizontal:"left",wrapText:!0}})}),l.columns.forEach((o,p)=>{let u=o.header?o.header.toString().length:10;l.eachRow(z=>{let $=z.getCell(p+1),Re=$.value?$.value.toString():"";u=Math.max(u,Re.length+2)}),o.width=u});let r=yield s.xlsx.writeBuffer(),y=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,be.saveAs)(y,"Usuarios.xlsx")})}toggleFavorito(i){return _(this,null,function*(){let e=U(this.firestore,`usuarios/${i.uid}`);yield V(e,{favorito:!i.favorito})})}descargarTurnosPDF(i){return _(this,null,function*(){let e=i.rol==="paciente",s=e?"pacienteUid":"especialistaUid",r=(yield le(ce(j(this.firestore,"turnos"),de(s,"==",i.uid)))).docs.map(u=>u.data());if(r=r.sort((u,z)=>new Date(z.fecha).getTime()-new Date(u.fecha).getTime()),r.length===0){alert("No hay turnos para este usuario.");return}let y=r.map(u=>[u.fecha?new Date(u.fecha).toLocaleString():"",u.especialidad||"",u.especialistaNombre||"",u.pacienteNombre||"",u.estado||"",u.comentarioCancelacion||"",u.resena||""]),o=e?[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]]:[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]],p=new _e;p.setFontSize(16),p.text("Turnos de "+i.nombre+" "+i.apellido,14,18),ge(p,{startY:24,head:o,body:y,styles:{fontSize:10},headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}}),p.save(`Turnos-${i.nombre}-${i.apellido}.pdf`)})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=T({type:t,selectors:[["app-admin-usuarios"]],decls:12,vars:8,consts:[[1,"admin-usuarios-container"],["mat-raised-button","","color","accent",2,"margin-bottom","1rem",3,"click"],[1,"usuarios-lista"],["class","usuario-card",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"botonRegistrar",3,"routerLink"],[1,"usuario-card"],[1,"usuario-header"],["alt","Foto de perfil","class","usuario-avatar",3,"src",4,"ngIf"],[1,"usuario-nombre-fav"],[1,"nombre-fav-row"],[1,"nombre"],["mat-icon-button","","color","warn",3,"click"],[1,"email-label"],[1,"email-value"],[4,"ngIf"],[1,"acciones"],["alt","Foto de perfil",1,"usuario-avatar",3,"src"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,s){e&1&&(a(0,"div",0)(1,"h2"),c(2,"Gesti\xF3n de Usuarios"),n(),a(3,"button",1),g("click",function(){return s.descargarExcel()}),c(4," Descargar Excel de Usuarios "),n(),a(5,"div",2),h(6,qe,31,20,"div",3),k(7,"async"),n(),a(8,"button",4),c(9," Crear nuevo usuario "),n(),a(10,"button",4),c(11," Informes "),n()()),e&2&&(d(6),m("ngForOf",x(7,3,s.usuarios$)||P(5,ze)),d(2),m("routerLink",P(6,Be)),d(2),m("routerLink",P(7,He)))},dependencies:[ee,J,X,Z,Ce,ne,oe,ie,te,me,fe,ye,I,N],styles:[".admin-usuarios-container[_ngcontent-%COMP%]{background:var(--bg-color);min-height:100vh;padding:1rem;margin:0;color:var(--text-color)}table[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.botonRegistrar[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.5rem}.usuarios-lista[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-top:1.5rem;justify-content:center}.usuario-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem;display:flex;flex-direction:column;justify-content:space-between;color:var(--text-color);transition:transform .2s ease;min-width:320px;max-width:420px}.usuario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.usuario-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem;color:var(--text-color)}.usuario-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.usuario-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}.usuario-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]{flex:1 1 auto;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{margin-left:1rem;align-self:center}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-label[_ngcontent-%COMP%]{display:block;margin:.2rem 0 0;font-size:.95rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-value[_ngcontent-%COMP%]{display:block;font-size:.95rem;width:100%;word-break:break-all;color:var(--text-color);margin-bottom:.2rem}.usuario-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid rgba(142,36,170,.2666666667)}.usuario-nombre[_ngcontent-%COMP%]{display:flex;flex-direction:column}.usuario-nombre[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem}.usuario-nombre[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.95rem}"]})};export{ve as AdminUsuarios};
