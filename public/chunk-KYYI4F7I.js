import{a as Fe,b as Oe}from"./chunk-QLTCTTX5.js";import{d as se}from"./chunk-E3ALWHAP.js";import{a as ve}from"./chunk-GCIH7YHO.js";import{a as be,b as De}from"./chunk-UE7YZPCJ.js";import{a as Re}from"./chunk-4WUXS4KB.js";import"./chunk-FK6H3RFT.js";import{e as ye,f as we}from"./chunk-UQXX2G4H.js";import{c as Ce}from"./chunk-KYJNGL4I.js";import{c as _e}from"./chunk-UI2J3IFV.js";import{B as le,D as ce,E as de,I as ue,u as Q}from"./chunk-X7NSQYYE.js";import{$d as me,Ab as te,Bb as D,Cb as R,Eb as k,Gb as h,Hb as f,Jc as oe,Kc as ne,Mc as re,Oa as X,Pc as ae,Qa as d,V as J,Va as O,Vb as c,Vd as W,W as T,Wb as $,Wd as q,Xb as x,Yb as ie,Yd as K,Zd as fe,_ as M,ab as P,bb as I,cb as b,db as A,dc as N,ea as C,ec as S,fa as v,fc as E,fe as he,gb as p,he as pe,ib as Z,ke as ge,n as V,ub as ee,va as F,xb as m,yb as l,zb as s}from"./chunk-7XCQR3O2.js";import{f as G,h as _}from"./chunk-FJYW2LMB.js";var ke=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275mod=I({type:i});static \u0275inj=T({imports:[ue]})}return i})();var xe=(()=>{class i{static \u0275fac=function(o){return new(o||i)};static \u0275mod=I({type:i});static \u0275inj=T({imports:[Q,ke,Q]})}return i})();var Ee=G(Fe()),Me=G(Oe());var H=class i{transform(t){return(t?t.toString():"").replace(/(\d{2,3})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=A({name:"dniFormat",type:i,pure:!0})};var B=class i{transform(t){switch(t){case"admin":return"Administrador";case"especialista":return"Especialista";case"paciente":return"Paciente";default:return t}}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=A({name:"rolLegible",type:i,pure:!0})};var z=class i{enviarEmailAprobacion(t){return _(this,null,function*(){try{let r=yield(yield fetch("https://us-central1-clinica-online-da668.cloudfunctions.net/enviarEmailAprobacion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,nombre:t.nombre,apellido:t.apellido})})).json();return r.success?!0:(console.error("Error en el servidor:",r.error),!1)}catch(e){return console.error("Error enviando email:",e),!1}})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=J({token:i,factory:i.\u0275fac,providedIn:"root"})};var L=class i{constructor(t){this.el=t;this.colorOriginal=this.el.nativeElement.style.backgroundColor||""}appResaltarHover="#1976d2";colorOriginal="";onMouseEnter(){this.cambiarColor(this.appResaltarHover)}onMouseLeave(){this.cambiarColor(this.colorOriginal)}cambiarColor(t){this.el.nativeElement.style.backgroundColor=t,this.el.nativeElement.style.transition="background-color 0.3s ease",t===this.appResaltarHover?(this.el.nativeElement.style.transform="scale(1.02)",this.el.nativeElement.style.boxShadow="0 4px 12px rgba(25, 118, 210, 0.3)"):(this.el.nativeElement.style.transform="scale(1)",this.el.nativeElement.style.boxShadow="none")}static \u0275fac=function(e){return new(e||i)(O(F))};static \u0275dir=b({type:i,selectors:[["","appResaltarHover",""]],hostBindings:function(e,o){e&1&&h("mouseenter",function(){return o.onMouseEnter()})("mouseleave",function(){return o.onMouseLeave()})},inputs:{appResaltarHover:"appResaltarHover"}})};var j=class i{constructor(t){this.el=t}appConfirmarAccion="\xBFEst\xE1 seguro de realizar esta acci\xF3n?";confirmarTitulo="Confirmar";accionConfirmada=new Z;onClick(t){t.preventDefault(),t.stopPropagation(),confirm(`${this.confirmarTitulo}

${this.appConfirmarAccion}`)&&this.accionConfirmada.emit()}static \u0275fac=function(e){return new(e||i)(O(F))};static \u0275dir=b({type:i,selectors:[["","appConfirmarAccion",""]],hostBindings:function(e,o){e&1&&h("click",function(a){return o.onClick(a)})},inputs:{appConfirmarAccion:"appConfirmarAccion",confirmarTitulo:"confirmarTitulo"},outputs:{accionConfirmada:"accionConfirmada"}})};var Ue=()=>[],Ve=()=>["/register"],$e=()=>["/admin/informes"];function Qe(i,t){if(i&1&&te(0,"img",16),i&2){let e=f().$implicit;m("src",e.imagen1,X)}}function We(i,t){if(i&1&&(l(0,"p")(1,"strong"),c(2,"Aprobado:"),s(),c(3),s()),i&2){let e=f().$implicit;d(3),x(" ",e.aprobado?"S\xED":"No")}}function qe(i,t){if(i&1){let e=k();l(0,"button",19),h("accionConfirmada",function(){C(e);let r=f(2).$implicit,a=f();return v(a.cambiarEstadoEspecialista(r.uid,!0))}),c(1,"Habilitar"),s()}}function Ke(i,t){if(i&1){let e=k();l(0,"button",20),h("accionConfirmada",function(){C(e);let r=f(2).$implicit,a=f();return v(a.cambiarEstadoEspecialista(r.uid,!1))}),c(1,"Inhabilitar"),s()}}function Ye(i,t){if(i&1&&(D(0),p(1,qe,2,0,"button",17)(2,Ke,2,0,"button",18),R()),i&2){let e=f().$implicit;d(),m("ngIf",!e.aprobado),d(),m("ngIf",e.aprobado)}}function Ge(i,t){if(i&1){let e=k();D(0),l(1,"button",21),h("click",function(){C(e);let r=f().$implicit,a=f();return v(a.verHistorialClinico(r))}),c(2," Ver Historial Cl\xEDnico "),s(),R()}}function Je(i,t){if(i&1){let e=k();D(0),l(1,"button",22),h("click",function(){C(e);let r=f().$implicit,a=f();return v(a.descargarTurnosPDF(r))}),c(2," Descargar Turnos PDF "),s(),R()}}function Xe(i,t){if(i&1){let e=k();l(0,"div",5)(1,"div",6),p(2,Qe,1,1,"img",7),l(3,"div",8)(4,"div",9)(5,"span",10),c(6),S(7,"capitalize"),S(8,"capitalize"),s(),l(9,"button",11),h("click",function(){let r=C(e).$implicit,a=f();return v(a.toggleFavorito(r))}),l(10,"mat-icon"),c(11),s()()(),l(12,"span",12),c(13,"Email:"),s(),l(14,"span",13),c(15),s()()(),l(16,"p")(17,"strong"),c(18,"DNI:"),s(),c(19),S(20,"dniFormat"),s(),l(21,"p")(22,"strong"),c(23,"Rol:"),s(),c(24),S(25,"rolLegible"),s(),p(26,We,4,1,"p",14),l(27,"div",15),p(28,Ye,3,2,"ng-container",14)(29,Ge,3,0,"ng-container",14)(30,Je,3,0,"ng-container",14),s()()}if(i&2){let e=t.$implicit;d(2),m("ngIf",e.imagen1),d(4),ie("",E(7,12,e.nombre)," ",E(8,14,e.apellido)),d(3),ee("aria-label","Favorito"),d(2),$(e.favorito?"favorite":"favorite_border"),d(4),$(e.email),d(4),x(" ",E(20,16,e.dni)),d(5),x(" ",E(25,18,e.rol)),d(2),m("ngIf",e.rol==="especialista"),d(2),m("ngIf",e.rol==="especialista"),d(),m("ngIf",e.rol==="paciente"),d(),m("ngIf",e.rol!=="admin")}}var Se=class i{firestore=M(fe);dialog=M(Ce);emailService=M(z);snackBar=M(_e);usuarios$=me(W(this.firestore,"usuarios"),{idField:"uid"});cambiarEstadoEspecialista(t,e){return _(this,null,function*(){try{let o=q(this.firestore,`usuarios/${t}`);if(yield K(o,{aprobado:e}),e){let a=(yield V(this.usuarios$)).find(w=>w.uid===t);a&&a.email?(this.snackBar.open("Enviando email de notificaci\xF3n...","\u2713 Entendido",{duration:2500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}),(yield this.emailService.enviarEmailAprobacion(a))?this.snackBar.open(`Especialista aprobado y email enviado a ${a.email}`,"\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"}):this.snackBar.open(`Especialista aprobado, pero fall\xF3 el env\xEDo del email a ${a.email}`,"\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})):this.snackBar.open("Especialista aprobado","\u2713 Entendido",{duration:6500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}else this.snackBar.open("Especialista desaprobado","\u2713 Entendido",{duration:4500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}catch(o){console.error("Error al cambiar estado del especialista:",o),this.snackBar.open("Error al cambiar el estado del especialista","\u2713 Entendido",{duration:6500,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"})}})}verHistorialClinico(t){this.dialog.open(ve,{width:"600px",data:{paciente:{uid:t.uid,nombre:t.nombre,apellido:t.apellido}}})}descargarExcel(){return _(this,null,function*(){let e=(yield V(this.usuarios$)).map(n=>({Nombre:n.nombre,Apellido:n.apellido,Email:n.email,Rol:n.rol,Especialidad:Array.isArray(n.especialidad)?n.especialidad.join(", "):n.especialidad||"",ObraSocial:n.obraSocial||"",Aprobado:n.aprobado!==void 0?n.aprobado?"S\xED":"No":""})),o=new Ee.default.Workbook,r=o.addWorksheet("Usuarios");r.columns=Object.keys(e[0]).map(n=>({header:n,key:n,width:20})),r.getRow(1).eachCell(n=>{n.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1976D2"}},n.font={bold:!0,color:{argb:"FFFFFF"}},n.alignment={vertical:"middle",horizontal:"center"},n.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),e.forEach(n=>{r.addRow(n).eachCell(u=>{u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},u.alignment={vertical:"middle",horizontal:"left",wrapText:!0}})}),r.columns.forEach((n,g)=>{let u=n.header?n.header.toString().length:10;r.eachRow(U=>{let Y=U.getCell(g+1),Te=Y.value?Y.value.toString():"";u=Math.max(u,Te.length+2)}),n.width=u});let a=yield o.xlsx.writeBuffer(),w=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,Me.saveAs)(w,"Usuarios.xlsx")})}toggleFavorito(t){return _(this,null,function*(){let e=q(this.firestore,`usuarios/${t.uid}`);yield K(e,{favorito:!t.favorito})})}descargarTurnosPDF(t){return _(this,null,function*(){let e=t.rol==="paciente",o=e?"pacienteUid":"especialistaUid",a=(yield he(pe(W(this.firestore,"turnos"),ge(o,"==",t.uid)))).docs.map(u=>u.data());if(a=a.sort((u,U)=>new Date(U.fecha).getTime()-new Date(u.fecha).getTime()),a.length===0){this.snackBar.open("No hay turnos para este usuario","",{duration:4e3,panelClass:["error-snackbar"],verticalPosition:"top",horizontalPosition:"center"});return}let w=a.map(u=>[u.fecha?new Date(u.fecha).toLocaleString():"",u.especialidad||"",u.especialistaNombre||"",u.pacienteNombre||"",u.estado||"",u.comentarioCancelacion||"",u.resena||""]),n=e?[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]]:[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]],g=new be;g.setFontSize(16),g.text("Turnos de "+t.nombre+" "+t.apellido,14,18),De(g,{startY:24,head:n,body:w,styles:{fontSize:10},headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}}),g.save(`Turnos-${t.nombre}-${t.apellido}.pdf`)})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-admin-usuarios"]],decls:12,vars:8,consts:[[1,"admin-usuarios-container"],["mat-raised-button","",1,"excel-button",3,"click"],[1,"usuarios-lista"],["class","usuario-card",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"botonRegistrar",3,"routerLink"],[1,"usuario-card"],[1,"usuario-header"],["alt","Foto de perfil","class","usuario-avatar",3,"src",4,"ngIf"],[1,"usuario-nombre-fav"],[1,"nombre-fav-row"],[1,"nombre"],["mat-icon-button","","color","warn",3,"click"],[1,"email-label"],[1,"email-value"],[4,"ngIf"],[1,"acciones"],["alt","Foto de perfil",1,"usuario-avatar",3,"src"],["mat-raised-button","","color","primary","appConfirmarAccion","\xBFEst\xE1 seguro de habilitar a este especialista?","confirmarTitulo","Habilitar Especialista","appResaltarHover","#4caf50",3,"accionConfirmada",4,"ngIf"],["mat-raised-button","","color","warn","appConfirmarAccion","\xBFEst\xE1 seguro de inhabilitar a este especialista?","confirmarTitulo","Inhabilitar Especialista","appResaltarHover","#f44336",3,"accionConfirmada",4,"ngIf"],["mat-raised-button","","color","primary","appConfirmarAccion","\xBFEst\xE1 seguro de habilitar a este especialista?","confirmarTitulo","Habilitar Especialista","appResaltarHover","#4caf50",3,"accionConfirmada"],["mat-raised-button","","color","warn","appConfirmarAccion","\xBFEst\xE1 seguro de inhabilitar a este especialista?","confirmarTitulo","Inhabilitar Especialista","appResaltarHover","#f44336",3,"accionConfirmada"],["mat-raised-button","","color","primary","appResaltarHover","#1976d2",3,"click"],["mat-raised-button","","color","accent","appResaltarHover","#ff5722",3,"click"]],template:function(e,o){e&1&&(l(0,"div",0)(1,"h2"),c(2,"Gesti\xF3n de Usuarios"),s(),l(3,"button",1),h("click",function(){return o.descargarExcel()}),c(4," Descargar Excel de Usuarios "),s(),l(5,"div",2),p(6,Xe,31,20,"div",3),S(7,"async"),s(),l(8,"button",4),c(9," Crear nuevo usuario "),s(),l(10,"button",4),c(11," Informes "),s()()),e&2&&(d(6),m("ngForOf",E(7,3,o.usuarios$)||N(5,Ue)),d(2),m("routerLink",N(6,Ve)),d(2),m("routerLink",N(7,$e)))},dependencies:[ae,oe,ne,re,xe,de,ce,le,se,we,ye,Re,H,B,L,j],styles:[".admin-usuarios-container[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e3f2fd,#bbdefb,#90caf9);min-height:100vh;padding:1rem;margin:0;color:#333}.admin-usuarios-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1976d2;margin-bottom:1.5rem;font-weight:600}.admin-usuarios-container[_ngcontent-%COMP%]   .excel-button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5)!important;color:#fff!important;border:none;margin-bottom:1rem;transition:all .3s ease;box-shadow:0 2px 8px #1976d24d}.admin-usuarios-container[_ngcontent-%COMP%]   .excel-button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#1565c0,#1e88e5)!important;transform:translateY(-2px);box-shadow:0 4px 15px #1976d266}table[_ngcontent-%COMP%]{width:100%;margin-top:1rem;border-collapse:separate;border-spacing:0;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #1976d233;background:#fff}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5);color:#fff;font-weight:600;padding:1rem;text-align:left}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem;border-bottom:1px solid rgba(25,118,210,.1)}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#1976d20d}.botonRegistrar[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.5rem;background:linear-gradient(135deg,#1976d2,#42a5f5);color:#fff;border:none}.usuarios-lista[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-top:1.5rem;justify-content:center}.usuario-card[_ngcontent-%COMP%]{background:#fff;box-shadow:0 4px 16px #1976d233;border-radius:18px;padding:1.5rem;display:flex;flex-direction:column;justify-content:space-between;color:#333;transition:transform .2s ease;min-width:320px;max-width:420px}.usuario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.usuario-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem;color:#1976d2}.usuario-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.usuario-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}.usuario-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5);color:#fff;border:none}.usuario-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]{flex:1 1 auto;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#1976d2}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{margin-left:1rem;align-self:center;color:#ffc107}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-label[_ngcontent-%COMP%]{display:block;margin:.2rem 0 0;font-size:.95rem;font-weight:700;color:#666}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-value[_ngcontent-%COMP%]{display:block;font-size:.95rem;width:100%;word-break:break-all;color:#666;margin-bottom:.2rem}.usuario-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid #1976d2}.usuario-nombre[_ngcontent-%COMP%]{display:flex;flex-direction:column}.usuario-nombre[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem;color:#1976d2}.usuario-nombre[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.95rem}"]})};export{Se as AdminUsuarios};
