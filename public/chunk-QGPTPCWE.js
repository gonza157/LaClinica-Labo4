import{a as q,b as G,c as J,d as V,e as Z,f as K,g as Q,h as X,i as $,j as ee,k as te,m as ne}from"./chunk-B6MOMOEX.js";import{a as ce,b as le}from"./chunk-QLTCTTX5.js";import{a as C,b as P}from"./chunk-UE7YZPCJ.js";import"./chunk-FK6H3RFT.js";import{$b as w,$c as B,Ab as x,Gb as u,Hb as I,Jc as A,Oc as R,Pc as W,Qa as l,Va as T,Vb as s,Wb as D,Yc as H,Zd as Y,_b as O,ab as z,ac as E,cd as N,ce as k,ec as j,fe as F,gb as M,gc as L,id as U,xb as h,yb as a,zb as r}from"./chunk-7XCQR3O2.js";import{f as S,h as v}from"./chunk-FJYW2LMB.js";var ae=S(ce()),ie=S(le());function me(p,t){if(p&1&&(a(0,"tr")(1,"td"),s(2),r(),a(3,"td"),s(4),j(5,"date"),r()()),p&2){let n=t.$implicit;l(2),D(n.usuario),l(2),D(L(5,2,n.fecha,"short"))}}function pe(p,t){if(p&1&&(a(0,"div",9)(1,"h4"),s(2),r(),x(3,"canvas",5),r()),p&2){let n=t.$implicit,e=I();l(2),D(n.nombre),l(),h("data",n.data)("options",e.pieChartOptionsMedicos)("type","pie")}}V.register(q,K,ee,te,$,Q,X,Z,J,G);var oe=class p{constructor(t){this.firestore=t}logs=[];turnos=[];turnosPorEspecialidad={};turnosPorDia={};turnosPorMedico={};turnosFinalizadosPorMedico={};fechaDesde="";fechaHasta="";ngOnInit(){return v(this,null,function*(){let t=yield F(k(this.firestore,"logs-ingresos"));this.logs=t.docs.map(e=>e.data()),this.logs.sort((e,o)=>new Date(o.fecha).getTime()-new Date(e.fecha).getTime());let n=yield F(k(this.firestore,"turnos"));this.turnos=n.docs.map(e=>e.data()),this.procesarEstadisticas()})}procesarEstadisticas(){let t=this.turnos;(this.fechaDesde||this.fechaHasta)&&(t=t.filter(n=>{let e=n.fecha.split(" ")[0];return!(this.fechaDesde&&e<this.fechaDesde||this.fechaHasta&&e>this.fechaHasta)})),this.turnosPorEspecialidad={},this.turnos.forEach(n=>{this.turnosPorEspecialidad[n.especialidad]=(this.turnosPorEspecialidad[n.especialidad]||0)+1}),this.turnosPorDia={},this.turnos.forEach(n=>{let e=n.fecha.split(" ")[0];this.turnosPorDia[e]=(this.turnosPorDia[e]||0)+1}),this.turnosPorMedico={},this.turnosFinalizadosPorMedico={},t.forEach(n=>{let e=n.especialistaNombre;this.turnosPorMedico[e]=(this.turnosPorMedico[e]||0)+1,n.estado==="finalizado"&&(this.turnosFinalizadosPorMedico[e]=(this.turnosFinalizadosPorMedico[e]||0)+1)})}descargarExcel(){let t=new ae.default.Workbook,n=t.addWorksheet("Turnos por Especialidad"),e=Object.entries(this.turnosPorEspecialidad).map(([c,g])=>({Especialidad:c,Cantidad:g}));n.columns=[{header:"Especialidad",key:"Especialidad",width:20},{header:"Cantidad",key:"Cantidad",width:10}],n.addRows(e);let o=t.addWorksheet("Turnos por D\xEDa"),i=Object.entries(this.turnosPorDia).map(([c,g])=>({D\u00EDa:c,Cantidad:g}));o.columns=[{header:"D\xEDa",key:"D\xEDa",width:20},{header:"Cantidad",key:"Cantidad",width:10}],o.addRows(i);let d=t.addWorksheet("Turnos por M\xE9dico"),y=Object.entries(this.turnosPorMedico).map(([c,g])=>({M\u00E9dico:c,Solicitados:g,Finalizados:this.turnosFinalizadosPorMedico[c]||0}));d.columns=[{header:"M\xE9dico",key:"M\xE9dico",width:25},{header:"Solicitados",key:"Solicitados",width:12},{header:"Finalizados",key:"Finalizados",width:12}],d.addRows(y);let b=t.addWorksheet("Log de Ingresos"),re=this.logs.map(c=>({Usuario:c.usuario,Fecha:new Date(c.fecha).toLocaleString()}));b.columns=[{header:"Usuario",key:"Usuario",width:25},{header:"Fecha",key:"Fecha",width:25}],b.addRows(re),[n,o,d,b].forEach(c=>{c.getRow(1).eachCell(m=>{m.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1976D2"}},m.font={bold:!0,color:{argb:"FFFFFF"}},m.alignment={vertical:"middle",horizontal:"center"},m.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),c.eachRow((m,_)=>{_!==1&&m.eachCell(f=>{f.alignment={vertical:"middle",horizontal:"left"},f.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),c.columns?.forEach((m,_)=>{let f=m.header?.toString().length||10;c.eachRow(se=>{let de=se.getCell(_+1).value?.toString()||"";f=Math.max(f,de.length+2)}),m.width=f})}),t.xlsx.writeBuffer().then(c=>{let g=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,ie.saveAs)(g,"informe-turnos.xlsx")})}descargarPDF(){let t=new C;P(t,{head:[["Especialidad","Cantidad"]],body:Object.entries(this.turnosPorEspecialidad).map(([i,d])=>[i,String(d)]),headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}});let e=document.querySelectorAll(".informe-section")[1],o=e?e.querySelector("canvas"):null;if(o){let i=o.toDataURL("image/png",1),d=t.lastAutoTable?t.lastAutoTable.finalY+10:60;t.addImage(i,"PNG",15,d,180,80)}t.save("turnos-por-especialidad.pdf")}get especialidades(){return Object.keys(this.turnosPorEspecialidad)}get cantidadesEspecialidad(){return Object.values(this.turnosPorEspecialidad)}get dias(){return Object.keys(this.turnosPorDia)}get medicos(){return Object.keys(this.turnosPorMedico)}barChartOptions={responsive:!0,plugins:{legend:{display:!1}}};get barChartData(){return{labels:Object.keys(this.turnosPorEspecialidad),datasets:[{data:Object.values(this.turnosPorEspecialidad),label:"Cantidad",backgroundColor:"#1976d2"}]}}descargarPDFPorDia(){let t=new C;P(t,{head:[["D\xEDa","Cantidad"]],body:Object.entries(this.turnosPorDia).map(([i,d])=>[i,String(d)]),headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}});let e=document.querySelectorAll(".informe-section")[2],o=e?e.querySelector("canvas"):null;if(o){let i=o.toDataURL("image/png",1),d=t.lastAutoTable?t.lastAutoTable.finalY+10:60;t.addImage(i,"PNG",15,d,180,80)}t.save("turnos-por-dia.pdf")}descargarPDFPorMedico(){let t=new C;P(t,{head:[["M\xE9dico","Solicitados","Finalizados"]],body:Object.keys(this.turnosPorMedico).map(d=>[d,String(this.turnosPorMedico[d]),String(this.turnosFinalizadosPorMedico[d]||0)]),headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}});let n=document.querySelectorAll(".informe-section"),e=n[n.length-1],o=e?e.querySelectorAll("canvas"):[],i=t.lastAutoTable?t.lastAutoTable.finalY+10:60;o.forEach((d,y)=>{let b=d.toDataURL("image/png",1);y>0&&(t.addPage(),i=20),t.text(`Gr\xE1fico de ${this.pieChartDataMedicos[y]?.nombre||"M\xE9dico"}`,15,i),t.addImage(b,"PNG",15,i+10,180,80)}),t.save("turnos-por-medico.pdf")}descargarPDFLog(){let t=new C;P(t,{head:[["Usuario","Fecha y Hora"]],body:this.logs.map(n=>[n.usuario,new Date(n.fecha).toLocaleString()]),headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}}),t.save("log-ingresos.pdf")}get barChartDataDias(){return{labels:Object.keys(this.turnosPorDia),datasets:[{data:Object.values(this.turnosPorDia),label:"Cantidad",backgroundColor:"#1976d2"}]}}barChartOptionsDias={responsive:!0,plugins:{legend:{display:!1}},scales:{x:{title:{display:!0,text:"D\xEDa"}},y:{title:{display:!0,text:"Cantidad"},beginAtZero:!0}}};get pieChartDataMedicos(){return Object.keys(this.turnosPorMedico).map(t=>{let n=this.turnosPorMedico[t]||0,e=this.turnosFinalizadosPorMedico[t]||0,o=n-e;return{nombre:t,data:{labels:["Pendientes","Finalizados"],datasets:[{data:[o,e],backgroundColor:["#64B5F6","#1976d2"]}]}}})}pieChartOptionsMedicos={responsive:!0,plugins:{legend:{display:!0,position:"bottom"}}};static \u0275fac=function(n){return new(n||p)(T(Y))};static \u0275cmp=z({type:p,selectors:[["app-informes"]],decls:46,vars:10,consts:[[1,"informes-container"],[1,"excel-main-btn",3,"click"],[1,"informe-section"],[4,"ngFor","ngForOf"],[3,"click"],["baseChart","",3,"data","options","type"],[1,"botones"],["type","date",3,"ngModelChange","ngModel"],["style","margin-bottom: 2rem;",4,"ngFor","ngForOf"],[2,"margin-bottom","2rem"]],template:function(n,e){n&1&&(a(0,"div",0)(1,"h2"),s(2,"\u{1F4CA} Informes y Estad\xEDsticas"),r(),a(3,"button",1),u("click",function(){return e.descargarExcel()}),s(4," \u{1F4C1} Descargar Excel Completo "),r(),a(5,"section",2)(6,"h3"),s(7,"\u{1F510} Log de ingresos"),r(),a(8,"table")(9,"thead")(10,"tr")(11,"th"),s(12,"Usuario"),r(),a(13,"th"),s(14,"Fecha y Hora"),r()()(),a(15,"tbody"),M(16,me,6,5,"tr",3),r()(),a(17,"button",4),u("click",function(){return e.descargarPDFLog()}),s(18,"Descargar PDF"),r()(),a(19,"section",2)(20,"h3"),s(21,"\u{1F3E5} Turnos por Especialidad"),r(),x(22,"canvas",5),a(23,"div",6)(24,"button",4),u("click",function(){return e.descargarPDF()}),s(25,"Descargar PDF"),r()()(),a(26,"section",2)(27,"h3"),s(28,"\u{1F4C5} Turnos por D\xEDa"),r(),x(29,"canvas",5),a(30,"button",4),u("click",function(){return e.descargarPDFPorDia()}),s(31,"Descargar PDF"),r()(),a(32,"section",2)(33,"h3"),s(34,"\u{1F469}\u200D\u2695\uFE0F Turnos por M\xE9dico"),r(),a(35,"label"),s(36,"Desde: "),a(37,"input",7),E("ngModelChange",function(i){return w(e.fechaDesde,i)||(e.fechaDesde=i),i}),r()(),a(38,"label"),s(39,"Hasta: "),a(40,"input",7),E("ngModelChange",function(i){return w(e.fechaHasta,i)||(e.fechaHasta=i),i}),r()(),a(41,"button",4),u("click",function(){return e.procesarEstadisticas()}),s(42,"Filtrar"),r(),M(43,pe,4,4,"div",8),a(44,"button",4),u("click",function(){return e.descargarPDFPorMedico()}),s(45,"Descargar PDF"),r()()()),n&2&&(l(16),h("ngForOf",e.logs),l(6),h("data",e.barChartData)("options",e.barChartOptions)("type","bar"),l(7),h("data",e.barChartDataDias)("options",e.barChartOptionsDias)("type","bar"),l(8),O("ngModel",e.fechaDesde),l(3),O("ngModel",e.fechaHasta),l(3),h("ngForOf",e.pieChartDataMedicos))},dependencies:[W,A,R,U,H,B,N,ne],styles:['@charset "UTF-8";.informes-container[_ngcontent-%COMP%]{background:linear-gradient(135deg,#e3f2fd,#bbdefb,#90caf9);color:#333;padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}h2[_ngcontent-%COMP%]{margin-bottom:2rem;text-align:center;font-weight:600;color:#1976d2;font-size:2rem}.excel-main-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#4caf50,#66bb6a)!important;color:#fff!important;border:none;padding:1rem 2rem!important;border-radius:8px;cursor:pointer;font-weight:600!important;font-size:1.1rem!important;box-shadow:0 4px 15px #4caf504d;transition:all .3s ease;text-transform:uppercase;letter-spacing:1px;margin-bottom:2rem}.excel-main-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#388e3c,#4caf50)!important;box-shadow:0 6px 20px #4caf5066;transform:translateY(-3px)}.excel-main-btn[_ngcontent-%COMP%]:active{transform:translateY(-1px)}.informe-section[_ngcontent-%COMP%]{background:linear-gradient(145deg,#fff,#f8f9ff);box-shadow:0 4px 20px #1976d21a;border-radius:12px;padding:1.5rem 2rem;margin-bottom:2rem;width:100%;max-width:700px;transition:all .3s ease}.informe-section[_ngcontent-%COMP%]:hover{box-shadow:0 8px 25px #1976d233;transform:translateY(-2px)}h3[_ngcontent-%COMP%]{margin-bottom:1rem;color:#1976d2;font-weight:600;font-size:1.3rem;display:flex;align-items:center;gap:10px}ul[_ngcontent-%COMP%]{padding-left:1.2rem;margin-bottom:1rem}li[_ngcontent-%COMP%]{margin-bottom:.5rem;font-size:1.08rem;color:#333}label[_ngcontent-%COMP%]{margin-right:1.2rem;font-weight:500;color:#1976d2;font-size:14px}input[type=date][_ngcontent-%COMP%]{padding:.5rem .7rem;border-radius:8px;border:2px solid #bbdefb;background:#f8f9ff;color:#1976d2;margin-right:.7rem;transition:all .3s ease;font-weight:500}input[type=date][_ngcontent-%COMP%]:focus{outline:none;border-color:#1976d2;background:#e3f2fd;box-shadow:0 2px 8px #1976d233}.botones[_ngcontent-%COMP%], .informe-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:1rem;flex-wrap:wrap}button[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5);color:#fff;border:none;padding:.7rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:500;font-size:.95rem;box-shadow:0 2px 8px #1976d24d;transition:all .3s ease;text-transform:uppercase;letter-spacing:.5px}button[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#1565c0,#1e88e5);box-shadow:0 4px 15px #1976d266;transform:translateY(-2px)}button[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 2px 8px #1976d24d}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;margin-top:1rem;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 16px #1976d21a}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem;text-align:left;border-bottom:1px solid rgba(25,118,210,.1)}th[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1976d2,#42a5f5);color:#fff;font-weight:600;font-size:1rem;text-transform:uppercase;letter-spacing:.5px}td[_ngcontent-%COMP%]{background:#fff;color:#333;font-size:1rem;transition:background-color .3s ease}tr[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]{background:#1976d20d}tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:#1976d21a}tr[_ngcontent-%COMP%]:last-child   td[_ngcontent-%COMP%]{border-bottom:none}canvas[_ngcontent-%COMP%]{margin:1rem 0;background:#fff;border-radius:12px;box-shadow:0 2px 12px #1976d21a;min-height:320px;max-height:400px;padding:10px}.informe-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:first-of-type{background:linear-gradient(135deg,#1976d2,#42a5f5)}.informe-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:first-of-type:hover{background:linear-gradient(135deg,#1565c0,#1e88e5)}@media (max-width: 768px){.informes-container[_ngcontent-%COMP%]{padding:1rem}.informe-section[_ngcontent-%COMP%]{max-width:100%;padding:1rem}h2[_ngcontent-%COMP%]{font-size:1.5rem}.botones[_ngcontent-%COMP%], .informe-section[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}button[_ngcontent-%COMP%]{margin-bottom:.5rem}table[_ngcontent-%COMP%]{font-size:.9rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.7rem .5rem}}']})};export{oe as Informes};
