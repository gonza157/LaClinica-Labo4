import{a as _t}from"./chunk-XUH5KHBK.js";import{a as Vt,b as St,c as Dt}from"./chunk-MQX3SULX.js";import"./chunk-Q4YU3M55.js";import"./chunk-6QCYZ6KR.js";import{a as Ot,b as zt}from"./chunk-5TP7GL2P.js";import{a as Tt,b as wt,c as vt,e as yt,g as Et}from"./chunk-FXXNP7EN.js";import{e as Ft,f as Nt}from"./chunk-UQXX2G4H.js";import{a as G,b as j,c as At,d as ot,e as $,f as q,g as J,h as Y}from"./chunk-KYJNGL4I.js";import"./chunk-LQ5LV7PP.js";import{D as W,E as H,Y as Rt}from"./chunk-X7NSQYYE.js";import{$b as b,$c as O,Bb as D,Cb as k,Eb as p,Gb as g,Hb as s,Ic as Mt,Jc as B,Kc as L,Oc as ht,Pc as P,Qa as l,Rb as xt,Tb as Ct,Va as E,Vb as u,Wb as v,Xb as A,Yb as Q,Yc as I,Zd as kt,_ as K,_b as C,ab as S,ac as M,be as Pt,cd as z,ce as U,dc as et,de as V,ea as _,ec as ut,ee as It,fa as m,fe as X,gb as f,gc as dt,hc as bt,he as it,id as R,je as F,ke as nt,pa as lt,xb as d,yb as c,zb as r}from"./chunk-7XCQR3O2.js";import{a as N,b as st,h as w}from"./chunk-FJYW2LMB.js";function Ut(n,e){if(n&1&&(c(0,"div",6),u(1),r()),n&2){let t=s();l(),v(t.comentario)}}function Gt(n,e){if(n&1){let t=p();c(0,"textarea",7),M("ngModelChange",function(o){_(t);let a=s();return b(a.comentario,o)||(a.comentario=o),m(o)}),r()}if(n&2){let t=s();C("ngModel",t.comentario),d("readonly",t.soloLectura)}}function jt(n,e){n&1&&(c(0,"button",8),u(1,"Cerrar"),r())}function $t(n,e){if(n&1){let t=p();D(0),c(1,"button",9),g("click",function(){_(t);let o=s();return m(o.dialogRef.close())}),u(2,"Cancelar"),r(),c(3,"button",10),g("click",function(){_(t);let o=s();return m(o.dialogRef.close(o.comentario))}),u(4," Aceptar "),r(),k()}if(n&2){let t=s();l(3),d("disabled",!t.comentario.trim())}}var Z=class n{constructor(e,t){this.dialogRef=e;this.data=t;t.comentario&&(this.comentario=t.comentario),typeof t.soloLectura=="boolean"&&(this.soloLectura=t.soloLectura)}comentario="";soloLectura=!1;static \u0275fac=function(t){return new(t||n)(E(G),E(j))};static \u0275cmp=S({type:n,selectors:[["app-dialogo-comentario"]],decls:9,vars:5,consts:[["editable",""],["mat-dialog-title",""],["class","resena-lectura",4,"ngIf","ngIfElse"],["align","end"],["mat-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf"],[1,"resena-lectura"],["rows","4",2,"width","100%",3,"ngModelChange","ngModel","readonly"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"click"],["mat-button","","color","primary",3,"click","disabled"]],template:function(t,i){if(t&1&&(c(0,"h2",1),u(1),r(),c(2,"mat-dialog-content"),f(3,Ut,2,1,"div",2)(4,Gt,1,2,"ng-template",null,0,bt),r(),c(6,"mat-dialog-actions",3),f(7,jt,2,0,"button",4)(8,$t,5,1,"ng-container",5),r()),t&2){let o=xt(5);l(),v(i.data.titulo),l(2),d("ngIf",i.soloLectura)("ngIfElse",o),l(4),d("ngIf",i.soloLectura),l(),d("ngIf",!i.soloLectura)}},dependencies:[P,L,R,I,O,z,Y,ot,$,J,q,H,W],styles:["[_nghost-%COMP%]     .mat-dialog-container{min-width:340px;max-width:600px;width:100%;box-sizing:border-box}h2[mat-dialog-title][_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#fff;margin-bottom:1.2rem;text-align:center;letter-spacing:1px}mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:1.5rem;overflow-x:hidden}textarea[readonly][_ngcontent-%COMP%]{background:#18171b;color:#e1bee7;border:none;border-radius:12px;font-size:1.1rem;padding:1.2rem;width:100%;resize:none;box-shadow:0 2px 8px #8e24aa22;font-family:Fira Mono,Consolas,monospace;margin-bottom:.5rem;min-height:120px;outline:none;overflow-x:hidden;white-space:pre-wrap;word-break:break-word}textarea[_ngcontent-%COMP%]:not([readonly]){background:#fff;color:#232025;border:1.5px solid #8e24aa;border-radius:12px;font-size:1.1rem;padding:1.2rem;width:100%;resize:vertical;box-shadow:0 2px 8px #8e24aa22;font-family:inherit;margin-bottom:.5rem;min-height:120px;outline:none}mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}button[mat-button][_ngcontent-%COMP%]{font-weight:600;font-size:1.05rem;border-radius:8px;padding:.5rem 1.5rem;transition:background .2s,color .2s}button[mat-button][_ngcontent-%COMP%]:hover{background:#8e24aa;color:#fff}.resena-lectura[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;max-width:100%;overflow-x:hidden;white-space:pre-wrap;word-break:break-word}"]})};var qt=()=>[1,2,3,4,5];function Jt(n,e){if(n&1&&(c(0,"mat-radio-button",8),u(1),r()),n&2){let t=e.$implicit;d("value",t),l(),Q("",t," estrella",t>1?"s":"")}}function Yt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),u(2,"\xBFC\xF3mo calificar\xEDa la atenci\xF3n recibida?"),r(),c(3,"mat-radio-group",6),M("ngModelChange",function(o){_(t);let a=s();return b(a.respuestas().calificacion,o)||(a.respuestas().calificacion=o),m(o)}),f(4,Jt,2,3,"mat-radio-button",7),r()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().calificacion),l(),d("ngForOf",et(2,qt))}}function Kt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),u(2,"\xBFEl especialista respondi\xF3 todas sus dudas?"),r(),c(3,"mat-radio-group",6),M("ngModelChange",function(o){_(t);let a=s();return b(a.respuestas().dudasResueltas,o)||(a.respuestas().dudasResueltas=o),m(o)}),c(4,"mat-radio-button",9),u(5,"S\xED"),r(),c(6,"mat-radio-button",10),u(7,"No"),r()()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().dudasResueltas)}}function Qt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),u(2,"\xBFRecomendar\xEDa este servicio?"),r(),c(3,"mat-radio-group",6),M("ngModelChange",function(o){_(t);let a=s();return b(a.respuestas().recomendacion,o)||(a.respuestas().recomendacion=o),m(o)}),c(4,"mat-radio-button",9),u(5,"S\xED"),r(),c(6,"mat-radio-button",10),u(7,"No"),r()()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().recomendacion)}}function Xt(n,e){if(n&1){let t=p();c(0,"div")(1,"label"),u(2,"Comentarios adicionales"),r(),c(3,"textarea",11),M("ngModelChange",function(o){_(t);let a=s();return b(a.respuestas().comentario,o)||(a.respuestas().comentario=o),m(o)}),r()()}if(n&2){let t=s();l(3),C("ngModel",t.respuestas().comentario)}}function Zt(n,e){if(n&1){let t=p();c(0,"button",12),g("click",function(){_(t);let o=s();return m(o.anterior())}),u(1,"Anterior"),r()}}function te(n,e){if(n&1){let t=p();c(0,"button",13),g("click",function(){_(t);let o=s();return m(o.siguiente())}),u(1,"Siguiente"),r()}if(n&2){let t=s();d("disabled",!t.respuestasValida())}}function ee(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s();return m(o.finalizar())}),u(1,"Finalizar"),r()}}var at=class n{constructor(e,t){this.dialogRef=e;this.data=t}paso=lt(1);respuestas=lt({calificacion:"",dudasResueltas:"",recomendacion:"",comentario:""});siguiente(){this.paso.update(e=>e+1)}anterior(){this.paso.update(e=>e-1)}finalizar(){this.dialogRef.close(this.respuestas())}respuestasValida(){let e=this.respuestas();switch(this.paso()){case 1:return!!e.calificacion;case 2:return!!e.dudasResueltas;case 3:return!!e.recomendacion;default:return!0}}static \u0275fac=function(t){return new(t||n)(E(G),E(j))};static \u0275cmp=S({type:n,selectors:[["app-dialogo-encuesta"]],decls:11,vars:7,consts:[["mat-dialog-title",""],[4,"ngIf"],["align","end"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"disabled","click",4,"ngIf"],["mat-button","","color","primary",3,"click",4,"ngIf"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["value","S\xED"],["value","No"],["rows","3",2,"width","100%",3,"ngModelChange","ngModel"],["mat-button","",3,"click"],["mat-button","",3,"click","disabled"],["mat-button","","color","primary",3,"click"]],template:function(t,i){t&1&&(c(0,"h2",0),u(1,"Encuesta de atenci\xF3n"),r(),c(2,"mat-dialog-content"),f(3,Yt,5,3,"div",1)(4,Kt,8,1,"div",1)(5,Qt,8,1,"div",1)(6,Xt,4,1,"div",1),r(),c(7,"mat-dialog-actions",2),f(8,Zt,2,0,"button",3)(9,te,2,1,"button",4)(10,ee,2,0,"button",5),r()),t&2&&(l(3),d("ngIf",i.paso()===1),l(),d("ngIf",i.paso()===2),l(),d("ngIf",i.paso()===3),l(),d("ngIf",i.paso()===4),l(2),d("ngIf",i.paso()>1),l(),d("ngIf",i.paso()<4),l(),d("ngIf",i.paso()===4))},dependencies:[P,B,L,R,I,O,z,Dt,Vt,St,Y,$,J,q,H,W],styles:["mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:10px 0}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px;display:block}"]})};var ie=()=>[1,2,3,4,5];function ne(n,e){if(n&1){let t=p();D(0),c(1,"span",7),g("click",function(){let o=_(t).$implicit,a=s();return m(a.setEstrellas(o))})("mouseenter",function(){let o=_(t).$implicit,a=s();return m(a.setHover(o))})("mouseleave",function(){_(t);let o=s();return m(o.resetHover())}),u(2,"\u2605"),r(),k()}if(n&2){let t=e.$implicit,i=s();l(),Ct("seleccionada",t<=i.estrellas)("hovered",i.hoverEstrella>0&&t<=i.hoverEstrella)}}var rt=class n{constructor(e,t){this.dialogRef=e;this.data=t}estrellas=0;comentario="";hoverEstrella=0;setEstrellas(e){this.estrellas=e}setHover(e){this.hoverEstrella=e}resetHover(){this.hoverEstrella=0}aceptar(){this.estrellas>0&&this.dialogRef.close({estrellas:this.estrellas,comentario:this.comentario})}static \u0275fac=function(t){return new(t||n)(E(G),E(j))};static \u0275cmp=S({type:n,selectors:[["app-dialogo-calificacion"]],decls:11,vars:5,consts:[["mat-dialog-title",""],[1,"estrellas"],[4,"ngFor","ngForOf"],["rows","3","placeholder","Nos gustar\xEDa conocer tu opini\xF3n.",2,"width","100%",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-button","","color","primary",3,"click","disabled"],[1,"estrella",3,"click","mouseenter","mouseleave"]],template:function(t,i){t&1&&(c(0,"h2",0),u(1),r(),c(2,"mat-dialog-content")(3,"div",1),f(4,ne,3,4,"ng-container",2),r(),c(5,"textarea",3),M("ngModelChange",function(a){return b(i.comentario,a)||(i.comentario=a),a}),r()(),c(6,"mat-dialog-actions",4)(7,"button",5),u(8,"Cancelar"),r(),c(9,"button",6),g("click",function(){return i.aceptar()}),u(10,"Aceptar"),r()()),t&2&&(l(),v(i.data.titulo),l(3),d("ngForOf",et(4,ie)),l(),C("ngModel",i.comentario),l(4),d("disabled",i.estrellas===0))},dependencies:[P,B,R,I,O,z,Y,ot,$,J,q],styles:[".estrellas[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:1rem}.estrellas[_ngcontent-%COMP%]   .estrella[_ngcontent-%COMP%]{cursor:pointer;color:#ccc;transition:color .2s}.estrellas[_ngcontent-%COMP%]   .estrella.seleccionada[_ngcontent-%COMP%]{color:#ffd600}.estrellas[_ngcontent-%COMP%]   .estrella.hovered[_ngcontent-%COMP%]{color:#ff9800}"]})};function oe(n,e){if(n&1){let t=p();D(0),c(1,"input",8),M("ngModelChange",function(o){_(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),m(o)}),r(),k()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function ae(n,e){if(n&1){let t=p();D(0),c(1,"input",8),M("ngModelChange",function(o){_(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),m(o)}),r(),k()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function re(n,e){if(n&1){let t=p();D(0),c(1,"input",8),M("ngModelChange",function(o){_(t);let a=s();return b(a.filtroGlobal,o)||(a.filtroGlobal=o),m(o)}),r(),k()}if(n&2){let t=s();l(),C("ngModel",t.filtroGlobal)}}function ce(n,e){if(n&1&&(c(0,"p")(1,"strong"),u(2,"Especialista:"),r(),u(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.especialistaNombre)}}function se(n,e){if(n&1&&(c(0,"p")(1,"strong"),u(2,"Paciente:"),r(),u(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.pacienteNombre)}}function le(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function ue(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.verResena(o))}),u(1,"Ver Rese\xF1a"),r()}}function de(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.completarEncuesta(o))}),u(1,"Encuesta"),r()}}function _e(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.calificarAtencion(o))}),u(1,"Calificar"),r()}}function me(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function pe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.rechazarTurno(o))}),u(1,"Rechazar"),r()}}function ge(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.aceptarTurno(o))}),u(1,"Aceptar"),r()}}function fe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.finalizarTurno(o))}),u(1,"Finalizar"),r()}}function xe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.cargarHistoriaClinica(o))}),u(1,"Historia Cl\xEDnica"),r()}}function Ce(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function be(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s();return m(a.verHistoriaClinica(o))}),u(1,"Ver Historia Cl\xEDnica"),r()}}function Me(n,e){if(n&1&&(c(0,"mat-card",9)(1,"mat-card-title",10),u(2),ut(3,"date"),r(),c(4,"mat-card-content")(5,"p")(6,"strong"),u(7,"Especialidad:"),r(),u(8),r(),f(9,ce,4,1,"p",2)(10,se,4,1,"p",2),c(11,"p")(12,"strong"),u(13,"Estado: "),r(),c(14,"span",11),u(15),r()()(),c(16,"mat-card-actions",12),f(17,le,2,0,"button",13)(18,ue,2,0,"button",13)(19,de,2,0,"button",13)(20,_e,2,0,"button",13)(21,me,2,0,"button",13)(22,pe,2,0,"button",13)(23,ge,2,0,"button",13)(24,fe,2,0,"button",13)(25,xe,2,0,"button",13)(26,Ce,2,0,"button",13)(27,be,2,0,"button",13),r()()),n&2){let t=e.$implicit,i=s();l(2),Q(" ",dt(3,18,t.fecha.split(" ")[0],"dd/MM/yyyy")," ",t.fecha.split(" ")[1]," "),l(6),A(" ",t.especialidad),l(),d("ngIf",i.rol!=="especialista"),l(),d("ngIf",i.rol!=="paciente"),l(4),d("ngClass",t.estado),l(),v(t.estado),l(2),d("ngIf",i.puedeCancelarPaciente(t)),l(),d("ngIf",i.puedeVerResena(t)),l(),d("ngIf",i.puedeCompletarEncuesta(t)),l(),d("ngIf",i.puedeCalificar(t)),l(),d("ngIf",i.puedeCancelarEspecialista(t)),l(),d("ngIf",i.puedeRechazar(t)),l(),d("ngIf",i.puedeAceptar(t)),l(),d("ngIf",i.puedeFinalizar(t)),l(),d("ngIf",i.puedeCargarHistoriaClinica(t)),l(),d("ngIf",i.puedeCancelarAdmin(t)),l(),d("ngIf",i.puedeVerHistoriaClinica(t))}}function he(n,e){if(n&1&&(c(0,"p")(1,"strong"),u(2,"Especialista:"),r(),u(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.especialistaNombre)}}function Te(n,e){if(n&1&&(c(0,"p")(1,"strong"),u(2,"Paciente:"),r(),u(3),r()),n&2){let t=s().$implicit;l(3),A(" ",t.pacienteNombre)}}function we(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function ve(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.verResena(o))}),u(1,"Ver Rese\xF1a"),r()}}function ye(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.completarEncuesta(o))}),u(1,"Encuesta"),r()}}function Ee(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.calificarAtencion(o))}),u(1,"Calificar"),r()}}function Ve(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function Se(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.rechazarTurno(o))}),u(1,"Rechazar"),r()}}function De(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.aceptarTurno(o))}),u(1,"Aceptar"),r()}}function ke(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.finalizarTurno(o))}),u(1,"Finalizar"),r()}}function Pe(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.cargarHistoriaClinica(o))}),u(1,"Historia Cl\xEDnica"),r()}}function Ie(n,e){if(n&1){let t=p();c(0,"button",14),g("click",function(){_(t);let o=s().$implicit,a=s(2);return m(a.cancelarTurno(o))}),u(1,"Cancelar"),r()}}function Oe(n,e){if(n&1&&(c(0,"mat-card",9)(1,"mat-card-title",10),u(2),ut(3,"date"),r(),c(4,"mat-card-content")(5,"p")(6,"strong"),u(7,"Especialidad:"),r(),u(8),r(),f(9,he,4,1,"p",2)(10,Te,4,1,"p",2),c(11,"p")(12,"strong"),u(13,"Estado: "),r(),c(14,"span",11),u(15),r()()(),c(16,"mat-card-actions",12),f(17,we,2,0,"button",13)(18,ve,2,0,"button",13)(19,ye,2,0,"button",13)(20,Ee,2,0,"button",13)(21,Ve,2,0,"button",13)(22,Se,2,0,"button",13)(23,De,2,0,"button",13)(24,ke,2,0,"button",13)(25,Pe,2,0,"button",13)(26,Ie,2,0,"button",13),r()()),n&2){let t=e.$implicit,i=s(2);l(2),Q(" ",dt(3,17,t.fecha.split(" ")[0],"dd/MM/yyyy")," ",t.fecha.split(" ")[1]," "),l(6),A(" ",t.especialidad),l(),d("ngIf",i.rol!=="especialista"),l(),d("ngIf",i.rol!=="paciente"),l(4),d("ngClass",t.estado),l(),v(t.estado),l(2),d("ngIf",i.puedeCancelarPaciente(t)),l(),d("ngIf",i.puedeVerResena(t)),l(),d("ngIf",i.puedeCompletarEncuesta(t)),l(),d("ngIf",i.puedeCalificar(t)),l(),d("ngIf",i.puedeCancelarEspecialista(t)),l(),d("ngIf",i.puedeRechazar(t)),l(),d("ngIf",i.puedeAceptar(t)),l(),d("ngIf",i.puedeFinalizar(t)),l(),d("ngIf",i.puedeCargarHistoriaClinica(t)),l(),d("ngIf",i.puedeCancelarAdmin(t))}}function ze(n,e){if(n&1&&(c(0,"div",3),f(1,Oe,27,20,"mat-card",4),r()),n&2){let t=s();l(),d("ngForOf",t.turnosPrevios)}}var Wt=class n{authService=K(Rt);firestore=K(kt);snackBar=K(Ot);dialog=K(At);filtro1="";filtro2="";turnos=[];user=null;rol=null;mostrarPrevios=!1;filtroGlobal="";ngOnInit(){this.user=this.authService.userSignal(),this.rol=this.user?.rol||null,this.cargarTurnos()}cargarTurnos(){return w(this,null,function*(){let e=U(this.firestore,"turnos"),t;if(this.rol==="paciente")t=it(e,nt("pacienteUid","==",this.user.uid));else if(this.rol==="especialista")t=it(e,nt("especialistaUid","==",this.user.uid));else if(this.rol==="admin")t=e;else{this.turnos=[];return}let i=yield X(t);this.turnos=i.docs.map(a=>N({id:a.id},a.data()));let o=[];if(this.rol==="paciente")o=(yield X(it(U(this.firestore,"historias-clinicas"),nt("pacienteUid","==",this.user.uid)))).docs.map(h=>N({id:h.id},h.data()));else if(this.rol==="especialista"){let a=Array.from(new Set(this.turnos.map(x=>x.pacienteUid)));o=(yield X(U(this.firestore,"historias-clinicas"))).docs.map(x=>N({id:x.id},x.data())).filter(x=>a.includes(x.pacienteUid)&&x.especialistaUid===this.user.uid)}else this.rol==="admin"&&(o=(yield X(U(this.firestore,"historias-clinicas"))).docs.map(h=>N({id:h.id},h.data())));this.turnos=this.turnos.map(a=>{let h=null;return a.historiaClinicaId?h=o.find(x=>x.id===a.historiaClinicaId):h=o.find(x=>x.pacienteUid===a.pacienteUid&&x.especialistaUid===a.especialistaUid&&Re(a.fecha,x.fecha)),st(N({},a),{historiaClinica:h||null})})})}get turnosFiltrados(){let e=this.turnos;if(this.filtroGlobal.trim()){let T=this.filtroGlobal.trim().toLowerCase();e=e.filter(y=>{let tt=Object.values(y).map(ct=>typeof ct=="object"?JSON.stringify(ct):String(ct)).join(" ").toLowerCase();return y.historiaClinica&&(tt+=" "+JSON.stringify(y.historiaClinica).toLowerCase()),tt.includes(T)})}let t=["aceptado","pendiente","realizado"],i=["cancelado","rechazado","finalizado"],o=T=>{let[y,tt]=T.fecha.split(" ");return new Date(`${y}T${tt||"00:00"}`)},a=(T,y)=>o(T).getTime()-o(y).getTime(),h=(T,y)=>o(y).getTime()-o(T).getTime(),x=e.filter(T=>t.includes(T.estado)).sort(a),Ht=e.filter(T=>i.includes(T.estado)).sort(h);return[...x,...Ht]}get turnosActuales(){let e=["aceptado","pendiente","realizado"];return this.turnosFiltrados.filter(t=>e.includes(t.estado))}get turnosPrevios(){let e=["cancelado","rechazado","finalizado"];return this.turnosFiltrados.filter(t=>e.includes(t.estado))}puedeCancelarPaciente(e){return this.rol==="paciente"&&e.estado==="pendiente"}puedeVerResena(e){return!!e.resena}puedeCompletarEncuesta(e){return this.rol==="paciente"&&e.estado==="realizado"&&e.resena&&!e.encuestaCompletada}puedeCalificar(e){return this.rol==="paciente"&&e.estado==="realizado"&&!e.calificacion}puedeCancelarEspecialista(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeRechazar(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeAceptar(e){return this.rol==="especialista"&&e.estado==="pendiente"}puedeFinalizar(e){return this.rol==="especialista"&&e.estado==="aceptado"}puedeCargarHistoriaClinica(e){return this.rol==="especialista"&&e.estado==="realizado"}puedeCancelarAdmin(e){return this.rol==="admin"&&e.estado==="pendiente"}puedeVerHistoriaClinica(e){return(this.rol==="paciente"||this.rol==="admin")&&e.estado==="finalizado"}cancelarTurno(e){return w(this,null,function*(){let t=yield this.pedirComentario("Motivo de la cancelaci\xF3n");t&&(yield F(V(this.firestore,"turnos",e.id),{estado:"cancelado",comentarioCancelacion:t}),this.snackBar.open("Turno cancelado","Cerrar",{duration:2e3}),this.cargarTurnos())})}rechazarTurno(e){return w(this,null,function*(){let t=yield this.pedirComentario("Motivo del rechazo");t&&(yield F(V(this.firestore,"turnos",e.id),{estado:"rechazado",comentarioCancelacion:t}),this.snackBar.open("Turno rechazado","Cerrar",{duration:2e3}),this.cargarTurnos())})}aceptarTurno(e){return w(this,null,function*(){yield F(V(this.firestore,"turnos",e.id),{estado:"aceptado"}),this.snackBar.open("Turno aceptado","Cerrar",{duration:2e3}),this.cargarTurnos()})}finalizarTurno(e){return w(this,null,function*(){let t=yield this.pedirComentario("Rese\xF1a");t&&(yield F(V(this.firestore,"turnos",e.id),{estado:"realizado",resena:t}),this.snackBar.open("Turno finalizado","Cerrar",{duration:2e3}),this.cargarTurnos())})}completarEncuesta(e){this.dialog.open(at,{width:"400px"}).afterClosed().subscribe(t=>w(this,null,function*(){if(t)try{let i=V(this.firestore,"turnos",e.id);yield F(i,{encuestaCompletada:!0,encuesta:t}),this.snackBar.open("\xA1Encuesta enviada!","Cerrar",{duration:2e3}),this.cargarTurnos()}catch{this.snackBar.open("Error al guardar la encuesta","Cerrar",{duration:2e3})}}))}calificarAtencion(e){return w(this,null,function*(){let i=yield this.dialog.open(rt,{data:{titulo:"Calificar atenci\xF3n del especialista"}}).afterClosed().toPromise();!i||!i.estrellas||(yield F(V(this.firestore,"turnos",e.id),{calificacion:i.estrellas,comentarioCalificacion:i.comentario??""}),this.snackBar.open("Calificaci\xF3n guardada","Cerrar",{duration:2e3}),this.cargarTurnos())})}verResena(e){this.dialog.open(Z,{data:{titulo:"Rese\xF1a del turno",comentario:e.resena||"Sin rese\xF1a",soloLectura:!0}})}pedirComentario(e){return w(this,null,function*(){let i=yield this.dialog.open(Z,{data:{titulo:e,soloLectura:!1}}).afterClosed().toPromise();return i&&i.trim()?i:null})}cargarHistoriaClinica(e){return w(this,null,function*(){let i=yield this.dialog.open(_t,{data:{paciente:{nombre:e.pacienteNombre,uid:e.pacienteUid}}}).afterClosed().toPromise();if(i){let o=yield Pt(U(this.firestore,"historias-clinicas"),st(N({},i),{pacienteUid:e.pacienteUid,pacienteNombre:e.pacienteNombre,especialistaUid:e.especialistaUid,especialistaNombre:e.especialistaNombre,especialidad:e.especialidad,fecha:new Date().toISOString()}));yield F(V(this.firestore,"turnos",e.id),{estado:"finalizado",historiaClinicaId:o.id}),this.snackBar.open("Historia cl\xEDnica guardada","Cerrar",{duration:2e3}),this.cargarTurnos()}})}verHistoriaClinica(e){return w(this,null,function*(){if(!e.historiaClinicaId){this.snackBar.open("No hay historia cl\xEDnica para este turno","Cerrar",{duration:2e3});return}let t=V(this.firestore,"historias-clinicas",e.historiaClinicaId),i=yield It(t);if(!i.exists()){this.snackBar.open("No se encontr\xF3 la historia cl\xEDnica","Cerrar",{duration:2e3});return}let o=i.data();this.dialog.open(_t,{data:{paciente:{nombre:e.pacienteNombre},historia:o,soloLectura:!0}})})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["app-mis-turnos"]],decls:15,vars:7,consts:[[1,"mis-turnos-container"],[1,"filtros"],[4,"ngIf"],[1,"turnos-list"],["class","turno-card",4,"ngFor","ngForOf"],[1,"turnos-previos-toggle",3,"click"],[1,"toggle-link"],["class","turnos-list",4,"ngIf"],["type","text","placeholder","Buscar...",3,"ngModelChange","ngModel"],[1,"turno-card"],[1,"turno-fecha"],[1,"estado",3,"ngClass"],[1,"acciones"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"]],template:function(t,i){t&1&&(c(0,"div",0)(1,"h2"),u(2),r(),c(3,"div",1),f(4,oe,2,1,"ng-container",2)(5,ae,2,1,"ng-container",2)(6,re,2,1,"ng-container",2),r(),c(7,"div",3),f(8,Me,28,21,"mat-card",4),r(),c(9,"div",5),g("click",function(){return i.mostrarPrevios=!i.mostrarPrevios}),c(10,"span",6),u(11," Turnos previos "),c(12,"mat-icon"),u(13),r()()(),f(14,ze,2,1,"div",7),r()),t&2&&(l(2),v(i.rol==="admin"?"Turnos":"Mis Turnos"),l(2),d("ngIf",i.rol==="paciente"),l(),d("ngIf",i.rol==="especialista"),l(),d("ngIf",i.rol==="admin"),l(2),d("ngForOf",i.turnosActuales),l(5),v(i.mostrarPrevios?"expand_less":"expand_more"),l(),d("ngIf",i.mostrarPrevios))},dependencies:[P,Mt,B,L,ht,R,I,O,z,H,W,zt,Et,Tt,yt,vt,wt,Nt,Ft],styles:[".mis-turnos-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}.mis-turnos-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:1.5rem;font-weight:600}.mis-turnos-container[_ngcontent-%COMP%]   .filtros[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;margin-bottom:1.5rem}.mis-turnos-container[_ngcontent-%COMP%]   .filtros[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:240px;padding:.5rem;border-radius:6px;border:1px solid #ccc;background-color:var(--card-bg);color:var(--text-color)}.mis-turnos-container[_ngcontent-%COMP%]   .turnos-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;width:100%;max-width:1200px}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.2rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .turno-fecha[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin-bottom:.5rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado[_ngcontent-%COMP%]{padding:.2rem .5rem;border-radius:6px;color:#fff;font-weight:700}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.pendiente[_ngcontent-%COMP%]{background-color:#fbc02d}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.aceptado[_ngcontent-%COMP%], .mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.realizado[_ngcontent-%COMP%]{background-color:#43a047}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.cancelado[_ngcontent-%COMP%], .mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.rechazado[_ngcontent-%COMP%]{background-color:#e53935}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .estado.finalizado[_ngcontent-%COMP%]{background-color:#1e88e5}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:1rem}.mis-turnos-container[_ngcontent-%COMP%]   .turno-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 auto}.turnos-previos-toggle[_ngcontent-%COMP%]{margin:2rem 0 1rem;text-align:center;cursor:pointer}.turnos-previos-toggle[_ngcontent-%COMP%]   .toggle-link[_ngcontent-%COMP%]{color:#8e24aa;font-weight:600;font-size:1.1rem;display:inline-flex;align-items:center;gap:.3rem;transition:color .2s}.turnos-previos-toggle[_ngcontent-%COMP%]   .toggle-link[_ngcontent-%COMP%]:hover{color:#5e1675;text-decoration:underline}.turno-card[_ngcontent-%COMP%]{transition:transform .22s cubic-bezier(.4,0,.2,1),box-shadow .22s cubic-bezier(.4,0,.2,1);will-change:transform,box-shadow;cursor:pointer}.turno-card[_ngcontent-%COMP%]:hover{transform:scale(1.035);box-shadow:0 8px 32px #8e24aa33;z-index:2}"]})};function Re(n,e){let t=new Date(n.replace(" ","T")),i=new Date(e.replace(" ","T"));return t.getFullYear()===i.getFullYear()&&t.getMonth()===i.getMonth()&&t.getDate()===i.getDate()&&t.getHours()===i.getHours()&&t.getMinutes()===i.getMinutes()}export{Wt as MisTurnos};
