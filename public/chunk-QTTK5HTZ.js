import"./chunk-GGQ7LRWG.js";import{a as he,c as xe,d as Me,g as He,h as Ne,j as W,k as Ve}from"./chunk-6YN2COQJ.js";import{a as ae,b as re,c as oe,d as se,f as le,g as ce,h as fe,k as _e}from"./chunk-FXXNP7EN.js";import{a as Fe}from"./chunk-W2LONUKG.js";import{a as Te,b as $e}from"./chunk-UE7YZPCJ.js";import{a as ze}from"./chunk-4WUXS4KB.js";import"./chunk-FK6H3RFT.js";import{a as Oe,b as we,c as ye,e as Ee,f as Ie,g as De,h as ke}from"./chunk-KYJNGL4I.js";import{c as ve}from"./chunk-UI2J3IFV.js";import{D as N,E as V,Y as Se}from"./chunk-X7NSQYYE.js";import{$b as Z,$c as me,Ab as D,Bb as U,Cb as L,Eb as E,Gb as h,Hb as m,Jc as $,Kc as ie,Nc as ne,Oa as j,Pc as H,Qa as s,Rb as X,Va as R,Vb as l,Wb as b,Xb as k,Yb as K,Zd as be,_ as y,_b as Q,ab as I,ac as ee,ad as pe,bd as de,cd as ge,ce as S,dd as ue,de as G,ea as P,ec as F,ee as Ce,fa as v,fc as T,fe as O,gb as _,hc as te,he as w,id as z,je as Pe,ke as M,xb as c,yb as r,zb as a}from"./chunk-7XCQR3O2.js";import{h as C}from"./chunk-FJYW2LMB.js";function qe(i,n){if(i&1&&(r(0,"mat-option",3),l(1),a()),i&2){let e=n.$implicit;c("value",e),s(),b(e)}}var A=class i{constructor(n,e){this.dialogRef=n;this.data=e;this.especialistas=e.especialistas||[]}especialista="";especialistas=[];static \u0275fac=function(e){return new(e||i)(R(Oe),R(we))};static \u0275cmp=I({type:i,selectors:[["app-dialogo-seleccionar-especialista"]],decls:15,vars:3,consts:[["mat-dialog-title",""],["appearance","fill",2,"width","100%"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,t){e&1&&(r(0,"h2",0),l(1,"Seleccionar especialista"),a(),r(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),l(5,"Especialista"),a(),r(6,"mat-select",2),ee("ngModelChange",function(d){return Z(t.especialista,d)||(t.especialista=d),d}),r(7,"mat-option",3),l(8,"Todos"),a(),_(9,qe,2,2,"mat-option",4),a()()(),r(10,"mat-dialog-actions",5)(11,"button",6),h("click",function(){return t.dialogRef.close()}),l(12,"Cancelar"),a(),r(13,"button",7),h("click",function(){return t.dialogRef.close(t.especialista)}),l(14,"Aceptar"),a()()),e&2&&(s(6),Q("ngModel",t.especialista),s(),c("value",""),s(2),c("ngForOf",t.especialistas))},dependencies:[H,$,z,me,ge,ke,Ee,De,Ie,V,N,Me,_e,fe,xe,he],encapsulation:2})};function Ye(i,n){if(i&1&&D(0,"img",10),i&2){let e=m();c("src",e.user==null?null:e.user.imagen1,j)}}function Je(i,n){if(i&1&&D(0,"img",11),i&2){let e=m();c("src",e.user==null?null:e.user.imagen2,j)}}function Xe(i,n){if(i&1){let e=E();U(0),r(1,"p")(2,"strong"),l(3,"Obra Social:"),a(),l(4),a(),r(5,"div",12)(6,"button",13),h("click",function(){P(e);let o=m();return v(o.verHistorialClinico())}),l(7,"Ver Historial Cl\xEDnico"),a(),r(8,"button",14),h("click",function(){P(e);let o=m();return v(o.descargarHistorialPDF())}),l(9,"Descargar Historia Cl\xEDnica (PDF)"),a()(),L()}if(i&2){let e=m();s(4),k(" ",e.user==null?null:e.user.obraSocial)}}function Ke(i,n){if(i&1&&(U(0),r(1,"p")(2,"strong"),l(3,"Especialidades:"),a(),l(4),a(),L()),i&2){let e=m();s(4),k(" ",e.especialidades.join(", "))}}function Qe(i,n){if(i&1&&(r(0,"th"),l(1),a()),i&2){let e=n.$implicit;s(),b(e)}}function Ze(i,n){if(i&1){let e=E();r(0,"td")(1,"input",19),h("change",function(){let o=P(e).$implicit,d=m().$implicit,q=m().$implicit,x=m(2);return v(x.toggleHorario(q,d,o))}),a()()}if(i&2){let e=n.$implicit,t=m().$implicit,o=m().$implicit,d=m(2);s(),c("checked",d.tieneHorario(o,t,e))}}function et(i,n){if(i&1&&(r(0,"tr")(1,"td"),l(2),a(),_(3,Ze,2,1,"td",17),a()),i&2){let e=n.$implicit,t=m(3);s(2),b(e),s(),c("ngForOf",t.horas)}}function tt(i,n){if(i&1&&(r(0,"div")(1,"h4"),l(2),a(),r(3,"table")(4,"tr"),D(5,"th"),_(6,Qe,2,1,"th",17),a(),_(7,et,4,2,"tr",17),a()()),i&2){let e=n.$implicit,t=m(2);s(2),b(e),s(4),c("ngForOf",t.horas),s(),c("ngForOf",t.dias)}}function it(i,n){if(i&1){let e=E();r(0,"div",15)(1,"h3"),l(2,"Mis Horarios"),a(),r(3,"form",16),h("ngSubmit",function(){P(e);let o=m();return v(o.guardarHorarios())}),_(4,tt,8,3,"div",17),r(5,"button",18),l(6,"Guardar Horarios"),a()()()}if(i&2){let e=m();s(4),c("ngForOf",e.especialidades)}}var Ae=class i{authService=y(Se);firestore=y(be);snackBar=y(ve);dialog=y(ye);user=null;especialidades=[];horarios={};dias=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];horas=["09:00","09:30","10:00","10:30","11:00","11:30","16:00","16:30","17:00","17:30"];mostrarPrimeraImagen=!0;alternarImagen(){this.mostrarPrimeraImagen=!this.mostrarPrimeraImagen}ngOnInit(){return C(this,null,function*(){this.user=this.authService.userSignal(),this.user?.rol==="especialista"&&(yield this.cargarEspecialidades(),yield this.cargarHorarios())})}cargarEspecialidades(){return C(this,null,function*(){Array.isArray(this.user.especialidad)?this.especialidades=this.user.especialidad:this.user.especialidad?this.especialidades=[this.user.especialidad]:this.especialidades=[]})}cargarHorarios(){return C(this,null,function*(){let n=G(this.firestore,"usuarios",this.user.uid),t=(yield Ce(n)).data();this.horarios=t?.horarios||{}})}toggleHorario(n,e,t){this.horarios[n]||(this.horarios[n]=[]);let o=`${e} ${t}`,d=this.horarios[n].indexOf(o);d>-1?this.horarios[n].splice(d,1):this.horarios[n].push(o)}tieneHorario(n,e,t){return this.horarios[n]?.includes(`${e} ${t}`)}guardarHorarios(){return C(this,null,function*(){let n=G(this.firestore,"usuarios",this.user.uid);yield Pe(n,{horarios:this.horarios}),this.snackBar.open("Horarios actualizados correctamente","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"})})}verHistorialClinico(){this.dialog.open(Fe,{width:"600px",data:{paciente:{uid:this.user.uid,nombre:this.user.nombre,apellido:this.user.apellido,rol:this.user.rol}}})}descargarHistorialPDF(){return C(this,null,function*(){let n=S(this.firestore,"historias-clinicas"),e=w(n,M("pacienteUid","==",this.user.uid)),o=(yield O(e)).docs.map(u=>u.data()).sort((u,p)=>new Date(p.fecha).getTime()-new Date(u.fecha).getTime());if(o.length===0){this.snackBar.open("No hay historia cl\xEDnica para descargar","Cerrar",{duration:2e3});return}let d=Array.from(new Set(o.map(u=>u.especialistaNombre))),x=yield this.dialog.open(A,{width:"350px",data:{especialistas:d}}).afterClosed().toPromise();if(x===void 0)return;let Be=x?o.filter(u=>u.especialistaNombre===x):o,Y=[],J=[];x?(Y=(yield O(w(S(this.firestore,"turnos"),M("pacienteUid","==",this.user.uid),M("especialistaNombre","==",x)))).docs.map(f=>f.data()),J=(yield O(w(S(this.firestore,"rese\xF1as"),M("pacienteUid","==",this.user.uid),M("especialistaNombre","==",x)))).docs.map(f=>f.data())):(Y=(yield O(w(S(this.firestore,"turnos"),M("pacienteUid","==",this.user.uid)))).docs.map(f=>f.data()),J=(yield O(w(S(this.firestore,"rese\xF1as"),M("pacienteUid","==",this.user.uid)))).docs.map(f=>f.data()));let g=new Te,je="assets/favicon.ico",B=new Image;B.src=je,B.onload=()=>{g.addImage(B,"PNG",10,10,16,16),g.setFontSize(18),g.text("Historia Cl\xEDnica",30,20),g.setFontSize(11),g.text(`Fecha de emisi\xF3n: ${new Date().toLocaleString()}`,30,28),g.setFontSize(12),g.text(`Paciente: ${this.user.nombre} ${this.user.apellido}`,14,40),g.text(`Email: ${this.user.email}`,14,47),g.text(`Obra Social: ${this.user.obraSocial||"-"}`,14,54),$e(g,{startY:62,head:[["Fecha","Especialista","Especialidad","Altura","Peso","Temp.","Presi\xF3n","Datos adicionales"]],body:Be.map(p=>[p.fecha?new Date(p.fecha).toLocaleString():"",p.especialistaNombre||"",p.especialidad||"",p.altura||"",p.peso||"",p.temperatura||"",p.presion||"",p.dinamicos&&p.dinamicos.length?p.dinamicos.map(f=>`${f.clave}: ${f.valor}`).join(`
`):""]),styles:{fontSize:10},headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}});let u=`historia-clinica-${this.user.nombre}-${this.user.apellido}`.replace(/\s+/g,"_")+".pdf";g.save(u)}})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=I({type:i,selectors:[["app-mi-perfil"]],decls:24,vars:16,consts:[["segundaImagen",""],[1,"mi-perfil-container"],[1,"perfil-card"],[1,"perfil-header"],[1,"perfil-avatar",2,"cursor","pointer",3,"click"],["alt","Imagen de perfil",3,"src",4,"ngIf","ngIfElse"],[1,"perfil-titulos"],[1,"perfil-datos"],[4,"ngIf"],["class","mis-horarios",4,"ngIf"],["alt","Imagen de perfil",3,"src"],["alt","Imagen secundaria",3,"src"],[1,"acciones"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"mis-horarios"],[3,"ngSubmit"],[4,"ngFor","ngForOf"],["type","submit"],["type","checkbox",3,"change","checked"]],template:function(e,t){if(e&1){let o=E();r(0,"div",1)(1,"mat-card",2)(2,"mat-card-header",3)(3,"div",4),h("click",function(){return P(o),v(t.alternarImagen())}),_(4,Ye,1,1,"img",5)(5,Je,1,1,"ng-template",null,0,te),a(),r(7,"div",6)(8,"mat-card-title"),l(9),F(10,"capitalize"),F(11,"capitalize"),a(),r(12,"mat-card-subtitle"),l(13),F(14,"titlecase"),a()()(),r(15,"mat-card-content")(16,"div",7)(17,"p")(18,"strong"),l(19,"Email:"),a(),l(20),a(),_(21,Xe,10,1,"ng-container",8)(22,Ke,5,1,"ng-container",8),a()()(),_(23,it,7,1,"div",9),a()}if(e&2){let o=X(6);c("@slideFadeIn",void 0),s(4),c("ngIf",t.mostrarPrimeraImagen)("ngIfElse",o),s(5),K("",T(10,10,t.user==null?null:t.user.nombre)," ",T(11,12,t.user==null?null:t.user.apellido)),s(4),b(T(14,14,t.user==null?null:t.user.rol)),s(7),k(" ",t.user==null?null:t.user.email),s(),c("ngIf",(t.user==null?null:t.user.rol)==="paciente"),s(),c("ngIf",(t.user==null?null:t.user.rol)==="especialista"),s(),c("ngIf",(t.user==null?null:t.user.rol)==="especialista")}},dependencies:[H,$,ie,ne,z,ue,pe,de,ce,ae,oe,le,se,re,V,N,ze],styles:[".mi-perfil-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}.perfil-card[_ngcontent-%COMP%]{max-width:420px;width:100%;margin-bottom:2rem;background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem 1rem}.perfil-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover}.perfil-datos[_ngcontent-%COMP%]{margin-top:1rem}.perfil-datos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:1.08rem}.perfil-img-secundaria[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover;margin-top:.5rem;margin-left:.5rem;border:2px solid rgba(66,165,245,.2666666667)}.datos-usuario[_ngcontent-%COMP%]{margin-bottom:2rem}.datos-usuario[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;margin-right:1rem}.mis-horarios[_ngcontent-%COMP%]{margin-top:2rem;background:var(--card-bg);border-radius:16px;box-shadow:0 2px 12px var(--shadow);padding:2rem 1.5rem;max-width:700px;width:100%}.mis-horarios[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.2rem;color:var(--button-bg);font-weight:700;letter-spacing:1px}.mis-horarios[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:1.2rem 0 .5rem;color:#1976d2;font-weight:600;font-size:1.1rem}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0;margin-bottom:1.5rem;width:100%;background:#e3f2fd}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #bbdefb;padding:.5rem .7rem;text-align:center;font-size:1rem}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#e1f5fe;color:#0d47a1;font-weight:600}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]{background:#e3f2fd}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:#bbdefb;transition:background .2s}.mis-horarios[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{accent-color:#1976d2;width:1.2rem;height:1.2rem;cursor:pointer;transition:box-shadow .2s;box-shadow:0 0 0 1.5px #42a5f544}.mis-horarios[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{margin-top:1rem;background:linear-gradient(45deg,#1976d2,#42a5f5);color:#fff;border:none;border-radius:8px;padding:.7rem 2.2rem;font-size:1.1rem;font-weight:700;letter-spacing:1px;box-shadow:0 2px 8px var(--shadow);transition:background .2s,transform .2s;cursor:pointer}.mis-horarios[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#0d47a1,#2196f3);transform:translateY(-2px) scale(1.03)}.perfil-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}.perfil-avatar[_ngcontent-%COMP%]{margin-right:16px}.perfil-titulos[_ngcontent-%COMP%]{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end}.perfil-imagenes[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.acciones[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;flex-wrap:wrap}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 auto}"],data:{animation:[He("slideFadeIn",[Ve(":enter",[W({opacity:0,transform:"translateX(-40px)"}),Ne("1000ms cubic-bezier(.35,0,.25,1)",W({opacity:1,transform:"none"}))])])]}})};export{Ae as MiPerfil};
