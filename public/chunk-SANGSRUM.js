import{a as ve,b as be}from"./chunk-QLTCTTX5.js";import{d as Z}from"./chunk-QVZXHZEN.js";import{a as fe}from"./chunk-2PFZDCX4.js";import{a as me,b as he}from"./chunk-QWFVVTTS.js";import{a as pe}from"./chunk-TGIHQLGF.js";import"./chunk-FK6H3RFT.js";import{e as ce,f as de}from"./chunk-ACRLQNAC.js";import{c as ue}from"./chunk-IK44VX35.js";import"./chunk-RSYSO6ZY.js";import{B as ee,D as te,E as ie,I as oe,u as B}from"./chunk-3BOR7B33.js";import{Ab as q,Bb as w,Cb as C,Eb as D,Gb as _,Hb as f,Kc as G,Lc as Y,Nc as X,Oa as Q,Qa as s,Qc as J,Vb as a,W as x,Wb as z,Wd as H,Xb as v,Xd as L,Yb as K,Zd as j,_ as A,_d as ne,ab as S,ae as re,bb as M,db as T,ea as g,ec as F,fa as y,fc as b,gb as h,gc as R,ge as ae,ie as se,le,n as $,ub as W,xb as m,yb as r,zb as n}from"./chunk-QSMPMUOS.js";import{f as V,h as k}from"./chunk-FJYW2LMB.js";var _e=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275mod=M({type:t});static \u0275inj=x({imports:[oe]})}return t})();var ge=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275mod=M({type:t});static \u0275inj=x({imports:[B,_e,B]})}return t})();var we=V(ve()),Ce=V(be());var O=class t{transform(i){return(i?i.toString():"").replace(/(\d{2,3})(\d{3})(\d{3})/,"$1.$2.$3")}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=T({name:"dniFormat",type:t,pure:!0})};var I=class t{transform(i){switch(i){case"admin":return"Administrador";case"especialista":return"Especialista";case"paciente":return"Paciente";default:return i}}static \u0275fac=function(e){return new(e||t)};static \u0275pipe=T({name:"rolLegible",type:t,pure:!0})};var Pe=()=>[],Ne=()=>["/register"],Ae=()=>["/admin/informes"];function ze(t,i){if(t&1&&q(0,"img",16),t&2){let e=f().$implicit;m("src",e.imagen1,Q)}}function Be(t,i){if(t&1&&(r(0,"p")(1,"strong"),a(2,"Aprobado:"),n(),a(3),n()),t&2){let e=f().$implicit;s(3),v(" ",e.aprobado?"S\xED":"No")}}function He(t,i){if(t&1){let e=D();r(0,"button",19),_("click",function(){g(e);let d=f(2).$implicit,u=f();return y(u.cambiarEstadoEspecialista(d.uid,!0))}),a(1,"Habilitar"),n()}}function Le(t,i){if(t&1){let e=D();r(0,"button",20),_("click",function(){g(e);let d=f(2).$implicit,u=f();return y(u.cambiarEstadoEspecialista(d.uid,!1))}),a(1,"Inhabilitar"),n()}}function je(t,i){if(t&1&&(w(0),h(1,He,2,0,"button",17)(2,Le,2,0,"button",18),C()),t&2){let e=f().$implicit;s(),m("ngIf",!e.aprobado),s(),m("ngIf",e.aprobado)}}function Ue(t,i){if(t&1){let e=D();w(0),r(1,"button",19),_("click",function(){g(e);let d=f().$implicit,u=f();return y(u.verHistorialClinico(d))}),a(2," Ver Historial Cl\xEDnico "),n(),C()}}function Ve(t,i){if(t&1){let e=D();w(0),r(1,"button",21),_("click",function(){g(e);let d=f().$implicit,u=f();return y(u.descargarTurnosPDF(d))}),a(2," Descargar Turnos PDF "),n(),C()}}function $e(t,i){if(t&1){let e=D();r(0,"div",5)(1,"div",6),h(2,ze,1,1,"img",7),r(3,"div",8)(4,"div",9)(5,"span",10),a(6),b(7,"capitalize"),b(8,"capitalize"),n(),r(9,"button",11),_("click",function(){let d=g(e).$implicit,u=f();return y(u.toggleFavorito(d))}),r(10,"mat-icon"),a(11),n()()(),r(12,"span",12),a(13,"Email:"),n(),r(14,"span",13),a(15),n()()(),r(16,"p")(17,"strong"),a(18,"DNI:"),n(),a(19),b(20,"dniFormat"),n(),r(21,"p")(22,"strong"),a(23,"Rol:"),n(),a(24),b(25,"rolLegible"),n(),h(26,Be,4,1,"p",14),r(27,"div",15),h(28,je,3,2,"ng-container",14)(29,Ue,3,0,"ng-container",14)(30,Ve,3,0,"ng-container",14),n()()}if(t&2){let e=i.$implicit;s(2),m("ngIf",e.imagen1),s(4),K("",R(7,12,e.nombre)," ",R(8,14,e.apellido)),s(3),W("aria-label","Favorito"),s(2),z(e.favorito?"favorite":"favorite_border"),s(4),z(e.email),s(4),v(" ",R(20,16,e.dni)),s(5),v(" ",R(25,18,e.rol)),s(2),m("ngIf",e.rol==="especialista"),s(2),m("ngIf",e.rol==="especialista"),s(),m("ngIf",e.rol==="paciente"),s(),m("ngIf",e.rol!=="admin")}}var ye=class t{firestore=A(ne);dialog=A(ue);usuarios$=re(H(this.firestore,"usuarios"),{idField:"uid"});cambiarEstadoEspecialista(i,e){return k(this,null,function*(){let c=L(this.firestore,`usuarios/${i}`);yield j(c,{aprobado:e})})}verHistorialClinico(i){this.dialog.open(fe,{width:"600px",data:{paciente:{uid:i.uid,nombre:i.nombre,apellido:i.apellido}}})}descargarExcel(){return k(this,null,function*(){let e=(yield $(this.usuarios$)).map(o=>({Nombre:o.nombre,Apellido:o.apellido,Email:o.email,Rol:o.rol,Especialidad:Array.isArray(o.especialidad)?o.especialidad.join(", "):o.especialidad||"",ObraSocial:o.obraSocial||"",Aprobado:o.aprobado!==void 0?o.aprobado?"S\xED":"No":""})),c=new we.default.Workbook,d=c.addWorksheet("Usuarios");d.columns=Object.keys(e[0]).map(o=>({header:o,key:o,width:20})),d.getRow(1).eachCell(o=>{o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"8E24AA"}},o.font={bold:!0,color:{argb:"FFFFFF"}},o.alignment={vertical:"middle",horizontal:"center"},o.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),e.forEach(o=>{d.addRow(o).eachCell(l=>{l.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},l.alignment={vertical:"middle",horizontal:"left",wrapText:!0}})}),d.columns.forEach((o,p)=>{let l=o.header?o.header.toString().length:10;d.eachRow(N=>{let U=N.getCell(p+1),De=U.value?U.value.toString():"";l=Math.max(l,De.length+2)}),o.width=l});let u=yield c.xlsx.writeBuffer(),P=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});(0,Ce.saveAs)(P,"Usuarios.xlsx")})}toggleFavorito(i){return k(this,null,function*(){let e=L(this.firestore,`usuarios/${i.uid}`);yield j(e,{favorito:!i.favorito})})}descargarTurnosPDF(i){return k(this,null,function*(){let e=i.rol==="paciente",c=e?"pacienteUid":"especialistaUid",u=(yield ae(se(H(this.firestore,"turnos"),le(c,"==",i.uid)))).docs.map(l=>l.data());if(u=u.sort((l,N)=>new Date(N.fecha).getTime()-new Date(l.fecha).getTime()),u.length===0){alert("No hay turnos para este usuario.");return}let P=u.map(l=>[l.fecha?new Date(l.fecha).toLocaleString():"",l.especialidad||"",l.especialistaNombre||"",l.pacienteNombre||"",l.estado||"",l.comentarioCancelacion||"",l.resena||""]),o=e?[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]]:[["Fecha","Especialidad","Especialista","Paciente","Estado","Comentario","Rese\xF1a"]],p=new me;p.setFontSize(16),p.text("Turnos de "+i.nombre+" "+i.apellido,14,18),he(p,{startY:24,head:o,body:P,styles:{fontSize:10},headStyles:{fillColor:[142,36,170],textColor:255,fontStyle:"bold"}}),p.save(`Turnos-${i.nombre}-${i.apellido}.pdf`)})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=S({type:t,selectors:[["app-admin-usuarios"]],decls:12,vars:8,consts:[[1,"admin-usuarios-container"],["mat-raised-button","","color","accent",2,"margin-bottom","1rem",3,"click"],[1,"usuarios-lista"],["class","usuario-card",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",1,"botonRegistrar",3,"routerLink"],[1,"usuario-card"],[1,"usuario-header"],["alt","Foto de perfil","class","usuario-avatar",3,"src",4,"ngIf"],[1,"usuario-nombre-fav"],[1,"nombre-fav-row"],[1,"nombre"],["mat-icon-button","","color","warn",3,"click"],[1,"email-label"],[1,"email-value"],[4,"ngIf"],[1,"acciones"],["alt","Foto de perfil",1,"usuario-avatar",3,"src"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,c){e&1&&(r(0,"div",0)(1,"h2"),a(2,"Gesti\xF3n de Usuarios"),n(),r(3,"button",1),_("click",function(){return c.descargarExcel()}),a(4," Descargar Excel de Usuarios "),n(),r(5,"div",2),h(6,$e,31,20,"div",3),b(7,"async"),n(),r(8,"button",4),a(9," Crear nuevo usuario "),n(),r(10,"button",4),a(11," Informes "),n()()),e&2&&(s(6),m("ngForOf",R(7,3,c.usuarios$)||F(5,Pe)),s(2),m("routerLink",F(6,Ne)),s(2),m("routerLink",F(7,Ae)))},dependencies:[J,G,Y,X,ge,ie,te,ee,Z,de,ce,pe,O,I],styles:[".admin-usuarios-container[_ngcontent-%COMP%]{background:var(--bg-color);min-height:100vh;padding:1rem;margin:0;color:var(--text-color)}table[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.botonRegistrar[_ngcontent-%COMP%]{margin-top:1rem;margin-left:.5rem}.usuarios-lista[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-top:1.5rem;justify-content:center}.usuario-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem;display:flex;flex-direction:column;justify-content:space-between;color:var(--text-color);transition:transform .2s ease;min-width:320px;max-width:420px}.usuario-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.usuario-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem;color:var(--text-color)}.usuario-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.usuario-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}.usuario-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]{flex:1 1 auto;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   .nombre[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .nombre-fav-row[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{margin-left:1rem;align-self:center}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-label[_ngcontent-%COMP%]{display:block;margin:.2rem 0 0;font-size:.95rem;font-weight:700;color:var(--text-color)}.usuario-header[_ngcontent-%COMP%]   .usuario-nombre-fav[_ngcontent-%COMP%]   .email-value[_ngcontent-%COMP%]{display:block;font-size:.95rem;width:100%;word-break:break-all;color:var(--text-color);margin-bottom:.2rem}.usuario-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid rgba(142,36,170,.2666666667)}.usuario-nombre[_ngcontent-%COMP%]{display:flex;flex-direction:column}.usuario-nombre[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.2rem}.usuario-nombre[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0 0;font-size:.95rem}"]})};export{ye as AdminUsuarios};
