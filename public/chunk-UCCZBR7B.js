import{a as be,c as Ce,d as R}from"./chunk-FDUZJOFO.js";import{a as oe,b as se,c as le,d as ce,f as de,g as pe,h as he,k as xe,l as Me}from"./chunk-YW64IYPY.js";import{a as $e}from"./chunk-LHRJ7T32.js";import{a as He,b as Ve}from"./chunk-UE7YZPCJ.js";import{a as ze}from"./chunk-OGFC4C5S.js";import"./chunk-FK6H3RFT.js";import{f as we,g as ye,h as Ie,i as De,k as ke,l as Fe,m as Te,n as Ne}from"./chunk-ULQMERRE.js";import{c as Oe}from"./chunk-KO3D423Z.js";import{D as B,F as A,Z as Se}from"./chunk-VT4TCVZO.js";import{$b as ee,$c as me,Ab as F,Bb as T,Cb as N,Eb as D,Gb as x,Hb as d,Jc as V,Kc as ne,Nc as ae,Oa as Y,Oc as re,Pc as z,Qa as s,Rb as Q,Va as G,Vb as n,Wb as C,Xb as g,Yb as X,Zd as Pe,_ as I,_b as Z,ab as k,ac as te,ad as ge,bd as ue,cd as fe,ce as S,dd as _e,de as W,ea as E,ec as P,ee as ve,fa as O,fc as $,fe as w,gb as _,gc as H,hc as ie,id as j,ie as y,ke as Ee,le as b,xb as c,yb as r,zb as t}from"./chunk-VNSJBZ2B.js";import{h as v}from"./chunk-FJYW2LMB.js";function We(a,o){if(a&1&&(r(0,"mat-option",3),n(1),t()),a&2){let e=o.$implicit;c("value",e),s(),C(e)}}var U=class a{constructor(o,e){this.dialogRef=o;this.data=e;this.especialistas=e.especialistas||[]}especialista="";especialistas=[];static \u0275fac=function(e){return new(e||a)(G(ye),G(Ie))};static \u0275cmp=k({type:a,selectors:[["app-dialogo-seleccionar-especialista"]],decls:15,vars:3,consts:[["mat-dialog-title",""],["appearance","fill",2,"width","100%"],[3,"ngModelChange","ngModel"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,i){e&1&&(r(0,"h2",0),n(1,"Seleccionar especialista"),t(),r(2,"mat-dialog-content")(3,"mat-form-field",1)(4,"mat-label"),n(5,"Especialista"),t(),r(6,"mat-select",2),te("ngModelChange",function(p){return ee(i.especialista,p)||(i.especialista=p),p}),r(7,"mat-option",3),n(8,"Todos"),t(),_(9,We,2,2,"mat-option",4),t()()(),r(10,"mat-dialog-actions",5)(11,"button",6),x("click",function(){return i.dialogRef.close()}),n(12,"Cancelar"),t(),r(13,"button",7),x("click",function(){return i.dialogRef.close(i.especialista)}),n(14,"Aceptar"),t()()),e&2&&(s(6),Z("ngModel",i.especialista),s(),c("value",""),s(2),c("ngForOf",i.especialistas))},dependencies:[z,V,j,me,fe,Ne,ke,Te,Fe,A,B,R,xe,he,Ce,be],styles:["[_nghost-%COMP%]     .mat-mdc-dialog-container{background:linear-gradient(135deg,#fff,#f8fbff);border-radius:16px;min-width:400px;box-shadow:0 8px 32px #1976d226;overflow:hidden}[_nghost-%COMP%]     .mat-mdc-dialog-content{overflow-x:hidden!important;padding:0 24px 24px!important}[_nghost-%COMP%]     button[mat-button]{border-radius:8px!important;padding:12px 24px!important;font-weight:600!important;transition:all .3s ease!important;margin:4px!important}[_nghost-%COMP%]     button[mat-button][color=primary]{background:linear-gradient(135deg,#1976d2,#42a5f5)!important;color:#fff!important;box-shadow:0 3px 12px #1976d24d!important}[_nghost-%COMP%]     button[mat-button][color=primary]:hover{transform:translateY(-1px)!important;box-shadow:0 4px 16px #1976d266!important}[_nghost-%COMP%]     button[mat-button]:not([color=primary]){background:linear-gradient(135deg,#64b5f6,#90caf9)!important;color:#fff!important;box-shadow:0 3px 12px #42a5f54d!important}[_nghost-%COMP%]     button[mat-button]:not([color=primary]):hover{transform:translateY(-1px)!important;box-shadow:0 4px 16px #42a5f566!important}h2[mat-dialog-title][_ngcontent-%COMP%]{color:#1976d2!important;background:linear-gradient(135deg,#f8fbff,#e3f2fd);margin:-24px -24px 20px;padding:20px;text-align:center;border-bottom:2px solid #e3f2fd;font-weight:600}"]})};function qe(a,o){if(a&1&&F(0,"img",10),a&2){let e=d();c("src",e.user==null?null:e.user.imagen1,Y)}}function Je(a,o){if(a&1&&F(0,"img",11),a&2){let e=d();c("src",e.user==null?null:e.user.imagen2,Y)}}function Ke(a,o){if(a&1){let e=D();T(0),r(1,"p")(2,"strong"),n(3,"DNI:"),t(),n(4),t(),r(5,"p")(6,"strong"),n(7,"Edad:"),t(),n(8),t(),r(9,"p")(10,"strong"),n(11,"Fecha de Nacimiento:"),t(),n(12),P(13,"date"),t(),r(14,"p")(15,"strong"),n(16,"Obra Social:"),t(),n(17),t(),r(18,"div",12)(19,"button",13),x("click",function(){E(e);let l=d();return O(l.verHistorialClinico())}),n(20,"Ver Historial Cl\xEDnico"),t(),r(21,"button",14),x("click",function(){E(e);let l=d();return O(l.descargarHistorialPDF())}),n(22,"Descargar Historia Cl\xEDnica (PDF)"),t()(),N()}if(a&2){let e=d();s(4),g(" ",e.user==null?null:e.user.dni),s(4),g(" ",e.calcularEdad(e.user==null?null:e.user.fechaNacimiento)," a\xF1os"),s(4),g(" ",H(13,4,e.user==null?null:e.user.fechaNacimiento,"dd/MM/yyyy")),s(5),g(" ",e.user==null?null:e.user.obraSocial)}}function Qe(a,o){a&1&&(r(0,"p")(1,"strong"),n(2,"Estado:"),t(),r(3,"span",15),n(4,"\u2713 Verificado"),t()())}function Xe(a,o){a&1&&(r(0,"p")(1,"strong"),n(2,"Estado:"),t(),r(3,"span",16),n(4,"\u26A0 Pendiente de verificaci\xF3n"),t()())}function Ze(a,o){if(a&1&&(T(0),r(1,"p")(2,"strong"),n(3,"DNI:"),t(),n(4),t(),r(5,"p")(6,"strong"),n(7,"Edad:"),t(),n(8),t(),r(9,"p")(10,"strong"),n(11,"Fecha de Nacimiento:"),t(),n(12),P(13,"date"),t(),r(14,"p")(15,"strong"),n(16,"Especialidades:"),t(),n(17),t(),_(18,Qe,5,0,"p",8)(19,Xe,5,0,"p",8),N()),a&2){let e=d();s(4),g(" ",e.user==null?null:e.user.dni),s(4),g(" ",e.calcularEdad(e.user==null?null:e.user.fechaNacimiento)," a\xF1os"),s(4),g(" ",H(13,6,e.user==null?null:e.user.fechaNacimiento,"dd/MM/yyyy")),s(5),g(" ",e.especialidades.join(", ")),s(),c("ngIf",e.user==null?null:e.user.verificado),s(),c("ngIf",!(e.user!=null&&e.user.verificado))}}function et(a,o){if(a&1&&(T(0),r(1,"p")(2,"strong"),n(3,"DNI:"),t(),n(4),t(),r(5,"p")(6,"strong"),n(7,"Edad:"),t(),n(8),t(),r(9,"p")(10,"strong"),n(11,"Fecha de Nacimiento:"),t(),n(12),P(13,"date"),t(),r(14,"p")(15,"strong"),n(16,"Rol:"),t(),r(17,"span",17),n(18,"Administrador"),t()(),N()),a&2){let e=d();s(4),g(" ",e.user==null?null:e.user.dni),s(4),g(" ",e.calcularEdad(e.user==null?null:e.user.fechaNacimiento)," a\xF1os"),s(4),g(" ",H(13,3,e.user==null?null:e.user.fechaNacimiento,"dd/MM/yyyy"))}}function tt(a,o){if(a&1&&(r(0,"th"),n(1),t()),a&2){let e=o.$implicit;s(),C(e)}}function it(a,o){if(a&1){let e=D();r(0,"td")(1,"input",22),x("change",function(){let l=E(e).$implicit,p=d().$implicit,q=d().$implicit,M=d(2);return O(M.toggleHorario(q,p,l))}),t()()}if(a&2){let e=o.$implicit,i=d().$implicit,l=d().$implicit,p=d(2);s(),c("checked",p.tieneHorario(l,i,e))}}function nt(a,o){if(a&1&&(r(0,"tr")(1,"td"),n(2),t(),_(3,it,2,1,"td",20),t()),a&2){let e=o.$implicit,i=d(3);s(2),C(e),s(),c("ngForOf",i.horas)}}function at(a,o){if(a&1&&(r(0,"div")(1,"h4"),n(2),t(),r(3,"table")(4,"tr"),F(5,"th"),_(6,tt,2,1,"th",20),t(),_(7,nt,4,2,"tr",20),t()()),a&2){let e=o.$implicit,i=d(2);s(2),C(e),s(4),c("ngForOf",i.horas),s(),c("ngForOf",i.dias)}}function rt(a,o){if(a&1){let e=D();r(0,"div",18)(1,"h3"),n(2,"Mis Horarios"),t(),r(3,"form",19),x("ngSubmit",function(){E(e);let l=d();return O(l.guardarHorarios())}),_(4,at,8,3,"div",20),r(5,"button",21),n(6,"Guardar Horarios"),t()()()}if(a&2){let e=d();s(4),c("ngForOf",e.especialidades)}}var Be=class a{authService=I(Se);firestore=I(Pe);snackBar=I(Oe);dialog=I(De);user=null;especialidades=[];horarios={};dias=["Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"];horas=["09:00","09:30","10:00","10:30","11:00","11:30","16:00","16:30","17:00","17:30"];mostrarPrimeraImagen=!0;alternarImagen(){this.mostrarPrimeraImagen=!this.mostrarPrimeraImagen}calcularEdad(o){if(!o)return 0;let e=new Date,i=new Date(o),l=e.getFullYear()-i.getFullYear(),p=e.getMonth()-i.getMonth();return(p<0||p===0&&e.getDate()<i.getDate())&&l--,l}ngOnInit(){return v(this,null,function*(){this.user=this.authService.userSignal(),this.user?.rol==="especialista"&&(yield this.cargarEspecialidades(),yield this.cargarHorarios())})}cargarEspecialidades(){return v(this,null,function*(){Array.isArray(this.user.especialidad)?this.especialidades=this.user.especialidad:this.user.especialidad?this.especialidades=[this.user.especialidad]:this.especialidades=[]})}cargarHorarios(){return v(this,null,function*(){let o=W(this.firestore,"usuarios",this.user.uid),i=(yield ve(o)).data();this.horarios=i?.horarios||{}})}toggleHorario(o,e,i){this.horarios[o]||(this.horarios[o]=[]);let l=`${e} ${i}`,p=this.horarios[o].indexOf(l);p>-1?this.horarios[o].splice(p,1):this.horarios[o].push(l)}tieneHorario(o,e,i){return this.horarios[o]?.includes(`${e} ${i}`)}guardarHorarios(){return v(this,null,function*(){let o=W(this.firestore,"usuarios",this.user.uid);yield Ee(o,{horarios:this.horarios}),this.snackBar.open("Horarios actualizados correctamente","",{duration:3500,panelClass:["success-snackbar"],verticalPosition:"top",horizontalPosition:"center"})})}verHistorialClinico(){this.dialog.open($e,{width:"600px",data:{paciente:{uid:this.user.uid,nombre:this.user.nombre,apellido:this.user.apellido,rol:this.user.rol}}})}descargarHistorialPDF(){return v(this,null,function*(){let o=S(this.firestore,"historias-clinicas"),e=y(o,b("pacienteUid","==",this.user.uid)),l=(yield w(e)).docs.map(f=>f.data()).sort((f,m)=>new Date(m.fecha).getTime()-new Date(f.fecha).getTime());if(l.length===0){this.snackBar.open("No hay historia cl\xEDnica para descargar","Cerrar",{duration:2e3});return}let p=Array.from(new Set(l.map(f=>f.especialistaNombre))),M=yield this.dialog.open(U,{width:"350px",data:{especialistas:p}}).afterClosed().toPromise();if(M===void 0)return;let Ae=M?l.filter(f=>f.especialistaNombre===M):l,J=[],K=[];M?(J=(yield w(y(S(this.firestore,"turnos"),b("pacienteUid","==",this.user.uid),b("especialistaNombre","==",M)))).docs.map(h=>h.data()),K=(yield w(y(S(this.firestore,"rese\xF1as"),b("pacienteUid","==",this.user.uid),b("especialistaNombre","==",M)))).docs.map(h=>h.data())):(J=(yield w(y(S(this.firestore,"turnos"),b("pacienteUid","==",this.user.uid)))).docs.map(h=>h.data()),K=(yield w(y(S(this.firestore,"rese\xF1as"),b("pacienteUid","==",this.user.uid)))).docs.map(h=>h.data()));let u=new He,je="assets/favicon.ico",L=new Image;L.src=je,L.onload=()=>{u.addImage(L,"PNG",10,10,16,16),u.setFontSize(18),u.text("Historia Cl\xEDnica",30,20),u.setFontSize(11),u.text(`Fecha de emisi\xF3n: ${new Date().toLocaleString()}`,30,28),u.setFontSize(12),u.text(`Paciente: ${this.user.nombre} ${this.user.apellido}`,14,40),u.text(`Email: ${this.user.email}`,14,47),u.text(`Obra Social: ${this.user.obraSocial||"-"}`,14,54),Ve(u,{startY:62,head:[["Fecha","Especialista","Especialidad","Altura","Peso","Temp.","Presi\xF3n","Datos adicionales"]],body:Ae.map(m=>[m.fecha?new Date(m.fecha).toLocaleString():"",m.especialistaNombre||"",m.especialidad||"",m.altura||"",m.peso||"",m.temperatura||"",m.presion||"",m.dinamicos&&m.dinamicos.length?m.dinamicos.map(h=>`${h.clave}: ${h.valor}`).join(`
`):""]),styles:{fontSize:10},headStyles:{fillColor:[25,118,210],textColor:255,fontStyle:"bold"}});let f=`historia-clinica-${this.user.nombre}-${this.user.apellido}`.replace(/\s+/g,"_")+".pdf";u.save(f)}})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-mi-perfil"]],decls:25,vars:16,consts:[["segundaImagen",""],[1,"mi-perfil-container"],[1,"perfil-card"],[1,"perfil-header"],[1,"perfil-avatar",2,"cursor","pointer",3,"click"],["alt","Imagen de perfil",3,"src",4,"ngIf","ngIfElse"],[1,"perfil-titulos"],[1,"perfil-datos"],[4,"ngIf"],["class","mis-horarios",4,"ngIf"],["alt","Imagen de perfil",3,"src"],["alt","Imagen secundaria",3,"src"],[1,"acciones"],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","","color","accent",3,"click"],[2,"color","green"],[2,"color","red"],[2,"color","blue","font-weight","bold"],[1,"mis-horarios"],[3,"ngSubmit"],[4,"ngFor","ngForOf"],["type","submit"],["type","checkbox",3,"change","checked"]],template:function(e,i){if(e&1){let l=D();r(0,"div",1)(1,"mat-card",2)(2,"mat-card-header",3)(3,"div",4),x("click",function(){return E(l),O(i.alternarImagen())}),_(4,qe,1,1,"img",5)(5,Je,1,1,"ng-template",null,0,ie),t(),r(7,"div",6)(8,"mat-card-title"),n(9),P(10,"capitalize"),P(11,"capitalize"),t(),r(12,"mat-card-subtitle"),n(13),P(14,"titlecase"),t()()(),r(15,"mat-card-content")(16,"div",7)(17,"p")(18,"strong"),n(19,"Email:"),t(),n(20),t(),_(21,Ke,23,7,"ng-container",8)(22,Ze,20,9,"ng-container",8)(23,et,19,6,"ng-container",8),t()()(),_(24,rt,7,1,"div",9),t()}if(e&2){let l=Q(6);s(4),c("ngIf",i.mostrarPrimeraImagen)("ngIfElse",l),s(5),X("",$(10,10,i.user==null?null:i.user.nombre)," ",$(11,12,i.user==null?null:i.user.apellido)),s(4),C($(14,14,i.user==null?null:i.user.rol)),s(7),g(" ",i.user==null?null:i.user.email),s(),c("ngIf",(i.user==null?null:i.user.rol)==="paciente"),s(),c("ngIf",(i.user==null?null:i.user.rol)==="especialista"),s(),c("ngIf",(i.user==null?null:i.user.rol)==="admin"),s(),c("ngIf",(i.user==null?null:i.user.rol)==="especialista")}},dependencies:[z,V,ne,ae,re,j,_e,ge,ue,pe,oe,le,de,ce,se,A,B,Me,R,we,ze],styles:[".mi-perfil-container[_ngcontent-%COMP%]{background:var(--bg-color);color:var(--text-color);padding:2rem;min-height:100vh;display:flex;flex-direction:column;align-items:center}.perfil-card[_ngcontent-%COMP%]{max-width:420px;width:100%;margin-bottom:2rem;background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem 1rem}.perfil-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover}.perfil-datos[_ngcontent-%COMP%]{margin-top:1rem}.perfil-datos[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:1.08rem}.perfil-img-secundaria[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;object-fit:cover;margin-top:.5rem;margin-left:.5rem;border:2px solid rgba(66,165,245,.2666666667)}.datos-usuario[_ngcontent-%COMP%]{margin-bottom:2rem}.datos-usuario[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;margin-right:1rem}.mis-horarios[_ngcontent-%COMP%]{margin-top:2rem;background:var(--card-bg);border-radius:16px;box-shadow:0 2px 12px var(--shadow);padding:2rem 1.5rem;max-width:700px;width:100%}.mis-horarios[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:1.2rem;color:var(--button-bg);font-weight:700;letter-spacing:1px}.mis-horarios[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:1.2rem 0 .5rem;color:#1976d2;font-weight:600;font-size:1.1rem}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{border-collapse:separate;border-spacing:0;margin-bottom:1.5rem;width:100%;background:#e3f2fd}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #bbdefb;padding:.5rem .7rem;text-align:center;font-size:1rem}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#e1f5fe;color:#0d47a1;font-weight:600}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]{background:#e3f2fd}.mis-horarios[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover   td[_ngcontent-%COMP%]{background:#bbdefb;transition:background .2s}.mis-horarios[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{accent-color:#1976d2;width:1.2rem;height:1.2rem;cursor:pointer;transition:box-shadow .2s;box-shadow:0 0 0 1.5px #42a5f544}.mis-horarios[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{margin-top:1rem;background:linear-gradient(45deg,#1976d2,#42a5f5);color:#fff;border:none;border-radius:8px;padding:.7rem 2.2rem;font-size:1.1rem;font-weight:700;letter-spacing:1px;box-shadow:0 2px 8px var(--shadow);transition:background .2s,transform .2s;cursor:pointer}.mis-horarios[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#0d47a1,#2196f3);transform:translateY(-2px) scale(1.03)}.perfil-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start}.perfil-avatar[_ngcontent-%COMP%]{margin-right:16px}.perfil-titulos[_ngcontent-%COMP%]{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end}.perfil-imagenes[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.acciones[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem;flex-wrap:wrap}.acciones[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 auto}.descarga-profesional[_ngcontent-%COMP%]{margin-top:2rem;padding:1.5rem;border:1px solid #e0e0e0;border-radius:12px;background:#fafafa}.descarga-profesional[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:#1976d2;font-weight:500}.descarga-profesional[_ngcontent-%COMP%]   .selector-profesional[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.descarga-profesional[_ngcontent-%COMP%]   .selector-profesional[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.descarga-profesional[_ngcontent-%COMP%]   .selector-profesional[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-start;min-width:200px}.descarga-profesional[_ngcontent-%COMP%]   .selector-profesional[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}"]})};export{Be as MiPerfil};
