import{a as O}from"./chunk-QJJ6XZSH.js";import"./chunk-APLPVFR3.js";import{a as J,g as K}from"./chunk-22RZQUIB.js";import{a as se}from"./chunk-XS7FXMRS.js";import{a as le,b as de}from"./chunk-QPA6Z6J3.js";import"./chunk-VRI254XT.js";import{a as ee,b as te,c as ie,d as ne,e as ae,f as oe,g as re,h as ce}from"./chunk-3NRJ3LZB.js";import{B as Q,D as E,E as w,Y as Z}from"./chunk-OFOXLQEH.js";import{Ab as z,Eb as S,Gb as h,Hb as d,Jc as q,Kc as y,Oa as B,Oc as G,Pc as I,Qa as c,Rb as H,Tb as U,Va as F,Vb as o,Wb as f,Yb as k,Yd as W,_ as C,ab as M,be as D,ce as X,de as Y,ea as x,ec as P,ee as T,fa as v,fc as V,gb as m,gc as $,ge as N,hc as L,je as A,xb as l,yb as n,zb as a}from"./chunk-SR5OJR6W.js";import{a as j,h as _}from"./chunk-FJYW2LMB.js";function xe(i,t){if(i&1&&(n(0,"p"),o(1),a()),i&2){let e=d();c(),f(e.data.resena)}}function ve(i,t){i&1&&(n(0,"p"),o(1,"No hay rese\xF1a para este turno."),a())}var R=class i{constructor(t,e){this.dialogRef=t;this.data=e}static \u0275fac=function(e){return new(e||i)(F(ee),F(te))};static \u0275cmp=M({type:i,selectors:[["app-dialogo-resena-turno"]],decls:9,vars:2,consts:[["sinResena",""],["mat-dialog-title",""],[4,"ngIf","ngIfElse"],["align","end"],["mat-button","","mat-dialog-close",""]],template:function(e,r){if(e&1&&(n(0,"h2",1),o(1,"Rese\xF1a de la consulta"),a(),n(2,"mat-dialog-content"),m(3,xe,2,1,"p",2)(4,ve,2,0,"ng-template",null,0,L),a(),n(6,"mat-dialog-actions",3)(7,"button",4),o(8,"Cerrar"),a()()),e&2){let s=H(5);c(3),l("ngIf",r.data.resena)("ngIfElse",s)}},dependencies:[I,y,ce,ne,ae,re,oe,w,E],encapsulation:2})};function he(i,t){i&1&&(n(0,"div"),o(1,"Cargando..."),a())}function be(i,t){i&1&&(n(0,"div"),o(1,"No has atendido pacientes a\xFAn."),a())}function Ce(i,t){if(i&1){let e=S();n(0,"mat-card",5)(1,"div",6),z(2,"img",7),n(3,"div",8)(4,"h3"),o(5),P(6,"capitalize"),P(7,"capitalize"),a(),n(8,"button",9),h("click",function(){let s=x(e).$implicit,p=d(2);return v(p.toggleFavorito(s))}),n(9,"mat-icon"),o(10),a()()()(),n(11,"button",10),h("click",function(){let s=x(e).$implicit,p=d(2);return v(p.seleccionarPaciente(s))}),o(12,"Ver detalles"),a()()}if(i&2){let e=t.$implicit,r=d(2);U("selected",(r.pacienteSeleccionado==null?null:r.pacienteSeleccionado.uid)===e.uid),c(2),l("src",e.imagen1||"assets/paciente.jpg",B),c(3),k("",V(6,6,e.nombre)," ",V(7,8,e.apellido)),c(5),f(e.favorito?"favorite":"favorite_border")}}function Me(i,t){if(i&1&&(n(0,"div",3),m(1,Ce,13,10,"mat-card",4),a()),i&2){let e=d();c(),l("ngForOf",e.pacientes)}}function Se(i,t){if(i&1){let e=S();n(0,"button",13),h("click",function(){x(e);let s=d().$implicit,p=d(2);return v(p.verResena(s))}),o(1,"Ver Rese\xF1a"),a()}}function Pe(i,t){if(i&1){let e=S();n(0,"button",13),h("click",function(){x(e);let s=d().$implicit,p=d(2);return v(p.verHistorialClinicoTurno(s))}),o(1,"Ver Historial Cl\xEDnico"),a()}}function ye(i,t){if(i&1&&(n(0,"tr")(1,"td"),o(2),P(3,"date"),a(),n(4,"td"),o(5),a(),n(6,"td"),o(7),a(),n(8,"td"),m(9,Se,2,0,"button",12),a(),n(10,"td"),m(11,Pe,2,0,"button",12),a()()),i&2){let e=t.$implicit;c(2),f($(3,5,e.fecha,"dd/MM/yyyy HH:mm")),c(3),f(e.especialidad),c(2),f(e.estado),c(2),l("ngIf",e.resena),c(2),l("ngIf",e.historiaClinicaId)}}function Ie(i,t){if(i&1&&(n(0,"div")(1,"h3"),o(2),a(),n(3,"table")(4,"tr")(5,"th"),o(6,"Fecha"),a(),n(7,"th"),o(8,"Especialidad"),a(),n(9,"th"),o(10,"Estado"),a(),n(11,"th"),o(12,"Rese\xF1a"),a(),n(13,"th"),o(14,"Historial"),a()(),m(15,ye,12,8,"tr",11),a()()),i&2){let e=d();c(2),k("Turnos de ",e.pacienteSeleccionado.nombre," ",e.pacienteSeleccionado.apellido),c(13),l("ngForOf",e.turnosPacienteSeleccionado)}}var pe=class i{firestore=C(W);authService=C(Z);dialog=C(ie);pacientes=[];pacienteSeleccionado=null;turnosPacienteSeleccionado=[];cargando=!0;ngOnInit(){return _(this,null,function*(){this.cargando=!0;let t=this.authService.userSignal();if(!t)return;let e=D(this.firestore,"turnos"),r=N(e,A("especialistaUid","==",t.uid)),p=(yield T(r)).docs.map(u=>u.data()).filter(u=>["realizado","finalizado"].includes(u.estado)),b=Array.from(new Set(p.map(u=>u.pacienteUid)));if(b.length){let u=D(this.firestore,"usuarios"),me=yield T(u);this.pacientes=me.docs.filter(g=>g.data().rol==="paciente"&&b.includes(g.id)).map(g=>j({uid:g.id},g.data()))}this.cargando=!1})}seleccionarPaciente(t){return _(this,null,function*(){this.pacienteSeleccionado=t;let e=this.authService.userSignal();if(!e)return;let r=D(this.firestore,"turnos"),s=N(r,A("pacienteUid","==",t.uid),A("especialistaUid","==",e.uid)),p=yield T(s);this.turnosPacienteSeleccionado=p.docs.map(b=>b.data())})}toggleFavorito(t){return _(this,null,function*(){t.favorito=!t.favorito})}verResena(t){this.dialog.open(R,{data:{resena:t.resena}})}verHistorialClinicoTurno(t){return _(this,null,function*(){if(!t.historiaClinicaId){this.dialog.open(O,{data:{paciente:{nombre:t.pacienteNombre,apellido:t.pacienteApellido},soloLectura:!0}});return}let e=X(this.firestore,"historias-clinicas",t.historiaClinicaId),r=yield Y(e);if(!r.exists()){this.dialog.open(O,{data:{paciente:{nombre:t.pacienteNombre,apellido:t.pacienteApellido},soloLectura:!0}});return}let s=r.data();this.dialog.open(O,{data:{paciente:{nombre:t.pacienteNombre,apellido:t.pacienteApellido},historia:s,soloLectura:!0}})})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=M({type:i,selectors:[["app-pacientes-atendidos"]],decls:7,vars:4,consts:[[1,"pacientes-atendidos-container"],[4,"ngIf"],["class","pacientes-lista",4,"ngIf"],[1,"pacientes-lista"],["class","paciente-card",3,"selected",4,"ngFor","ngForOf"],[1,"paciente-card"],[1,"paciente-header"],["alt","Foto de perfil",1,"paciente-avatar",3,"src"],[1,"paciente-nombre"],["mat-icon-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"h2"),o(2,"Pacientes Atendidos"),a(),m(3,he,2,0,"div",1)(4,be,2,0,"div",1)(5,Me,2,1,"div",2)(6,Ie,16,3,"div",1),a()),e&2&&(c(3),l("ngIf",r.cargando),c(),l("ngIf",!r.cargando&&r.pacientes.length===0),c(),l("ngIf",r.pacientes.length),c(),l("ngIf",r.pacienteSeleccionado))},dependencies:[I,q,y,G,K,J,w,E,Q,de,le,se],styles:[".pacientes-atendidos-container[_ngcontent-%COMP%]{background:var(--bg-color);min-height:100vh;padding:1rem;margin:0;color:var(--text-color)}table[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.pacientes-lista[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem;margin-top:1.5rem;justify-content:center}.paciente-card[_ngcontent-%COMP%]{background:var(--card-bg);box-shadow:0 4px 16px var(--shadow);border-radius:18px;padding:1.5rem;display:flex;flex-direction:column;justify-content:space-between;color:var(--text-color);transition:transform .2s ease;min-width:320px;max-width:420px}.paciente-card[_ngcontent-%COMP%]:hover{transform:scale(1.02)}.paciente-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.25rem;color:var(--text-color)}.paciente-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.paciente-card[_ngcontent-%COMP%]   .acciones[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}.paciente-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}.paciente-avatar[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid rgba(142,36,170,.2666666667)}.paciente-nombre[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.paciente-nombre[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.paciente-nombre[_ngcontent-%COMP%]   button[mat-icon-button][_ngcontent-%COMP%]{margin-left:.5rem;border-radius:50%}"]})};export{pe as PacientesAtendidos};
